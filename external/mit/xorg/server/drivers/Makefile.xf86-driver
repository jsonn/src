#	$NetBSD: Makefile.xf86-driver,v 1.10.2.2 2008/09/18 05:18:41 wrstuden Exp $

LIBISMODULE=	yes
SHLIB_MAJOR=	${PACKAGE_MAJOR}

.include <bsd.own.mk>
.include <bsd.x11.mk>

LIB=	${DRIVER_NAME}
LIBDIR=	${X11USRLIBDIR}/modules/drivers

PRINT_PACKAGE_VERSION=	awk '/^PACKAGE_VERSION=/ {			\
				match($$1, "[0-9]+\\.[0-9]+\\.[0-9]+");	\
				version = substr($$1, RSTART, RLENGTH);	\
			} END { print version }'			\
			${X11SRCDIR.${DRIVER}}/configure

PACKAGE_VERSION!=	${PRINT_PACKAGE_VERSION}

PACKAGE_MAJOR=		${PACKAGE_VERSION:R:R}
PACKAGE_MINOR=		${PACKAGE_VERSION:R:E}
PACKAGE_PATCH=		${PACKAGE_VERSION:E}

CPPFLAGS+=	-I${DESTDIR}${X11INCDIR}/xorg \
		-I${DESTDIR}${X11INCDIR}/pixman-1 \
		-I${X11SRCDIR.xorg-server}/../include \
		${X11FLAGS.DIX} ${X11INCS.DIX} \
		-DXFree86LOADER

CPPFLAGS+=	-DPACKAGE_VERSION_MAJOR=${PACKAGE_MAJOR}
CPPFLAGS+=	-DPACKAGE_VERSION_MINOR=${PACKAGE_MINOR}
CPPFLAGS+=	-DPACKAGE_VERSION_PATCHLEVEL=${PACKAGE_PATCH}
CPPFLAGS+=	-DXORG_VERSION_CURRENT=${XORG_VERSION_CURRENT}

.PATH:	${X11SRCDIR.${DRIVER}}/src
.PATH:	${X11SRCDIR.${DRIVER}}/man

.include <bsd.lib.mk>
