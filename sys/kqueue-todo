#	$NetBSD: kqueue-todo,v 1.1.2.27 2002/10/10 21:34:02 jdolecek Exp $

items todo from bill sommerfeld/thorpej:
	- multiple entry points
	- events should remain across fork()
	- rewrite sowakeup()
	- high-level docco overview of kqueues [c.f jlemon's various papers]
	- make sure there are no selwakeup() calls left (they should
	  all be selnotify() now).
	- kqfilter entry points for:
		- smb_trantcp
		- dev/pci/bktr/bktr_os.c		??? doesn't poll?

	- Test-compile the following ports:
		- amigappc		XXX not compilable even on trunk
		- evbsh3	XXX kernel compiles okay, but link fails
				due to missing end/edata symbols (not
				kq related)
		- evbsh5		XXX no intree toolchain available
		- hp700			XXX no intree toolchain available
		- pc532			XXX not xcompile capable
		- x86_64		XXX no intree toolchain available

done:
	- test compiled following ports:
		acorn26 acorn32 algor alpha amiga arc atari bebox
		cats cesfic cobalt dreamcast evbarm evbmips hp300
		hpcarm hpcmips hpcsh i386 luna68k mac68k macppc
		mipsco mmeye mvme68k mvmeppc netwinder news68k
		newsmips next68k ofppc playstation2 pmax pmppc prep
		sandpoint sbmips sgimips shark sparc sparc64 sun2
		sun3 vax walnut x68k
	- name->id lookup
	- why is union kn_ptr not just a void *? (added p_opaque)
	- need more comments in kern_event.c
	- explain fd_knlistsize better
	- section 9 man page for internal api
	- use pool for everything (that it can sanely be used for)
	- lib/libc/sys/kqueue.2 manpage merged
	- need to test bits of the tree that call closef() to determine
	  if knote_fdclose() is required. (aka fdrelease()/fdfree()):
		* ktrderef()		(f)ktrace - OK	[ jdolecek - references
			struct file, no descriptor available for userland ]
		* unp_detach()		OK		[ jdolecek -
			the sockets aren't attached to any process descriptor
			and thus can't have kevent attached to them]
		* nfsrv_zapsock()	nfsd - OK	[ jdolecek - the socket
			will never be available as descriptor for nfsd]
		* portal_unmount()	mount_portal - OK [ jdolecek - holds
			reference to struct file of the socket the process
			calling portal_mount() used; this DTRT WRT eventual
			kevents, the knote would be g/c when the process
			terminates without regard to the extra reference
			to the struct file ]

merge in from FreeBSD:
	usr.bin/tail
	pkgsrc/devel/py-kqueue
	lib/libc/net/res_send.c
	sys/netinet/tcp_subr.c	1.93 (?)
	libc/libc_r/uthread (?)
	pkgsrc/security/l0pht-watch (?)
	pkgsrc/www/thttpd
	sys/fs/fifofs/fifo_vnops.c rev. 1.54
	  - jdolecek: this change seems to be bogus, but perhaps I just
	    miss something?

to fix:

	- look for XXXLUKEM in the comments. these usually indicate
	  areas to either fix or sanity check they're ok (and remove
	  the XXXLUKEM comment)

	- kqfilter for systrace (evaluate feasibility)

not implemented:
	- aio support
		not supported on netbsd; a noop for now


pkgsrc todo:

tested:

	create/close	OK

	EVFILT_PROC	OK

	EVFILT_SIGNAL	OK

	EVFILT_VNODE	OK for files (all NOTE_*s seem to work)

	EVFILT_READ	OK for files, socket listen+read, pipes, fifos, tty

	EVFILT_WRITE	OK for pipes, socket, fifos, tty

	EVFILT_AIO	FAIL: not implemented, returns EINVAL

	timeouts	OK. tested  NULL (infinity), 0 (poll), >0 (maxwait)

	KEVENT_NAME	(ioctl) OK

	KEVENT_FILTER	(ioctl) OK
