$NetBSD: newlock2-TODO,v 1.1.2.3 2006/11/18 23:55:49 ad Exp $

Goals:

	Locking primatives:

	- Implement the full assembly stubs on most-used ports.
	- Do the minimum necessary on other ports.
	- mb_read(), mb_write(), mb_memory() on all platforms

	Locking:

	- Lock access to struct lwp
	- Lock signalling
	- Remove sched_lock
	- Make sleep/wakeup MP safe

	Signalling:

	- Implement _lwp_kill()
	- Per-LWP signal masks

TODO:

	- Fix ptrace
	- kgmon is broken, is it broken on HEAD?
	- amd64: SPL NOT LOWERED ON SYSCALL EXIT under load, i386 is stable
	- p_userret replacement
	- Repair syscalls.master
	- Wakeups too early in exit1()
	- Check usage of P_ISZOMBIE / SZOMB
	- Memory barriers between setting one of L_USERRET and signotify()
	- itimers need work (per-LWP vs SA)
	- Locking around PCB / setcontext for ptrace
	- Further locking around sigstack
	- Lock the SA subsystem
	- Save and restore old SPL / mutex count for each idepth
	- Architectures other than i386, amd64
	- Compat struct proc flags for sysctl, other emulations
	- Check proc flags usage outside MI kernel
	- Check for memory barriers before posting an AST
	- Verify that the signals stuff is correct for SA
	- Test and verify: SA, LWP syscalls, signals, procfs
	- Benchmark comparisons against newlock2-base
	- Eliminate all XXXAD comments
	- Sync with head
	- Examine diff against HEAD
