#	$NetBSD: CHANGES-1.5.1,v 1.1.2.20 2001/01/25 18:37:41 jhawk Exp $

A complete list of changes from NetBSD 1.5 to NetBSD 1.5.1:

File						Revision(s)
----						--------

sys/sys/param.h					patch
sys/conf/osrelease.sh				patch
share/tmac/doc-common				patch

  Mark this as 1.5.1_ALPHA.

sys/dev/ic/an.c					1.1-1.3 + patch (new)
sys/dev/ic/anreg.h				1.1-1.2 (new)
sys/dev/ic/anvar.h				1.1 (new)
sys/dev/pcmcia/if_an_pcmcia.c			1.1-1.2 (new)
sys/dev/DEVNAMES				1.24
sys/conf/files					1.409
sys/dev/pcmcia/files.pcmcia			1.30
sys/arch/i386/conf/GENERIC			1.382
sys/arch/i386/conf/GENERIC_LAPTOP		1.7
sys/arch/i386/conf/INSTALL_LAPTOP		1.7

  Add a driver for an(4), Aironet and Cisco wireless pcmcia cards.

crypto/dist/krb4/lib/krb/tf_util.c		1.2
crypto/dist/krb4/lib/krb/kdc_reply.c		1.2
crypto/dist/krb4/lib/krb/extra.c		1.2

  Remove overwriting of the old ticket file.  Fix buffer overrun.
  Remove obsolete support for environment variables.

libexec/ftpd/cmds.c				1.9
libexec/ftpd/version.h				patch

  Fix a one-byte buffer overrun.

sys/netinet/udp_usrreq.c			1.73-1.74

  Fix multicast inbound packet processing.  Fixes PR#11629.

sys/dev/wscons/wsdisplay.c			1.43

  Make sure to switch consoles synchronously.

sys/arch/powerpc/powerpc/ofw_machdep.c		1.7

  Make memory probing work correctly with the DIMMs in any order.

distrib/atari/miniroot/install.md		1.14

  Add the X11 sets to MDSETS.

distrib/sets/lists/base/obsolete.mi		1.14

  Add /usr/sbin/gifconfig; we now do "ifconfig tunnel".

usr.sbin/dhcp/common/discover.c			1.9-1.10
usr.sbin/dhcp/common/bpf.c			1.7

  Fix multiple problems that caused dhcpd to either spin or not
  respond to queries in a timely fashion.

sys/arch/vax/conf/INSTALL			1.11

  Enable VS4000/90 SCSI controller.

sys/arch/hp300/stand/Makefile.inc		1.11

  Use ``make print-objdir'' to get obj directory correctly.

sys/dev/pci/fms.c				1.8

  Make this build without ``mpu at fms''.

usr.sbin/user/user.c				1.34

  Don't try to create or move directory if only ``-d'' option is
  given; documentation claims ``-m'' is also required.

usr.bin/login/k5login.c				1.17

  Use strlcpy() to copy environment variable into a fixed-length
  buffer.  Fixes PR#11550.

libexec/telnetd/sys_term.c			1.20 via patch

  Fix buffer overflow and environment passing problems, and only
  accept a limites set of environment variables and non-filename
  TERMCAP variables.

sys/arch/mac68k/nubus/nubus.h			1.52

  Add the DrHw Apple 24AC "Boogie" video card.

sys/arch/mac68k/nubus/grf_nubus.c		1.60

  Clear interrupts on the Apple "Boogie" card.

sys/coda/coda_vnops.c				1.21
sys/kern/vfs_subr.c				1.140
sys/kern/vfs_syscalls.c				1.162
sys/miscfs/genfs/genfs_vnops.c			1.20
sys/miscfs/genfs/layer_vnops.c			1.4
sys/miscfs/specfs/spec_vnops.c			1.50
sys/miscfs/syncfs/sync_subr.c			1.6
sys/miscfs/syncfs/sync_vnops.c			1.4
sys/miscfs/union/union_vnops.c			1.48
sys/msdosfs/msdosfs_vfsops.c			1.70
sys/ntfs/ntfs_vnops.c				1.30
sys/ufs/ext2fs/ext2fs_vfsops.c			1.39
sys/ufs/lfs/lfs_vnops.c				1.45
sys/ufs/ffs/ffs_balloc.c			1.22
sys/ufs/ffs/ffs_inode.c				1.37
sys/ufs/ffs/ffs_softdep.c			1.6	
sys/ufs/ffs/ffs_vfsops.c			1.71
sys/ufs/ffs/ffs_vnops.c				1.33,1.34
sys/nfs/nfs_nqlease.c				1.33
sys/nfs/nfs_serv.c				1.58
sys/nfs/nfs.h					1.24
sys/nfs/nfs_bio.c				1.52
sys/nfs/nfs_node.c				1.36
sys/nfs/nfs_subs.c				1.83
sys/nfs/nfs_syscalls.c				1.44,1.45
sys/nfs/nfs_var.h				1.18
sys/nfs/nfs_vnops.c				1.120,1.123
sys/nfs/nfs_vfsops.c				1.96
sys/nfs/nfsnode.h				1.30
sys/nfs/nfsproto.h				1.9
sys/nfs/nfs_socket.c				1.60
sys/nfs/nfs_subs.c				1.85,1.87
sys/kern/vnode_if.src				1.25	
sys/kern/vnode_if.c				regenerate
sys/sys/vnode_if.h				regenerate

  Improve NFS performance, possibly with as much as 100% in
  throughput.  Please note: this implies a kernel interface change,
  VOP_FSYNC gains two arguments.

sys/nfs/nfs_boot.c				1.55
sys/nfs/nfs_socket.c				1.63
sys/kern/uipc_socket.c				1.51
sys/kern/uipc_syscalls.c			1.56
sys/sys/socketvar.h				1.41

  Fix NFS+tcp client hangs on server or network outage.  Again,
  please note that this introduces yet another kernel interface
  change: sobind() gains an argument.

usr.bin/passwd/krb5_passwd.c			1.10

  Don't try to free an uninitialized context; fixes core dump when
  called as ``yppasswd''.

sys/dev/pcmcia/if_ray.c				1.24-1.25

  Add a missing return after freeing an mbuf.
  Add support for 802.11 authentication frames, required to
  interoperate with Aviator Pro cards on Windows.

sys/dev/pci/pccbb.c				1.47,1.49

  Turn off power on shutdown, except on ToPIC (TI 113X) bridges on
  shutdown to avoid hangs on some systems.

distrib/notes/sparc64/hardware			1.6
distrib/notes/sparc64/install			1.5

  Recommend minimum 32MB.  The pciide cdroms work on secondary channel,
  but disks do not.  Also, add ``Install from Solaris'' instructions.

distrib/sparc/ramdisk/dot.profile		1.15

  Look for ``instfs.tgz'' in the $MACHINE subdir on cdrom first.

sys/arch/pmax/pmax/autoconf.c			1.55

  Fix netbooting on the 2100/3100.  Fixes PR#11212.

usr.sbin/pkg_install/add/main.c			1.17
usr.sbin/pkg_install/add/perform.c		1.56
usr.sbin/pkg_install/admin/main.c		1.17
usr.sbin/pkg_install/create/perform.c		1.24
usr.sbin/pkg_install/info/perform.c		1.34
usr.sbin/pkg_install/lib/file.c			1.44-1.45
usr.sbin/pkg_install/lib/ftpio.c		1.28
usr.sbin/pkg_install/lib/str.c			1.24

  Accept ``.tbz'' as an alternative suffix; compress with bzip2 if
  a .tbz suffix is given.  Fix pkg_info to work via ftp, either
  via URL on command line or from PKG_PATH environment variable.

sys/arch/news68k/dev/zs.c			1.5

  Initialize zs chip in zscninit() so that the kernel can use serial
  console even if the PROM uses bitmap console.  Remove some dead
  code.  Use BPS_TO_TCONST() to initialize baudrate.

sys/arch/arm32/pci/pciide_machdep.c		1.3

  Print which IRQ is used for compatibility interrupts.

sys/arch/sun3/sun3/sunmon.c			1.11
sys/arch/sun3/sun3x/machdep.c			1.61

  Make PROM boot command work properly even after halt on 3/80.

sys/lib/libsa/loadfile.c			1.9

  Don't print ``]'' if loading kernel does not have a symbol table.

sys/dev/pci/pciide.c				1.93

  Add support for Intel ICH2 IDE controller.

usr.sbin/mopd/mopd/process.c			1.10

  Make sure dle points to the correct slot.  Fixes PR#11253.

sys/dev/microcode/siop/ncr53cxxx.c		1.3-1.5

  Allow conditional branch like "JUMP foo, IF FALSE" (that the
  driver can later patch).  Bug fixes and syntax checking improvement.

sys/dev/microcode/siop/siop.ss			1.8-1.12
sys/dev/microcode/siop/siop.out			regenerate
sys/dev/ic/siop.c				1.23-1.24,1.28-1.36
sys/dev/ic/siop_common.c			1.7-1.11
sys/dev/ic/siopreg.h				1.7
sys/dev/ic/siopvar.h				1.9-1.13
sys/dev/ic/siopvar_common.h			1.5-1.8
sys/dev/pci/siop_pci_common.c			1.3
sys/dev/pci/siop_pci_common.h			1.2

  Speed improvements to the siop driver, and add tagged queueing
  support.  As a side effect, better handling of some not so common
  phase or message sequences.

distrib/notes/amiga/hardware			1.39

  Nowadays, need to tell people what models didn't have an MMU out
  of the box.

sbin/ping6/ping6.c				1.25

  Validate strdup() error on argument parsing.  Also, use strlcat()
  on complex string manipulation.

usr.sbin/grfconfig/grfconfig.8			1.10

  Document that text console modes need a depth field of 4.

share/man/man8/compat_pecoff.8			1.3-1.6

  Various grammar corrections, markup fixes.  Updates for the
  current status of The PEACE Project.

share/man/man8/Makefile				1.40

  Alias compat_win32.8 and peace.8.

distrib/sets/lists/man/mi			1.288

  Add peace(8) and compat_win32(8).

distrib/x68k/floppies/ramdisk-common/Makefile.inc 1.2

  Change all ocurrences of ``crunchgen'' to ${CRUNCHGEN}.

distrib/x68k/floppies/Makefile			1.7
distrib/x68k/floppies/bootfloppy-common/Makefile.inc 1.16
distrib/x68k/floppies/ramdisk.sysinst/Makefile	1.12 via patch
distrib/x68k/floppies/ramdisk.sysinst/dot.profile 1.7
distrib/x68k/floppies/bootfloppy.generic/Makefile 1.1 (new)
distrib/x68k/floppies/inst/Makefile		1.1 (new)
distrib/x68k/floppies/bootfloppy/Makefile	delete
distrib/x68k/floppies/ramdisk/Makefile		delete
distrib/x68k/floppies/ramdisk/dot.hdprofile	delete
distrib/x68k/floppies/ramdisk/dot.profile	delete
distrib/x68k/floppies/ramdisk/install.tmpl	delete
distrib/x68k/floppies/ramdisk/list		delete
distrib/x68k/floppies/ramdisk/mtree.conf	delete
distrib/x68k/floppies/ramdisk/ramdiskbin.conf	delete
distrib/x68k/floppies/ramdisk/start.tmpl	delete
distrib/x68k/floppies/ramdisk/upgrade.tmpl	delete

  Reorganize installation system by removing the old script based
  installer, provided for 4M systems.  Instead we provide
  ``floppy-root'' 2-floppy installer.

etc/etc.x68k/Makefile.inc			1.9
sys/arch/x68k/conf/INSTALL_SMALL		delete

  We do not use INSTALL_SMALL anymore.

sys/arch/x68k/conf/INSTALL			1.36 via patch

  Adjust the ramdisk size.

distrib/x68k/floppies/bootfloppy.sysinst/Makefile 1.6

  Change the kernel name from netbsdsi(.gz) to netbsd(.gz).

sys/arch/mac68k/obio/grf_obio.c			1.46-1.47

  Map only the register space of the DAFB required to set up the
  video hardware.  Fixes PR#11000.
  Be careful to unmap anything we map in the drivers' match function
  in order to avoid potential future problems.

sys/dev/ic/an.c					patch

  Fix multicast packet reception; handle corresponding ioctl().

sys/kern/vfs_getcwd.c				1.14

  Avoid an infinite loop if VOP_READDIR returned an error.

sys/arch/news68k/include/cpu.h			1.7
sys/arch/news68k/news68k/genassym.cf		1.6
sys/arch/news68k/news68k/locore.s		1.13,1.17

  Allow runtime enabling/disabling of DC_BE and IC_BE bits in %cacr
  and enable them on news1200/1400/1500 (Which have no L2 cache); yields
  a performance improvement. Also correct a typo in a comment.

sys/arch/news68k/include/romcall.h		1.2
sys/arch/news68k/stand/boot/boot.c		1.3
sys/arch/news68k/stand/boot/locore.S		1.3
sys/arch/news68k/stand/bootxx/start.S		1.2
sys/arch/news68k/stand/common/romcalls.S	1.2

  Make sure to return PROM prompt even if loading kernel fails halfway,
  by calling the PROM halt routine upon failure of loadfile().

gnu/usr.bin/ld/ld/ld.c				1.73
gnu/usr.bin/ld/ld/ld_i.h			1.2
gnu/usr.bin/ld/ld/lib.c				1.23

  Correct various problems with argument parsing for --whole-archive and
  --no-whole-archive. Fully implement --no-whole-archive. Remove spurious
  warning for -Bshareable.

sys/dev/pci/tga.c				1.29

  Restore code to clear "odd" in VCHR. This seems to be required for X
  to function properly on the T8-02 TGA (onboard on Multias, seperate
  card in other machines).

usr.sbin/chown/chown.c				1.25 via patch

  Correct the display of some errors in chown. Fixes PR#11695.

distrib/utils/sysinst/mbr.c			1.24

  Correct an error in the calculation of the end of a partition. Fixes PR#7556.

usr.sbin/rpc.lockd/lockd_lock.c			1.5

  Fix an error freeing the wrong lock; in some cases this might have lfree()'d
  a NULL pointer.

distrib/utils/sysinst/util.c			1.59
distrib/utils/sysinst/msg.mi.en			1.79
distrib/utils/sysinst/msg.mi.fr			1.39

  Fix sysinst to require base.tgz (in addition to etc.tgz and
  kern.tgz) to successfully install. Fixes PR#11634.

sys/dev/pcmcia/wdc_pcmcia.c			1.36 via patch

  Support AMACOM "Value Engineered" CDROM.

sys/dev/isa/ad1848_isa.c			1.17
sys/dev/isa/ad1848var.h				1.35

  Support full-duplex audio on 1848 wss devices by using
  seperate interrupt handlers for play and record. Fix from
  Juergen Weiss <weiss@uni-mainz.de> by way of PR#11178.

gnu/usr.sbin/sendmail/Makefile			1.3

  Move the the "doc" subdirectory from MKSHARE conditional to the MKDOC one.

sys/dev/tc/sfbreg.h				1.3

  Make XalphaNetBSD compile with SFB support.

sbin/ifconfig/ifconfig.c			1.81, 1.87
sbin/ifconfig/ifconfig.8			1.34, 1.38
sys/net/if.c					1.63-1.64, 1.67
sys/net/if.h					1.51, 1.53
sys/sys/sockio.h				1.12-1.13

  Support cloning of network pseudo-interfaces.

etc/etc.i386/MAKEDEV				1.131 via patch

  Support up to five SCSI disks during INSTALL, not only three. Fixes PR#9912.

sys/arch/macppc/include/vmparam.h		1.13

Increase limits (max test size, datasize, default datasize, and
default stacksize) to match other ports.  (Fixes a bunch of problems
running apps like Mozilla with the defaults.)

sbin/ifconfig/ifconfig.c			1.89
sbin/ifconfig/ifconfig.8			1.43
distrib/sets/lists/comp/mi			1.258
distrib/sets/lists/man/mi			1.269
share/man/man4/Makefile				1.166
share/man/man4/vlan.4				1.1-1.6 (new)
sys/conf/files					1.395 via patch
sys/net/Makefile				1.8
sys/net/if_ether.h				1.18-1.19, 1.21
sys/net/if_ethersubr.c				1.59-1.60, 1.62-1.65, 1.70
						via patch
sys/net/if_vlan.c				1.1-1.14, 1.16-1.21,
						1.23-1.26 (new)
sys/net/if_vlanvar.h				1.1-1.4 (new)
sys/sys/sockio.h				1.14
sys/dev/ic/dp8390.c				1.39
sys/dev/ic/elinkxl.c				1.43 via patch
sys/dev/ic/elinkxlreg.h				1.4
sys/dev/ic/i82557.c				1.39
sys/dev/ic/lance.c				1.14
sys/dev/ic/smc83c170.c				1.36
sys/dev/ic/tulip.c				1.74-1.75

	Add support for 802.1Q virtual LANs.

sys/dev/pci/if_ti.c				1.12, 1.15 via patch
sys/dev/pci/if_tireg.h				1.3
sys/dev/pci/pcidevs				1.272 via patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/ti_fw.h				1.2
sys/dev/pci/ti_fw2.h				1.2
share/man/man4/ti.4				1.4 via patch
share/man/man4/vlan.4				1.7

  For the ti driver, add hardware 802.1Q support, update firmware
  to 12.4.13+wpaul, and support the Netgear GA620T copper gigabit card,
  and the Alteon ACEnic 100baseSX and 1000baseT gigabit cards. Various
  small changes from FreeBSD.

sys/arch/i386/i386/sys_machdep.c                1.55

  Validate gate targets correctly.

sys/dev/ic/rtl81x9.c				1.12, 1.21-1.24 via patch
sys/dev/ic/rtl81x9var.h				1.6-1.7

  Clean up receive interrupt routine and fix DMA buffer handing
  for receive buffering.
  Add missed bus_dmamem_free() in rtk_detach().
  Some cosmetic fixes.

usr.sbin/user/user.c				1.35
usr.sbin/user/usermod.8				1.8

  Make moving a user's homedirectory with -md work correctly,
  and clarify the meaning of -d in the absence of -m. Fixing PR11707 

sbin/modload/elf.c				1.4

  Ensure that data_hole is aligned to a section, otherwise
  elf_mod_sizes() may report a size too small, affecting LKM loading.

crypto/dist/heimdal/lib/gssapi/acquire_cred.c	1.2, 1.3
crypto/dist/heimdal/lib/gssapi/gssapi.h		1.2 via patch
crypto/dist/heimdal/lib/gssapi/init_sec_context.c 1.2 via patch
crypto/dist/heimdal/lib/gssapi/release_cred.c	1.2

  Make gss_acquire_cred() work for cases other than GSS_C_NO_CREDENTIAL
  (i.e 'get current, default credentials').  This is needed to support
  things like gss-api authentication with IKE, as currently implemented
  in racoon.

sys/netinet6/in6_prefix.c			1.13

  Don't dereference null ra_addr pointer.

share/examples/supfiles/sup.de.netbsd.org	deleted
share/examples/supfiles/Makefile		1.7

  sup.de.netbsd.org no longer exists (since May 2000).

sys/net/bpf.c					1.60

  Fix non-blocking BPF reads. Fixes PR kern/11836.

share/misc/acronyms				1.64-1.73

  Various acryonym updates.

sys/arch/amiga/dev/if_ne_zbus.c			1.6
sys/arch/amiga/conf/GENERIC			1.154
sys/arch/amiga/conf/AMIGA			regen
sys/arch/amiga/conf/DRACO			regen
sys/arch/amiga/conf/INSTALL			regen

  Correct and add (Respectively) the name of the X-surf board in comments.

distrib/sets/lists/man/mi			patch

  Remove duplicates (presumed due to merge errors).

sys/dev/isa/if_cs_isa.c				1.3
sys/dev/ofisa/if_cs_ofisa.c			1.4

  Include <sys/rnd.h> as appropriate to properly size cs_softc.

sys/arch/mac68k/mac68k/locore.s			1.133
sys/arch/mac68k/obio/esp.c			1.26-1.28
sys/arch/mac68k/obio/espvar.h			1.6

 Improve performance of the pseudo-DMA mode of the esp driver, and handle
 residual FIFO data on write.

usr.bin/tftp/main.c				1.14

  Fix argument validation error in setpeer().

sys/dev/pcmcia/if_wi.c				1.48
sys/dev/pcmcia/if_wivar.h			1.15

  Ensure the ethernet payload is properly aligned. Fixes PR port-hpcmips/11477.

distrib/sets/lists/base/mi			1.204
etc/mtree/NetBSD.dist				1.128

  /etc/openssl/cert.pem is a file, not a directory. Fixes PR11772.

lib/libc/locale/setlocale.c			1.23, 1.25-1.27, 1.31 via patch

  Updates to setlocale(): return NULL for nonexistant locales, ignore
  some errors, and handle environment vars consistently (no slashes).

sys/dev/sbus/isp_sbus.c				1.31-1.34
sys/dev/microcode/isp/asm_2200.h		1.2
sys/dev/microcode/isp/asm_sbus.h		1.16
sys/dev/pci/isp_pci.c				1.57-1.58, 1.60-1.61
sys/dev/ic/isp.c				1.62-1.65
sys/dev/ic/ispvar.h				1.36-1.38
sys/dev/ic/isp_netbsd.h				1.30-1.33
sys/dev/ic/isp_netbsd.c				1.31-1.35

  Add in correct SBus bursting; upgrade to 2.01.26 firmware; pull to latest
  initiator mode level; make changes to WWN default handling; quiet
  chatty boot messages; fix endian code so MacPPC works; fix bug in
  lock recursion counter; fix bug which excluded all but NL-ports from
  being logged into on a fabric.
