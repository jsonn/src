.\" $Id: hprop.8,v 1.1.1.1.2.1 2001/04/05 23:23:01 he Exp $
.\"
.Dd June 19, 2000
.Dt HPROP 8
.Os HEIMDAL
.Sh NAME
.Nm hprop
.Nd
propagate the KDC database
.Sh SYNOPSIS
.Nm
.Oo Fl m Ar file \*(Ba Xo
.Fl -master-key= Ns Pa file Oc
.Xc
.Oo Fl d Ar file \*(Ba Xo
.Fl -database= Ns Pa file Oc
.Xc
.Op Fl -source= Ns Ar heimdal|mit-dump|krb4-db|krb4-dump
.Op Fl 4 | Fl -v4-db
.Op Fl K | Fl -ka-db
.Oo Fl c Ar cell \*(Ba Xo
.Fl -cell= Ns Ar cell Oc
.Xc
.Op Fl S | Fl -kaspecials
.Oo Fl r Ar string \*(Ba Xo
.Fl -v4-realm= Ns Ar string Oc
.Xc
.Oo Fl k Ar keytab \*(Ba Xo
.Fl -keytab= Ns Ar keytab Oc
.Xc
.Oo Fl R Ar string \*(Ba Xo
.Fl -v5-realm= Ns Ar string Oc
.Xc
.Op Fl D | Fl -decrypt
.Op Fl E | Fl -encrypt
.Op Fl n | Fl -stdout
.Op Fl v | Fl -verbose
.Op Fl -version
.Op Fl h | Fl -help
.Ar host Ns Op :port
...
.Sh DESCRIPTION
.Nm
takes a principal database in a specified format and converts it into
a stream of Heimdal database records. This stream can either be
written to standard out, or (more commonly) be propagated to a
.Xr hpropd 8
server running on a different machine.
.Pp
If propagating, it connects to all
.Ar hosts
specified on the command by opening a TCP connection to port 754
(service hprop) and sends the database in encrypted form.
.Pp
Supported options:
.Bl -tag -width Ds
.It Xo
.Fl m Ar file Ns ,
.Fl -master-key= Ns Pa file
.Xc
Where to find the master key to encrypt or decrypt keys with.
.It Xo
.Fl d Ar file Ns ,
.Fl -database= Ns Pa file
.Xc
The database to be propagated.
.It Xo
.Fl -source= Ns Ar heimdal|mit-dump|krb4-db|krb4-dump
.Xc
Specifies the type of the source database. Alternatives include: 
.Bl -tag -width krb4-dump
.It heimdal
a Heimdal database
.It mit-dump
a MIT Kerberos 5 dump file
.It krb4-db
a Kerberos 4 database
.It krb4-dump
a Kerberos 4 dump file
.It kaserver
a Transarc kaserver database
.El
.It Xo
.Fl k Ar keytab Ns ,
.Fl -keytab= Ns Ar keytab
.Xc
The keytab to use for fetching the key to be used for authenticating
to the propagation daemon(s). The key
.Pa kadmin/hprop
is used from this keytab.  The default is to fetch the key from the
KDC database.
.It Xo
.Fl R Ar string Ns ,
.Fl -v5-realm= Ns Ar string
.Xc
Local realm override.
.It Xo
.Fl D Ns ,
.Fl -decrypt
.Xc
The encryption keys in the database can either be in clear, or
encrypted with a master key. This option thansmits the database with
unencrypted keys.
.It Xo
.Fl E Ns ,
.Fl -encrypt
.Xc
This option thansmits the database with encrypted keys.
.It Xo
.Fl n Ns ,
.Fl -stdout
.Xc
Dump the database on stdout, in a format that can be fed to hpropd.
.El

The following options are only valid if
.Nm hprop
is compiled with support for Kerberos 4 (kaserver).
.Bl -tag -width Ds
.It Xo
.Fl r Ar string Ns ,
.Fl -v4-realm= Ns Ar string
.Xc
v4 realm to use
.It Xo
.Fl c Ar cell Ns ,
.Fl -cell= Ns Ar cell
.Xc
The AFS cell name, used if reading a kaserver database.
.It Xo
.Fl S Ns ,
.Fl -kaspecials
.Xc
Also dump the principals marked as special in the kaserver database.
.It Xo
.Fl 4 Ns ,
.Fl -v4-db
.Xc
Deprecated, identical to 
.Sq --source=krb4-db .
.It Xo
.Fl K Ns ,
.Fl -ka-db
.Xc
Deprecated, identical to 
.Sq --source=kaserver .
.El

.Sh EXAMPLES
The following will propagate a database to another machine (which
should run
.Xr hpropd 8):
.Bd -literal -offset indent
$ hprop slave-1 slave-2
.Ed

Copy a Kerberos 4 database to a Kerberos 5 slave:
.Bd -literal -offset indent
$ hprop --source=krb4-db -E krb5-slave
.Ed

Convert a Kerberos 4 dump-file for use with a Heimdal KDC:
.Bd -literal -offset indent
$ hprop -n --source=krb4-dump -d /var/kerberos/principal.dump -E | hpropd -n
.Ed
.Sh SEE ALSO
.Xr hpropd 8
