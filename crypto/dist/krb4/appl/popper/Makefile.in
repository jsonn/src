# $Id: Makefile.in,v 1.1.1.1.4.2 2000/06/16 18:46:25 thorpej Exp $

SHELL = /bin/sh

srcdir = @srcdir@
VPATH = @srcdir@

top_builddir = ../..

CC = @CC@
LINK = @LINK@
AR = ar
RANLIB = @RANLIB@
DEFS = @DEFS@
CFLAGS = @CFLAGS@ $(WFLAGS)
WFLAGS = @WFLAGS@
LD_FLAGS = @LD_FLAGS@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
LIBS = @LIBS@
LIB_DBM = @LIB_DBM@
MKINSTALLDIRS = @top_srcdir@/mkinstalldirs

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
bindir = @bindir@
libexecdir = @libexecdir@
transform=@program_transform_name@
EXECSUFFIX=@EXECSUFFIX@

PROG_BIN	= pop_debug$(EXECSUFFIX)
PROG_LIBEXEC	= popper$(EXECSUFFIX)
PROGS = $(PROG_BIN) $(PROG_LIBEXEC)

SOURCES = $(POPPER_SOURCES) $(POP_DEBUG_SOURCES)
OBJECTS = $(POPPER_OBJECTS) $(POP_DEBUG_OBJECTS)

POPPER_SOURCES = \
	pop_dele.c pop_dropcopy.c pop_dropinfo.c \
	pop_get_command.c pop_init.c \
	pop_last.c pop_list.c pop_log.c \
	pop_msg.c pop_parse.c pop_pass.c pop_quit.c \
	pop_rset.c pop_send.c pop_stat.c pop_updt.c \
	pop_user.c pop_uidl.c pop_xover.c popper.c maildir.c

POP_DEBUG_SOURCES = \
	pop_debug.c

POPPER_OBJECTS = \
	pop_dele.o pop_dropcopy.o pop_dropinfo.o \
	pop_get_command.o pop_init.o \
	pop_last.o pop_list.o pop_log.o pop_msg.o \
	pop_parse.o pop_pass.o pop_quit.o pop_rset.o \
	pop_send.o pop_stat.o pop_updt.o pop_user.o \
	pop_uidl.o pop_xover.o popper.o maildir.o

POP_DEBUG_OBJECTS = \
	pop_debug.o

all: $(PROGS)

Wall:
	make CFLAGS="-g -Wall -Wno-comment -Wmissing-prototypes -Wmissing-declarations -D__USE_FIXED_PROTOTYPES__"

.c.o:
	$(CC) -c $(DEFS) -I../../include -I$(srcdir) $(CFLAGS) $(CPPFLAGS) $<

install: all
	$(MKINSTALLDIRS) $(DESTDIR)$(libexecdir)
	for x in $(PROG_LIBEXEC); do \
	  $(INSTALL_PROGRAM) $$x $(DESTDIR)$(libexecdir)/`echo $$x | sed '$(transform)'`; \
	done

uninstall:
	for x in $(PROG_LIBEXEC); do \
	  rm -f $(DESTDIR)$(libexecdir)/`echo $$x | sed '$(transform)'`; \
	done

TAGS: $(SOURCES)
	etags $(SOURCES)

check:

clean:
	rm -f *.a *.o $(PROGS)

mostlyclean: clean

distclean: clean
	rm -f Makefile *.tab.c *~

realclean: distclean
	rm -f TAGS

KLIB=-L../../lib/krb -lkrb -L../../lib/des -ldes
LIBROKEN=-L../../lib/roken -lroken
OTPLIB=@LIB_otp@

popper$(EXECSUFFIX): $(POPPER_OBJECTS)
	$(LINK) $(LD_FLAGS) $(LDFLAGS) -o $@ $(POPPER_OBJECTS) $(OTPLIB) $(KLIB) $(LIBROKEN) $(LIB_DBM) $(LIBS) $(LIBROKEN)

pop_debug$(EXECSUFFIX): $(POP_DEBUG_OBJECTS)
	$(LINK) $(LD_FLAGS) $(LDFLAGS) -o $@ $(POP_DEBUG_OBJECTS) $(KLIB) $(LIBROKEN) $(LIBS) $(LIBROKEN)

$(OBJECTS): ../../include/config.h

.PHONY: all Wall install uninstall check clean mostlyclean distclean realclean
