# $NetBSD: CHANGES-5.1.3,v 1.1.2.18 2012/06/12 20:44:30 riz Exp $

A complete list of changes from the NetBSD 5.1.2 release to the NetBSD 5.1.3
release:

gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 5.1.2_PATCH.
	[snj]

sys/kern/kern_fork.c				1.184 via patch

	fork1: fix stop-on-fork case, lend a correct lock to LWP for
	LSSTOP state.
	Fixes PR/44935.
	[rmind, ticket #1628]

sys/kern/vfs_bio.c				1.233

	sysctl_dobuf: re-acquire the sysctl lock on retry path.  PR/45827.
	[rmind, ticket #1718]

sys/net/route.c					1.126

	Count length from the beginning of the structure not the sa_data
	portion.
	[christos, ticket #1721]

distrib/sets/lists/base/mi			1.988
doc/3RDPARTY					1.920 via patch
share/zoneinfo/antarctica			patch
share/zoneinfo/asia				patch
share/zoneinfo/australasia			patch
share/zoneinfo/europe				patch
share/zoneinfo/leapseconds			patch
share/zoneinfo/northamerica			patch
share/zoneinfo/southamerica			patch
share/zoneinfo/zone.tab				patch

	Update to tzdata2012a.
	[apb, ticket #1733]

doc/3RDPARTY					1.921
share/zoneinfo/northamerica			patch
share/zoneinfo/zone.tab				patch

	Update to tzdata2012b.
	[apb, ticket #1734]

doc/HACKS					1.123 via patch
sys/arch/sparc64/conf/Makefile.sparc64		1.71 via patch
sys/arch/sparc64/conf/files.sparc64		1.138 via patch
sys/arch/sparc64/sparc64/locore.s		1.340 via patch

	Fix the root cause of the hack "disable optimizations for uvm_bio.c
	on 32 bit kernels".

	gcc converts a division in the calculation of UBC_UMAP_ADDR macro
	to multiplication (smul or combination of add/sll), and the
	register of its result contains a garbage in upper 32 bits (the
	upper 32 bits of smul/add/sll's result isn't zero cleared).

	Then it passes to pseg_get{,_real} through pmap_extract without the
	zero clear of upper 32 bits in the optimization case.  So the
	result of pseg_get and pmap_extact sometimes gets screwed up.
	[nakayama, ticket #1736]

sys/kern/kern_sig.c				1.300

	kpsignal2: do not make the signal pending twice when tracing the
	process, also update a comment and add an assert.
	Fixes PR/42309 by Nicolas Joly.
	[christos, ticket #1741]

usr.bin/ktruss/makeerrnos.sh			1.6

	Use 'sort -n -k 3' instead of 'sort -n +2' since the former is more
	portable.  The latter is not supported by Mac OS X Lion.
	[dyoung, ticket #1742]

sbin/mount/mount.8				1.73, 1.74

	Clarify UFS2 superblock format stuff. Bump date.  Fix PR 45166.
	[dholland, ticket #1743]

sys/dev/wscons/wsemul_vt100.c			1.31
sys/dev/wscons/wsemul_vt100_chars.c		1.12
sys/dev/wscons/wsksymdef.h			1.62

	s/portugese/portuguese/, spotted by Ari Constancio in PR misc/40202.
	[bouyer, ticket #1727]

crypto/dist/openssl/crypto/mem.c		patch
crypto/dist/openssl/crypto/asn1/a_d2i_fp.c	patch
crypto/dist/openssl/crypto/buffer/buffer.c	patch

	Address CVE-2012-2110.
	[spz, ticket #1750]

crypto/dist/openssl/crypto/buffer/buffer.c	patch

	Minor error code fix for ticket #1750.
	[drochner, ticket #1752]

sys/netsmb/subr_mchain.c			1.21

	Fix a regression introduced in netsmb by ticket #1426.
	PR#44092.
	[nakayama, ticket #1758]

crypto/dist/openssl/ssl/d1_enc.c		patch

	Address CVE-2012-2333.
	[drochner, ticket #1762]

sys/arch/x68k/x68k/clock.c			1.34
	With the freerunnnig mode, set 0 (=256count) not 0xff (=255count)
	in Timer-D.  It fixes the clock ticked faster when timecounter uses
	"mfp" (as default choice).  It was introduced in rev 1.24 in 2006.
	Thanks tsutsui@ for many comments.
	[isaki, ticket #1765]

sys/kern/uipc_usrreq.c        1.137
	Stopgap fix for PR kern/46463: disallow passing of kqueue descriptors
	via SCM_RIGHT anxiliary socket messages.
	[martin, ticket #1766]

dist/bind/CHANGES					patch
dist/bind/version					patch
dist/bind/bin/tests/system/unknown/clean.sh		patch
dist/bind/bin/tests/system/unknown/tests.sh		patch
dist/bind/bin/tests/system/unknown/ns1/example-in.db	patch
dist/bind/lib/dns/rdata.c				patch
dist/bind/lib/dns/rdataslab.c				patch
	
	Update bind to 9.7.3-P4:
	3331.  [security]      dns_rdataslab_fromrdataset could produce bad
			       rdataslabs. [RT #29644]
	 [christos, ticket #1767]

sys/arch/amd64/amd64/trap.c			1.71 via patch
sys/arch/amd64/amd64/vector.S			1.41 via patch
sys/arch/amd64/include/frameasm.h		patch

 	Fix issues when amd64 manages to trap during 'return to user'.  ie on
	the 'iret' or while loading segment registers.
	Also detects any fault loading %gs and re-instates the kernel gs_base
	value before entering the trap handler.
	[spz, ticket #1772]

