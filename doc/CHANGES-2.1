#	$NetBSD: CHANGES-2.1,v 1.1.2.110 2005/05/19 10:27:13 tron Exp $

A complete list of changes from the NetBSD 2.0 release to the NetBSD 2.1 
release

File						Revision(s)
----						--------
sys/sys/param.h                                 patch
share/tmac/doc-common                           patch
gnu/usr.bin/groff/tmac/mdoc.local               patch

	Welcome to 2.0_STABLE

sys/dev/mii/igphy.c				1.5
sys/dev/mii/igphyreg.h				1.2
sys/dev/pci/if_wmreg.h				1.12
sys/dev/pci/if_wm.c				1.78

	Fix major performance issues with the i82547 Gig-E chip:
	- enable the SmartSpeed work-around code for the IGP phy, with some
	  minor adjustments.
	- add some useful constants related to the Packet Buffer Allocation
	  register.
	- add the Receive and Transmit Data FIFO registers.
	- change the Tx:Rx on-chip RAM allocation ratio based on MTU.
	- On the 82547, keep track of how much of the Tx FIFO has been used.
	[thorpej, ticket #897]

sys/dev/pci/if_sk.c				1.11
sys/dev/pci/if_skreg.h				1.3
sys/dev/pci/if_skvar.h				1.4

	Fix Yukon ram sizing.
	Fix tx queue (slist can be corrupted when tx interrupts hit within
	tx_encap.
	Lower interrupt moderation timer to (improves performance).
	Improve chip identification. (from linux sk98lin driver).
	Keep tx queue running by kicking the tx bmu repeatedly.
	[abs, ticket #973]

sys/arch/powerpc/powerpc/trap.c			1.104

	Make sure to do setenv/unsetenv in pairs.  This prevents panics in
	DIAGNOSTIC kernel when crossing segment boundaries.
	[matt, ticket #985]

sys/arch/macppc/conf/INSTALL			1.78

	Now that we have ofwboot load at 0xe00000, it doesn't make sense for
	this kernel to load at 0x800000 - move back to the default and we
	have around 13 MB of space for the kernel.
	[wrstuden, ticket #951]

sys/arch/sparc64/sparc64/pmap.c			1.157

	Do the invalidation of the (virtually-addressed) L1 cache in
	pmap_remove_all() (ie. just before we skip the per-page cache
	invalidations while tearing down each context) instead of just
	before we recycle all the contexts in ctx_alloc().  The latter
	is not good enough since a (physically tagged) L1 cache line is
	valid for all contexts, not just the one that was used to
	instantiate it. PR#24126, PR#25669 and PR#27730.
	[martin, ticket #1013]

sys/arch/sparc64/sparc64/pmap.c			1.158

	Better return value checking for pseg_get/pseg_set. Turn Debugger()
	calls into proper panics and sprinkle some KASSERTs. PR#27288.
	[martin, ticket #1014]

lib/libc/arch/sparc64/gen/_setjmp.S		1.6

	Replace the stack unwinding by a much simpler solution taken from
	../../arch/sparc/gen/_setjmp.S rev. 1.6. This ended up to be
	~identical to the OpenBSD change triggered by the same sparc change.
	[martin, ticket #1020]

lib/libc/arch/x86_64/gen/swapcontext.S 		1.3

	Use correct stack offsets after pushing values onto it.
	PR#28486.
	[hira, ticket #1029]

sys/net/if_media.c				1.23

	Add malloc_type M_IFMEDIA and use it for both malloc'ing and free'ing 
	ifmedia_entrys to prevent panic(9) in DIAGNOSTIC kernels.
	[dyoung, ticket #1030]

sys/arch/xen/i386/locore.S			1.7

	HYPERVISOR_yield is one of the hypervisor calls that's "overloaded";
	it does different things depending what's in %ebx.

	We weren't setting %ebx here *at all*; so we did not get
	SCHEDOP_yield, which was what was wanted; so unpredictable things
	happened, notably immediate return to the NetBSD idle loop, in
	other words spinning on CPU.
	[tls, ticket #1043]

sys/arch/xen/i386/machdep.c			1.11

	Terminate the domain on RB_HALT, not just on reboot.  This avoids
	looping around a cngetc() that will never return while "halted".
	[tls, ticket #1045]

sys/arch/sh3/sh3/mmu.c				1.10
sys/arch/sh3/sh3/mmu_sh3.c			1.7
sys/arch/sh3/sh3/mmu_sh4.c			1.8

	Protect accesses to PTE/TLB registers with 
	_cpu_exception_suspend()/_cpu_exception_resume() pair. Prevents 
	spontaneous reboot under heavy load
	[tsutsui, ticket #1072]

sys/nfs/nfsnode.h				patch
sys/nfs/nfs_vnops.c				patch

	nfs_lookup: check n_nctime for positive entries as well to improve
	cache consistency.
	[yamt, ticket #1077]

sys/nfs/nfs.h					patch
sys/nfs/nfs_socket.c				patch
sys/nfs/nfs_var.h				patch
sys/nfs/nfs_vnops.c				patch
sys/nfs/nfsm_subs.h				patch

	Don't do kludge for a reply to a retransmitted request
	unless we actually retransmitted the request.
	[yamt, ticket #1078]

sys/nfs/nfs_subs.c				1.140
sys/nfs/nfsnode.h				1.53

	Invalidate cache if filesize is changed besides our activity
	because it means that were out of sync with the server.
	[yamt, ticket #1079]

sys/dev/ic/tulip.c				1.130

	Silence the 'receive process failed to idle' message on the Davicom 
	DM9102A.
	[sketch, ticket #1084]

usr.sbin/ypserv/ypinit/ypinit.sh		1.12

	Fix a bug which caused "ypinit" to die with a strange error message
	if "/var/yp/binding" does not exist.
	[tron, ticket #893]

sys/dev/pci/if_wm.c				1.79 via patch
sys/dev/pci/if_wmreg.h				1.13

	Largest Tx descriptor buffer size is actually 4K.
	[thorpej, ticket #898]

sys/dev/pci/if_wm.c				1.80 via patch

	Restructure the loop in wm_start() that passes over the
	DMA map segments slightly to make it easier to drop in
	errata work-arounds that require adding extra descriptors
	onto the end of the packet.
	[thorpej, ticket #899]

dist/ntp/ntpd/ntp_io.c				1.11
dist/ntp/ntpd/ntp_proto.c			1.4

	Fix core dump problem if local system and ntp server do
	not have overlapping protocol family support (IPv4 vs.
	IPv6).  Instead, report server as unreachable, and ignore
	entry.  Fixes PR#27137.
	[christos, ticket #901]

sys/kern/sysv_sem.c				1.55

	Update sem_otime on successful call to semop().
	Fixes long-standing bug in the SYSV semaphore code which
	causes an example in Stevens' UNPv2 to fail when trying
	to compensate for a race condition in a file locking
	implementation.
	[briggs, ticket #903]

x11/Xserver/Makefile				1.13
x11/Xserver/Makefile.common			1.19
x11/Xserver/miext/Makefile			1.2
x11/Xserver/miext/shadow/Makefile		1.3
x11/Xserver/miext/shadow/Makefile.shadow	1.1 (new)
x11/Xserver/miext/shadow/module/Makefile	1.1 (new)
x11/Xserver/miext/layer/Makefile		1.3
x11/Xserver/miext/layer/Makefile.layer		1.1 (new)
x11/Xserver/miext/layer/module/Makefile		1.1 (new)
distrib/sets/lists/xserver/md.amd64		1.9
distrib/sets/lists/xserver/md.cats		1.5
distrib/sets/lists/xserver/md.i386		1.25
distrib/sets/lists/xserver/md.macppc		1.17
distrib/sets/lists/xserver/md.sgimips		1.7

	Build and install libshadow.a and liblayer.a.
	Fixes PR#27156.
	[rtr, tickets 905, 906, 907]

etc/rc.d/syslogd				1.15

	Use "load_rc_config `basename chrootdirscript`" in a subshell
	to determine the rc.conf(5) setting for chrootdirscript, incase
	the configuration for that is in /etc/rc.conf.d/chrootdirscript.
	Fixes PR#26478.
	[lukem, ticket #912]

usr.bin/passwd/krb5_passwd.c			1.12

	Switch to krb5_set_password that can handle the RFC3244 (as
	well as the older change password protocol).  Should enable
	changing password in a Windows2000 (or later) domain.
	[lha, ticket #917]

sys/arch/sparc64/dev/auxio.c			1.13

	In auxio_blink(), only toggle the AUXIO_LED_LED bit, don't
	clear the others.  It looks like bit 3 control the on-board
	le's link test, clearing it breaks the interface (no link
	detected on the remote end). Bit 3 is defined as AUXIO4M_LTE
	(link-test enable) for sun4m systems (maybe all the AUXIO4M_*
	bits are valid on the Ultra/1 too?).
	Tested on Ultra/1 and Ultra/5.  Fixes PR#25039.
	[bouyer, ticket #924]

lib/libc/citrus/citrus_mmap.c			1.2

	Correct check for mmap return value.  Also clean up
	the error path, convert to KNF, and use the proper stat
	macro.  Fixes PR#27283.
	[christos, ticket #931]

sys/fs/smbfs/smbfs_vnops.c			1.45

	Import a change from FreeBSD: use DENYNONE to give unixy
	semantics of permitting everything not forbidden by
	permissions.  I.e. denial is up to the server with
	clients/openers needing to use advisory locks for further
	control.  Fixes file access problem when the file is already
	open on the server.
	[peter, ticket #933]


sys/arch/alpha/a12/if_ade.c			1.23
sys/arch/amiga/dev/if_ed.c			1.46
sys/arch/amiga/dev/if_es.c			1.35
sys/arch/mac68k/dev/if_mc.c			1.24
sys/arch/mac68k/dev/if_sn.c			1.35
sys/arch/mac68k/nubus/if_netdock_nubus.c	1.5
sys/arch/macppc/dev/am79c950.c			1.16
sys/arch/macppc/dev/if_bm.c			1.23
sys/arch/macppc/dev/if_gm.c			1.23
sys/arch/mips/alchemy/dev/if_aumac.c		1.12
sys/arch/newsmips/apbus/if_sn.c			1.15
sys/arch/next68k/dev/mb8795.c			1.34
sys/arch/playstation2/dev/if_smap.c		1.6
sys/arch/powerpc/ibm4xx/dev/if_emac.c		1.19
sys/arch/sgimips/hpc/if_sq.c			1.21
sys/arch/sun3/dev/if_ie.c			1.40
sys/dev/bi/if_ni.c				1.23
sys/dev/i2o/iopl.c				1.14
sys/dev/ic/aic6915.c				1.12
sys/dev/ic/atw.c				1.80
sys/dev/ic/awi.c				1.66
sys/dev/ic/cs89x0.c				1.15
sys/dev/ic/dp8390.c				1.54
sys/dev/ic/dp83932.c				1.10
sys/dev/ic/elink3.c				1.108
sys/dev/ic/elinkxl.c				1.75
sys/dev/ic/gem.c				1.32
sys/dev/ic/hme.c				1.43
sys/dev/ic/i82557.c				1.88
sys/dev/ic/i82586.c				1.49
sys/dev/ic/smc91cxx.c				1.49
sys/dev/ic/i82596.c				1.3
sys/dev/ic/lance.c				1.30
sys/dev/ic/lemac.c				1.26
sys/dev/ic/mb86960.c				1.58
sys/dev/ic/mtd803.c				1.6
sys/dev/ic/rtl81x9.c				1.47
sys/dev/ic/seeq8005.c				1.36
sys/dev/ic/sgec.c				1.23
sys/dev/ic/smc83c170.c				1.56
sys/dev/ic/wi.c					1.188
sys/dev/pci/if_bge.c				1.77
sys/dev/pci/if_de.c				1.112
sys/dev/pci/if_dge.c				1.7
sys/dev/pci/if_pcn.c				1.24
sys/dev/pci/if_re.c				1.6
sys/dev/pci/if_sip.c				1.96
sys/dev/pci/if_sk.c				1.12
sys/dev/pci/if_ste.c				1.20
sys/dev/pci/if_stge.c				1.22
sys/dev/pci/if_tl.c				1.66
sys/dev/pci/if_txp.c				1.8
sys/dev/pci/if_vr.c				1.70
sys/dev/pci/if_wm.c				1.83
sys/dev/pcmcia/if_cnw.c				1.29
sys/dev/pcmcia/if_ray.c				1.54
sys/dev/qbus/if_qe.c				1.58
sys/dev/sbus/be.c				1.44
sys/dev/sbus/qe.c				1.33
sys/dev/scsipi/if_se.c				1.51
sys/dev/usb/if_aue.c				1.88
sys/dev/usb/if_udav.c				1.4
sys/dev/usb/if_url.c				1.12

	When adding or deleting multicast addresses, only change
	the address filter if the interface is marked RUNNING.
	Fixes PR#27678.
	[thorpej, ticket #939]

sys/dev/ic/tulip.c				1.129

	When adding or deleting multicast addresses, only change
	the address filter if the interface is marked RUNNING.
	Fixes PR#27678.
	[thorpej, ticket #940]

sys/dve/isa/if_iy.c				1.65

	When adding or deleting multicast addresses, only change
	the address filter if the interface is marked RUNNING.
	Fixes PR#27678.
	[thorpej, ticket #941]

sys/dev/qbus/if_qt.c				1.5

	In qtinit(), don't skip initialization if the interface is
	already RUNNING.  ether_ioctl() will call (*if_init)() when
	flags change.  Instead, do what other drivers do, and stop
	the interface in this case before re-initializing.
	In qtioctl(), now that qtinit() does the right thing, remove
	the check for the IFF_PROMISC change.
	When adding or deleting multicast addresses, only change
	the address filter if the interface is marked RUNNING.
	Fixes PR#27678.
	[thorpej, ticket #942]

sys/dev/ic/i82596.c				1.4

	Make iee_ioctl() look more like other drivers, and fix a
	missing splx(s) as a side-effect.  Don't bother handling
	IFF_PROMISC here, because ether_ioctl() already calls
	(*if_init)() to handle flag changes.
	When adding or deleting multicast addresses, only change
	the address filter if the interface is marked RUNNING.
	Fixes PR#27678.
	[thorpej, ticket #943]

sys/dev/pci/auvia.c				1.43
sys/dev/pci/auviavar.h				1.6

	Add support for suspending/resuming.  Fixes PR#26432.
	[kent, ticket #949]

bin/pax/options.c				1.82

	Fix broken cpio(1) option handling:
	 o "cpio -i -t" should list the contents of a file, not
	   extract it.
	 o Don't extract a file when only option "-d" is given.
	Fixes PR#26513.
	[tron, ticket #952]

sys/netinet6/ipsec.c				1.98-1.99

	Add a missing break.
	[itojun, ticket #954]

usr.sbin/syslogd/syslogd.c			1.68

	Postpone initial setting of the alarm timer until after
	the call to daemon(), as the timer would be cleared by
	deamon's fork().  Fixes PR#19558.
	[heas, ticket #958]

sys/dev/pci/cs4281.c				1.21

	Make recording of clct(4) work, namely:
	 o cs_4281_intr: advance a pointer after copying data
	 o cs_4281_trigger_input: fix an inverted condition about
	   dma mode
	[yamt, ticket #967]

sys/nfs/nfs_bio.c				1.122
sys/nfs/nfs_subs.c				1.138
sys/nfs/nfsnode.h				1.50

	Since daddr_t is 64-bit these days, simply use nfs directory
	cookies as buffer cache indexes.  This should make the
	regress/sys/fs/getdents test work.  Fixes PR#27112.
	[yamt, ticket #968]

xsrc/xfree/xc/programs/xdm/config/Imakefile	1.4 
xsrc/xfree/xc/programs/xdm/config/NetBSD.xpm	1.1 (new)
xsrc/xfree/xc/programs/xdm/config/NetBSDbw.xpm	1.1 (new)
xsrc/xfree/xc/programs/xdm/config/NetBSDinv.xpm 1.1 (new)
x11/bin/xdm/config/Makefile			1.10 via patch
distrib/sets/lists/xetc/mi			patch
distrib/sets/lists/xbase4/mi			1.14 via patch

	Add new NetBSD logo pixmaps.
	[jschauma, ticket #978]

sys/dist/ipf/netinet/fil.c			1.7 (new)
sys/dist/ipf/netinet/ip_auth.c			1.2 (new)
sys/dist/ipf/netinet/ip_auth.h			1.1 (new)
sys/dist/ipf/netinet/ip_compat.h		1.3 (new)
sys/dist/ipf/netinet/ip_fil.h			1.1 (new)
sys/dist/ipf/netinet/ip_fil_netbsd.c		1.3 (new)
sys/dist/ipf/netinet/ip_frag.c			1.1 (new)
sys/dist/ipf/netinet/ip_frag.h			1.1 (new)
sys/dist/ipf/netinet/ip_ftp_pxy.c		1.4 (new)
sys/dist/ipf/netinet/ip_h323_pxy.c		1.1 (new)
sys/dist/ipf/netinet/ip_htable.c		1.1 (new)
sys/dist/ipf/netinet/ip_htable.h		1.1 (new)
sys/dist/ipf/netinet/ip_ipsec_pxy.c		1.1 (new)
sys/dist/ipf/netinet/ip_irc_pxy.c		1.2 (new)
sys/dist/ipf/netinet/ip_log.c			1.1 (new)
sys/dist/ipf/netinet/ip_lookup.c		1.1 (new)
sys/dist/ipf/netinet/ip_lookup.h		1.1 (new)
sys/dist/ipf/netinet/ip_nat.c			1.3 (new)
sys/dist/ipf/netinet/ip_nat.h			1.2 (new)
sys/dist/ipf/netinet/ip_netbios_pxy.c		1.1 (new)
sys/dist/ipf/netinet/ip_pool.c			1.1 (new)
sys/dist/ipf/netinet/ip_pool.h			1.1 (new)
sys/dist/ipf/netinet/ip_pptp_pxy.c		1.1 (new)
sys/dist/ipf/netinet/ip_proxy.c			1.1 (new)
sys/dist/ipf/netinet/ip_proxy.h			1.1 (new)
sys/dist/ipf/netinet/ip_raudio_pxy.c		1.1 (new)
sys/dist/ipf/netinet/ip_rcmd_pxy.c		1.4 (new)
sys/dist/ipf/netinet/ip_rpcb_pxy.c		1.4 (new)
sys/dist/ipf/netinet/ip_scan.c			1.2 (new)
sys/dist/ipf/netinet/ip_scan.h			1.1 (new)
sys/dist/ipf/netinet/ip_state.c			1.2 (new)
sys/dist/ipf/netinet/ip_state.h			1.1 (new)
sys/dist/ipf/netinet/ip_sync.c			1.1 (new)
sys/dist/ipf/netinet/ip_sync.h			1.1 (new)
sys/dist/ipf/netinet/ipl.h			1.1 (new)
sys/netinet/fil.c				deleted
sys/netinet/ip_auth.c				deleted
sys/netinet/ip_auth.h				deleted
sys/netinet/ip_compat.h				deleted
sys/netinet/ip_fil.h				deleted
sys/netinet/ip_fil_netbsd.c			deleted
sys/netinet/ip_frag.c				deleted
sys/netinet/ip_frag.h				deleted
sys/netinet/ip_ftp_pxy.c			deleted
sys/netinet/ip_h323_pxy.c			deleted
sys/netinet/ip_htable.c				deleted
sys/netinet/ip_htable.h				deleted
sys/netinet/ip_ipsec_pxy.c			deleted
sys/netinet/ip_irc_pxy.c			deleted
sys/netinet/ip_log.c				deleted
sys/netinet/ip_lookup.c				deleted
sys/netinet/ip_lookup.h				deleted
sys/netinet/ip_nat.c				deleted
sys/netinet/ip_nat.h				deleted
sys/netinet/ip_netbios_pxy.c			deleted
sys/netinet/ip_pool.c				deleted
sys/netinet/ip_pool.h				deleted
sys/netinet/ip_pptp_pxy.c			deleted
sys/netinet/ip_proxy.c				deleted
sys/netinet/ip_proxy.h				deleted
sys/netinet/ip_raudio_pxy.c			deleted
sys/netinet/ip_rcmd_pxy.c			deleted
sys/netinet/ip_rpcb_pxy.c			deleted
sys/netinet/ip_scan.c				deleted
sys/netinet/ip_scan.h				deleted
sys/netinet/ip_state.c				deleted
sys/netinet/ip_state.h				deleted
sys/netinet/ip_sync.c				deleted
sys/netinet/ip_sync.h				deleted
sys/netinet/ipl.h				deleted
sys/lkm/netinet/if_ipl/Makefile			1.17
sys/lkm/netinet/if_ipl/mln_ipl.c		1.35
dist/ipf/ip_fil.c				1.4
dist/ipf/l4check/l4check.c			1.2
dist/ipf/lib/addicmp.c				1.2-1.4
dist/ipf/lib/getportproto.c			1.2-1.4
dist/ipf/lib/getproto.c				1.2
dist/ipf/lib/hexdump.c				1.2
dist/ipf/lib/hostnum.c				1.2-1.4
dist/ipf/lib/icmpcode.c				1.2-1.4
dist/ipf/lib/inet_addr.c			1.2
dist/ipf/lib/ipft_hx.c				1.2-1.4
dist/ipf/lib/ipft_tx.c				1.2-1.4
dist/ipf/lib/natparse.c				1.2
dist/ipf/lib/parse.c				1.2
dist/ipf/lib/portnum.c				1.2-1.4
dist/ipf/lib/ports.c				1.2-1.4
dist/ipf/lib/printbuf.c				1.2-1.4
dist/ipf/lib/printsbuf.c			1.2
dist/ipf/lib/var.c				1.4
dist/ipf/tools/ipfstat.c			1.7-1.8
dist/ipf/tools/ipmon.c				1.5
dist/ipf/tools/ipnat_y.y			1.6-1.8
dist/ipf/tools/ipscan_y.y			1.2
dist/ipf/tools/lexer.c				1.8-1.9
dist/ipf/iplang/iplang_y.y			1.6
dist/ipf/ipsd/sbpf.c				1.3
dist/ipf/ipsd/sdlpi.c				1.3
dist/ipf/ipsend/ipsend.c			1.10-1.12
dist/ipf/ipsend/sbpf.c				1.5-1.6
dist/ipf/ipsend/sdlpi.c				1.4
dist/ipf/ipf2netbsd				1.16-1.17
usr.sbin/ipf/Makefile.inc			1.14
usr.sbin/ipf/ipfstat/Makefile			1.19
usr.sbin/ipf/ipftest/Makefile			1.29-1.30
usr.sbin/ipf/ipsend/Makefile			1.24
usr.sbin/ipf/ipmon/Makefile			1.21
distrib/sets/lists/man/mi			1.745
regress/sys/kern/ipf/expected/ni10		1.2
regress/sys/kern/ipf/expected/ni11		1.2
sys/arch/acorn26/conf/Makefile.acorn26		patch
sys/arch/acorn32/conf/Makefile.acorn32		patch
sys/arch/alpha/conf/Makefile.alpha		patch
sys/arch/amd64/conf/Makefile.amd64		patch
sys/arch/amiga/conf/Makefile.amiga		patch
sys/arch/amigappc/conf/Makefile.amigappc	patch
sys/arch/arc/conf/Makefile.arc.inc		patch
sys/arch/arm/conf/Makefile.arm			patch
sys/arch/atari/conf/Makefile.atari		patch
sys/arch/cats/conf/Makefile.cats.inc		patch
sys/arch/cesfic/conf/Makefile.cesfic		patch
sys/arch/dreamcast/conf/Makefile.dreamcast.inc	patch
sys/arch/evbarm/conf/Makefile.evbarm.inc	patch
sys/arch/evbmips/conf/Makefile.evbmips.inc	patch
sys/arch/evbppc/conf/Makefile.evbppc.inc	patch
sys/arch/hp300/conf/Makefile.hp300		patch
sys/arch/hp700/conf/Makefile.hp700		patch
sys/arch/hpcarm/conf/Makefile.hpcarm		patch
sys/arch/luna68k/conf/Makefile.luna68k		patch
sys/arch/mac68k/conf/Makefile.mac68k		patch
sys/arch/mips/conf/Makefile.mips		patch
sys/arch/mipsco/conf/Makefile.mipsco.inc	patch
sys/arch/mmeye/conf/Makefile.mmeye.inc		patch
sys/arch/mvme68k/conf/Makefile.mvme68k		patch
sys/arch/netwinder/conf/Makefile.netwinder.inc	patch
sys/arch/news68k/conf/Makefile.news68k		patch
sys/arch/next68k/conf/Makefile.next68k		patch
sys/arch/pc532/conf/Makefile.pc532		patch
sys/arch/pdp10/conf/Makefile.pdp10		patch
sys/arch/playstation2/conf/Makefile.playstation2.inc		patch
sys/arch/pmax/conf/Makefile.pmax.inc		patch
sys/arch/powerpc/conf/Makefile.powerpc		patch
sys/arch/sbmips/conf/Makefile.sbmips.inc	patch
sys/arch/sgimips/conf/Makefile.sgimips.inc	patch
sys/arch/sh3/conf/Makefile.sh3			patch
sys/arch/sh5/conf/Makefile.sh5			patch
sys/arch/shark/conf/Makefile.shark.inc		patch
sys/arch/sparc/conf/Makefile.sparc		patch
sys/arch/sparc64/conf/Makefile.sparc64		patch
sys/arch/sun2/conf/Makefile.sun2		patch
sys/arch/sun3/conf/Makefile.sun3		patch
sys/arch/vax/conf/Makefile.vax			patch
sys/arch/x68k/conf/Makefile.x68k		patch
sys/arch/xen/conf/Makefile.xen			patch
sys/netinet/Makefile				patch
sys/netinet/files.ipfilter			patch

	Move ipf to sys/dist/ipf and sync w. trunk
	[martti, ticket #1086]

usr.sbin/sup/source/scm.c			1.18

	Dont set AI_NUMERICHOST in matchhost() to resolve given hostname since 
	it is supposed to be an arbitrary name (i.e. not restricted to numeric
	representation). PR#27047
	[soda, ticket #892]

sys/arch/alpha/conf/GENERIC			patch

	Cleanup audio and add USB-2 devices
	[reinoud, ticket #913]

usr.bin/sed/compile.c				1.31

	When adding text due to an a, c, or i command, don't eat the space(s) at
	the beginning of the lines since the addition is supposed to be 
	'verbatim'. Fix a comment for compile_text indicating it's also used 
	for the 'c' command.
	[matt, ticket #982]

sys/dev/ata/wd.c				1.297

	Some drives reports ATA version < 4, and still support (and need) the
	WDCC_FLUSHCACHE command. So for drive < ATA4, test WDC_CMD2_FC in 
	atap_cmd_set2 before returning ENODEV.
	[bouyer, ticket #986]

sys/dist/ipf/netinet/ip_state.c			1.3

	Disable the oow test because it is broken. It is killing valid packets.
	[martti, ticket #1098]

sys/arch/powerpc/powerpc/trap.c			1.105 via patch

	If setfault() returns nonzero (i.e. we trapped), make sure to
	unsetusr().
	[matt, ticket #987]

distrib/sets/lists/xserver/md.sgimips		1.8

	Correct set lists for sgimips.
	[rtr, ticket #993]

usr.bin/vi/vi/v_txt.c				1.12
usr.bin/vi/ex/version.h				1.17

	Move a line of code which was "obviously" misplaced.  Fixes
	a core dump when auto-completing file names and at least
	one of the file names is larger than the screen width.
	Fixes PR#28382.  Bump version.
	[aymeric, ticket #1000]

sys/dev/pci/if_wm.c				1.85

	Also toggle the second port's Ethernet address lsb on the
	WM_T_82546_3, so the two ports get different MAC addresses.
	[thorpej, ticket #1001]

usr.sbin/ifwatchd/ifwatchd.c			1.20
usr.sbin/ifwatchd/ifwatchd.8			1.21-1.23

	In the initial interface scan at start time, query the link
	status of the interfaces and call the CARRIER script if a link
	is already there.  Fixes PR#26830.
	[martin, ticket #1003]

sys/dev/dmover/dmover_io.c			1.14
sys/kern/kern_systrace.c			1.41

	Fix the fcntl entry points; ``cmd'' is a command, not the
	flags themselves.
	[thorpej, ticket #1008]

xsrc/xfree/xc/programs/Xserver/hw/xfree86/common/compiler.h		1.18
xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/chips/util/AsmMacros.h 1.3
xsrc/xfree/xc/programs/Xserver/hw/xfree86/int10/generic.c	1.1.1.7 -> 1.2
xsrc/xfree/xc/programs/Xserver/hw/xfree86/loader/xf86sym.c		1.8
xsrc/xfree/xc/programs/Xserver/hw/xfree86/os-support/bsd/arm_video.c	1.5
xsrc/xfree/xc/programs/Xserver/hw/xfree86/os-support/bsd/mips_video.c	1.2
x11/Xserver/hw/xfree86/bin/kbd_mode/Makefile	1.2
x11/Xserver/hw/xfree86/bin/xf86cfg/Makefile	1.5
x11/Xserver/hw/xfree86/bin/xf86config/Makefile	1.5
x11/Xserver/hw/xfree86/xf86/Makefile		1.6
x11/Xserver/hw/xfree86/xf86_os/Makefile		1.9
x11/bin/xdm/config/Makefile			1.11

	Fixes for NetBSD/cats:
	 o Make sure IOPortBase is defined in the server
	 o Stop the int10 module from trying to do unaligned accesses
	 o Add VT switching support to cats port
	Also, make sure x11 still builds for sgimips.
	[skrll, ticket #1009]

etc/etc.amiga/Makefile.inc			1.24

	Ensure ISDN kernels are built for future releases.
	[is, ticket #1010]

sys/arch/amiga/conf/MDINSTALL			1.18

	Remove use of ``idesc'', use ``wdc'' instead.
	[is, ticket #1011]

sys/kern/kern_descrip.c				1.128 (via patch)

	Avoid endless loop in F_CLOSEM fnctl which could be abused for a
	local DoS. This fixes PR kern/28929.
	[cube, ticket #1089]

sys/arch/amd64/amd64/copy.S			1.2
sys/arch/i386/i386/locore.S			1.33

	Check the passed in address as well as determining the maximum length
	using VM_MAXUSER_ADDRESS in copyinstr and copyoutstr.
	[fvdl, ticket #1317]

sys/nfs/nfs_subs.c				1.146

	nfs_clearcommit: don't attempt to clear commit info (n_pushlo, etc)
	unless the vnode is of VREG. union members used to keep commit info
	are used for other purposes in the case of !VREG.
	[yamt, ticket #1148]

sys/arch/sparc/stand/common/mmu.c		1.5

	Make pmap_map() work on sun4 machines.
	[pk, ticket #1118]

sys/nfs/nfs_vnops.c				1.206

	nfs_commit: use NAC_NOTRUNC when loading an attribute
	as we're called holding pages locked.
	[yamt, ticket #1134]

sys/uvm/uvm_amap.c				1.57
sys/uvm/uvm_pdaemon.c				1.61

	Hack around a UVM problem that causes hangs when large processes fork.
	see PR 26908 for details.
	[chs, ticket #1137]

sys/arch/sparc/sparc/trap.c			1.156

	sun4c hardware reports faults by the atomic load/store instructions as
	read faults even if the problem was that the memory was read-only.
	Detect this case and relabel the fault as both read and write.
	Part of PR 25633, PR 25896.
	[chs, ticket #1158]

sys/sys/param.h                                 patch
share/tmac/doc-common                           patch
gnu/usr.bin/groff/tmac/mdoc.local               patch

	Welcome to 2.0.2

sys/arch/sparc/include/lock.h			1.18

	Add the early-clobber modifier on the destination reg of ldstub.
	In some implementations (eg. sun4c), the hardware modifies the
	destination reg before checking for write permission on the memory
	location. Without this change, gcc was using the same register for
	the address and the destination, so if the store part of the
	instruction faulted, the address was already gone when the instruction
	was retried after resolving the fault. Part of PR 25633, PR 25896.
	[chs, ticket #1159]

gnu/usr.bin/groff/tmac/mdoc.local		1.19 via patch

	Teach groff about NetBSD 1.6.3 (used by njs(4), noted by tron).
	[wiz, ticket #1167]

sys/nfs/nfs_vnops.c				1.219

	nfs_readdirrpc, nfs_readdirplusrpc:
	Avoid infinite loops when getting readdir response without
	any entries or EOF. PR/28971.
	[yamt, ticket #1208]

sys/arch/sun3/include/param3.h                  1.50

	Bring back the sun3 MAXPHYS definition that has been missing for
	8 years. More recently, we changed to relying on MAXPHYS rather
	than MAXBSIZE to limit page cache I/O sizes, and sun3 has been
	broken since then.
	[chs, ticket #1229]

sys/kern/vfs_lookup.c				1.57

	Adjust error case handling. If the VOP_LOOKUP() call unlocked the
	parent directory node, remember that.
	[wrstuden, ticket #1298]

sys/dev/pci/pciide_common.c			1.22
sys/dev/pci/pciidevar.h				1.26

	Move bus_dma setup out of pciide_dma_init() in a new function,
	pciide_dma_dmamap_setup(), for the benefit of drivers that needs
	special registers setup in dmainit().
	[bouyer, ticket #1016]

share/mk/bsd.x11.mk				1.42
xfree/xc/config/cf/Imake.rules			1.6

	Modify CppRawFileTarget() to transform trailing backslashes in the
	input manpages so the backslash is followed by a blank, defeating the C
	preprocessor's tendency to remove the following newline (Thomas Dickey,
	Debian #259996). This is a partial fix for our PR misc/28444.
	[fredb, ticket #1017]

sys/arch/xen/i386/locore.S			1.10

	Sync with i386/locore.S 1.33:
	Check the passed in address as well as determining the maximum length
	using VM_MAXUSER_ADDRESS in copyinstr and copyoutstr.
	[bouyer, ticket #1321]

xsrc/xfree/xc/extras/Xpm/lib/Attrib.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/CrDatFrI.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/hashtab.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/parse.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/scan.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/CrBufFrI.c		1.3
xsrc/xfree/xc/extras/Xpm/lib/RdFToI.c		1.3
xsrc/xfree/xc/extras/Xpm/lib/WrFFrI.c		1.3
xsrc/xfree/xc/extras/Xpm/lib/XpmI.h		1.3
xsrc/xfree/xc/extras/Xpm/lib/data.c		1.3
xsrc/xfree/xc/extras/Xpm/lib/xpm.h		1.3
xsrc/xfree/xc/extras/Xpm/lib/Imakefile		1.2
xsrc/xfree/xc/extras/Xpm/lib/RdFToBuf.c		1.2
xsrc/xfree/xc/extras/Xpm/lib/WrFFrBuf.c		1.2
xsrc/xfree/xc/extras/Xpm/lib/misc.c		1.2
xsrc/xfree/xc/extras/Xpm/lib/create.c		1.6

        Import latest Xpm sources from OpenBSD:
          o Changes from X.Org 6.8.2 RC1
          o Fix security problems reported in CAN-2005-0605
        [tron, ticket #1304]

sys/sys/param.h                                 patch
share/tmac/doc-common                           patch
gnu/usr.bin/groff/tmac/mdoc.local               patch

        Note that 2.0.2 exists but this branch is 2.0_STABLE until 2.1
	releases.

distrib/notes/sparc64/install			1.24-1.25

	Add description for Solaris 10 dual boot installation from Ben Collver
	in PR port-sparc64/29703.
	[martin, ticket #1322]

sys/dev/ata/ata_wdc.c				1.55
sys/dev/ata/atavar.h				1.43
sys/dev/ic/wdc.c				1.180

	Only downgrade modes due to an actual CRC error.  Downgrading on other 
	errors is anti-social -- especially given that there's no way to 
	upgrade again short of rebooting.

	Also, downgrade UDMA modes more slowly.  It's entirely possible that 
	they're using an 80-wire cable, but it's just too long for the higher 
	modes, or there is minor crosstalk.
	[mycroft, ticket #1018]

gnu/dist/binutils/bfd/ChangeLog                 1.2 via patch
gnu/dist/binutils/bfd/elf64-sparc.c             1.4

	Fix bug in "binutils" which broke Firefox under NetBSD-sparc64.
	[skrll, ticket #1101]

sys/dev/ata/ata_wdc.c				1.77

	Move ata_dmaerr() so that it's called only when there really has been
	an error (ata_bio->r_error doesn't containt anything meaningfull if
	no error occured). Fix kern/28255 by Izumi Tsutsui, but with a
	different patch.
	[bouyer, ticket #1324]

sys/dev/ata/ata_wdc.c				1.78

	Also call ata_dmaerr() on DMA errors (as reported by the underlying
	controller driver). We want to downgrade to PIO mode if DMA isn't
	functionnal.
	[bouyer, ticket #1325]

sys/dev/tc/px.c					1.22

	Fix a 3 year old error which caused px_init() to fail. Fixes PR 28798.
	[mhitch, ticket #1063]

sys/netinet6/ipsec.c                            1.101

	Fix possible remote DoS via IPSec AH packets.
	[itojun, ticket #1327]

sys/arch/prep/prep/ibm_7043_140.c		1.4
sys/arch/prep/prep/machdep.c			1.52

	Ensure that the OpenPIC register window is mapped during
	the startup; only parts of the PCI memory space is mapped
	already.  Move initialization since it requires UVM.
	[jkunz, ticket 1152]

lib/libpthread/pthread.3			1.4

	Document PTHREAD_CONCURRENCY.
	[daniel, ticket #1166]

sys/arch/sparc/sparc/machdep.c			1.252
sys/arch/sparc64/sparc64/machdep.c		1.177
sys/kern/kern_sa.c				1.57 via patch
sys/sys/lwp.h					1.25 via patch

	Define a new LWP flag which indicates that we're in the process of
	doing a context switch.  use this on sparc and sparc64 to avoid trying
	to access user memory (writing the register windows back to the stack)
	in this case (since it's both unnecessary and wrong).
	[chs, ticket #1160]

sys/dev/cgd_crypto.c				1.4

	Clear freed memory.
	[dan, ticket #1343]

sys/arch/evbppc/conf/Makefile.ev64260.inc	1.3
sys/arch/evbppc/conf/Makefile.obs405.inc	1.2
sys/arch/evbppc/conf/Makefile.walnut.inc	1.3

	Can't depend on shell scripts being executable from CVS. Preface
	mkimg.sh with ${HOST_SH}
	[jmc, ticket #1350]

distrib/evbppc/md-kernel/Makefile		1.2

	One more place that needs $HOST_SH to run a script correctly.
	[jmc, ticket #1353]

sys/dev/pci/pdcsata.c				1.1 via patch
sys/dev/pci/files.pci				1.224 via patch
share/man/man4/pdcsata.4			1.1 (new)
share/man/man4/Makefile				1.336 via patch
distrib/sets/lists/man/mi			1.735
distrib/notes/i386/hardware			1.116
sys/arch/algor/conf/P4032			1.26
sys/arch/algor/conf/P5064			1.31
sys/arch/algor/conf/P6032			1.25
sys/arch/alpha/conf/ALPHA			1.197
sys/arch/alpha/conf/BASIL			1.28
sys/arch/alpha/conf/FRAU-FARBISSINA		1.33
sys/arch/alpha/conf/GENERIC			1.257 via patch
sys/arch/alpha/conf/INSTALL			1.82
sys/arch/amd64/conf/GENERIC			1.32
sys/arch/amd64/conf/INSTALL			1.21
sys/arch/amd64/conf/INSTALL_ACPI		1.13
sys/arch/amd64/conf/SIMICS			1.11
sys/arch/arc/conf/GENERIC			1.107
sys/arch/arc/conf/MIMORI			1.30
sys/arch/arc/conf/PCCONS			1.38
sys/arch/arc/conf/RAMDISK			1.51
sys/arch/atari/conf/MILAN.in			1.17
sys/arch/atari/conf/BOOT			regenerated
sys/arch/atari/conf/BOOTX			regenerated
sys/arch/atari/conf/ATARITT			regenerated
sys/arch/atari/conf/FALCON			regenerated
sys/arch/atari/conf/HADES			regenerated
sys/arch/atari/conf/MILAN-ISAIDE		regenerated
sys/arch/atari/conf/MILAN-PCIIDE		regenerated
sys/arch/cats/conf/GENERIC			1.71
sys/arch/cats/conf/INSTALL			1.42
sys/arch/cobalt/conf/GENERIC			1.64
sys/arch/evbarm/conf/ADI_BRH			1.22
sys/arch/evbarm/conf/INTEGRATOR			1.32
sys/arch/evbarm/conf/IQ31244			1.18
sys/arch/evbarm/conf/SMDK2800			1.18
sys/arch/evbarm/conf/IQ80310			1.40
sys/arch/evbarm/conf/IQ80321			1.35
sys/arch/evbmips/conf/MALTA			1.24
sys/arch/evbppc/conf/EV64260			1.16
sys/arch/evbppc/conf/OPENBLOCKS266		1.12
sys/arch/evbppc/conf/WALNUT			1.15
sys/arch/i386/conf/DELPHI			1.45
sys/arch/i386/conf/GENERIC			1.641
sys/arch/i386/conf/GENERIC_LAPTOP		1.121
sys/arch/i386/conf/INSTALL			1.254
sys/arch/i386/conf/INSTALL_LAPTOP		1.74
sys/arch/i386/conf/IOPENER			1.53
sys/arch/i386/conf/SWINGER			1.57
sys/arch/macppc/conf/GENERIC			1.185
sys/arch/macppc/conf/INSTALL			1.80
sys/arch/sandpoint/conf/GENERIC.sandpoint	1.18
sys/arch/sparc64/conf/GENERIC32			1.91
sys/arch/sparc64/conf/POWEROFSEVEN.inc		1.28
sys/arch/sparc64/conf/SPLODE			1.27

	Add pdcsata(4), a driver for the Promise SATA150 (aka
	PDC203xx) series of controllers.
	[bouyer, ticket #1019]

sys/dev/ic/iha.c				1.26

	When checking the CDB length, check against the field
	in the SCB that we're actually storing it to.
	[thorpej, ticket #1021]

sys/arch/arc/dti/btl.c				1.15
sys/arch/arc/dti/btlreg.h			1.5
sys/dev/eisa/ahb.c				1.41
sys/dev/eisa/ahbreg.h				1.12
sys/dev/ic/aha.c				1.45
sys/dev/ic/uhareg.h				1.10
sys/dev/ic/ahareg.h				1.10
sys/dev/ic/bha.c				1.60
sys/dev/ic/uha.c				1.33
sys/dev/isa/wds.c				1.59
sys/dev/isa/wdsreg.h				1.6

	Don't use "struct scsi_generic" in a hardware-defined
	structure.  Instead, use an array of 12 bytes.  Check the
	incoming CDB to see that it will fit, and print and error
	and fail the command if it won't.
	[thorpej, ticket #1022]

sys/dev/ic/bha.c				1.61

	Fix a straggling reference to "struct scsi_generic" in
	some debug-only code.
	[thorpej, ticket #1023]

distrib/sets/lists/base/md.hp300		1.38
share/mk/bsd.own.mk				1.427
sys/arch/hp300/stand/Makefile.buildboot		1.25
sys/arch/hp300/stand/mkboot/Makefile		1.10
sys/arch/hp300/stand/mkboot/mkboot.c		1.7
tools/Makefile					1.86 (via patch)
tools/hp300-mkboot/Makefile			1.1 (new)

	Convert mkboot into a full cross tool.  Last hurdle for
	hp300 to building on non NetBSD/bsd hosts.
	[jmc, ticket #1025]

lib/libc/stdlib/heapsort.c			1.15
share/mk/bsd.own.mk				1.426
sys/arch/amiga/stand/bootblock/Makefile.booters	1.5
sys/arch/amiga/stand/bootblock/Makefile.inc	1.1 (new)
sys/arch/amiga/stand/bootblock/aout2bb/Makefile	1.6
sys/arch/amiga/stand/bootblock/aout2bb/aout2bb.c 1.10
sys/arch/amiga/stand/bootblock/aout2bb/chksum.c	1.4
sys/arch/amiga/stand/bootblock/elf2bb/Makefile	1.2
sys/arch/amiga/stand/bootblock/elf2bb/chksum.c	1.2
sys/arch/amiga/stand/bootblock/elf2bb/elf2bb.c	1.9
sys/arch/amiga/stand/bootblock/txlt/Makefile	1.7
tools/Makefile					1.85
tools/amiga-aout2bb/Makefile			1.1 (new)
tools/amiga-aout2bb/machine/aout_machdep.h	1.1 (new)
tools/amiga-aout2bb/sys/exec_aout.h		1.1 (new)
tools/amiga-elf2bb/Makefile			1.1 (new)
tools/amiga-elf2bb/sys/exec_elf.h		1.1 (new)
tools/amiga-txlt/Makefile			1.1 (new)
tools/compat/Makefile				1.32
tools/compat/compat_defs.h			1.44
tools/compat/configure				1.49 (via patch)
tools/compat/configure.ac			1.48 (via patch)

	Convert remaining host tools for amiga to correct cross tools.
	Now allows complete amiga builds on non-NetBSD and non-BSD hosts.
	[jmc, ticket #1026]

distrib/sets/lists/base/md.bebox		1.13
share/mk/bsd.own.mk				1.425
sys/arch/bebox/stand/Makefile.inc		1.1 (new)
sys/arch/bebox/stand/boot/Makefile		1.21
sys/arch/bebox/stand/elf2pef/Makefile		1.4
sys/arch/bebox/stand/elf2pef/elf2pef.c		1.10
sys/arch/bebox/stand/mkbootimage/mkbootimage.c	1.4
sys/arch/bebox/stand/mkbootimage/Makefile	1.4
tools/bebox-elf2pef/Makefile			1.1 (new)
tools/bebox-elf2pef/sys/exec_elf.h		1.1 (new)
tools/bebox-mkbootimage/Makefile		1.1 (new)
tools/Makefile					1.84

	Convert bebox's remaining host tools over to the cross tools
	scheme.  Now allows complete bebox builds on non-NetBSD and
	non-BSD hosts.
	[jmc, ticket #1027]

etc/etc.sgimips/Makefile.inc			1.11
sys/arch/sgimips/include/disklabel.h		1.7
sys/arch/sgimips/sgimips/disksubr.c		1.14
sys/arch/sgimips/stand/sgivol/sgivol.c		1.9
sys/sys/bootblock.h				1.34

	Pull host/arch native label information into bootblock.h. Therefore
	pieces of this are accessible from host tools.
	Retool sgivol into a proper hostool that doesn't depend on disklabel.h.
	Assume defaults for file images that match what a vnd would have used.
	Native use will still use the standard NetBSD label to get this data.
	Fixes PR#25996.
	[jmc, ticket #1028]

x11/bin/xinit/Makefile				1.6
xsrc/xfree/xc/programs/xman/man.c		1.2
xsrc/xfree/xc/programs/xman/misc.c		1.5

	Adjust these to not use MACHINE and instead pull it from uname(3)
	instead. This means xbase.tgz can be shared across MACHINE_ARCH
	correctly now.
	Always set -DXFREE86 since all it does is add XFree86 as a possible X
	server to  the stderr list if exec fails for X. This allows xinit to
	be shared across MACHINE_ARCH for mipseb and powerpc now.
	[jmc, ticket #1033]

sys/ufs/ufs/ufs_bmap.c                          patch

	Fix a silent truncation problem that could cause corruption with large
	FFSv1 file systems.
	[mycroft, ticket #1035]

sys/nfs/files.nfs				1.4

	The macro used for static server address is NFS_BOOTSTATIC_SERVADDR,
	not NFS_BOOTSTATIC_SADDR. From Xen source distribution.
	[bouyer, ticket #1036]

sys/dev/raidframe/rf_desc.h			1.15
sys/dev/raidframe/rf_driver.c			1.105
sys/dev/raidframe/rf_driver.h			1.13
sys/dev/raidframe/rf_netbsdkintf.c		1.183
sys/dev/raidframe/rf_states.c			1.36

	On an idea from Thor (tls@), do not fail a component if doing so would
	render the RAID set completely dead.  Instead, we retry the IO a
	maximum of RF_RETRY_THRESHOLD times (currently '5'), and then just
	return an IO error if the IO fails.  This should reduce the damage
	caused by having multiple disks appear to fail when the culprit is
	really something else (power, controllers, etc.)
	[oster, ticket #1038]

sys/dev/raidframe/rf_netbsdkintf.c		1.184

	Initialize parity_rewrite_stripes_done to remove the window where
	bogus values could be returned at the start of parity rewriting.
	[oster, ticket #1039]

sys/dev/raidframe/rf_netbsdkintf.c		1.185

	Don't allow -f to fail a disk while a reconstruction is taking place
	since that would cause a panic.  (Problem noticed by dan@.)
	[oster, ticket #1040]

sys/dev/raidframe/rf_diskqueue.c		1.36

	Only touch bufpool whilst in splbio(). (That should be the case
	already, but this makes it explicit and safer in the case where
	that changes for some reason.)
	[oster, ticket #1041]

usr.bin/window/wwiomux.c			1.11

	. wait only for 10 ms instead of 100 ms before updating the screen
	. fix a variable reuse bug
	It has been broken since the conversion from select() to poll().
	[aymeric, ticket #1400]

sys/netinet/tcp_input.c                         patch

	If an echoed RFC 1323 time stamp appears to be later than the current
	time, ignore it and fall back to old-style RTT calculation. This
	prevents ending up with a negative RTT and panicking later.
	[christos, ticket #1401]

doc/3RDPARTY					1.267

	Update IP Filter's archive site.
	[taca, ticket #1042]

sys/arch/xen/i386/locore.S			1.8

	Change confusing name HYPERVISOR_yield to HYPERVISOR_sched_op.
	[tls, ticket #1044]

etc/etc.pmax/Makefile.inc			1.14

	Make sure the installation/miniroot subdir gets created.
	[jmc, ticket #1046]

sbin/sysctl/sysctl.c				1.96

	Pass dynamic buffer pointer to display_string(), not static
	buffer pointer.  This fixes a problem if the kernel says the
	buffer needs to be too much larger.
	[atatat, ticket #1048]

doc/3RDPARTY					1.269

	Fix "Current Vers:" for Vinum.
	[reed, ticket #1052]

sys/arch/sgimips/hpc/sqvar.h			1.6-1.7
sys/arch/sgimips/hpc/if_sq.c			1.22-1.23

	Fix the HPC1 transmit logic, which was previously very broken.
	[rumble, ticket #1054]

sys/arch/amiga/dev/ite_et.c			1.8

	Ensure that hardware pointers are volatile.  Fixes PR#28810.
	[is, ticket #1055]

sys/uvm/uvm_map.c				1.176 via patch

	Don't merge incompatible map entries, e.g. private and shared.
	[yamt, ticket #1061]

xsrc/xfree/xc/programs/Xserver/hw/sun/sunKbd.c	1.1.1.5 -> 1.2

	Use the "sun(type5_euro)" keycodes when presented with a
	European-layout type-5 keyboard.  This makes the backslash
	(<LSGT>) key on a UK keyboard work.
	[bjh21, ticket #1062]

distrib/sets/lists/man/mi                       1.738-1.739
share/man/man4/Makefile                         1.342 via patch
share/man/man4/ahd.4                            1.1-1.2

	Add manual page for the ahd driver.
	[he, ticket #1057, #1058, #1059]

dist/ipf/man/ipnat.8				1.8

	Remove duplicate description for -d. From Chris Ross in PR 29035.
	[wiz, ticket #1113]

sys/netinet6/nd6.c				1.92

	Make sure that prefixes get purged.  Fixes PR#21189,
	PR#25968, and PR#37873.
	[tron, ticket #1394]

sys/dev/pci/pdcsata.c				1.2 via patch

	Add RAID support.
	[bouyer, ticket #1037]

sys/dev/pci/auich.c				1.74
sys/dev/pci/pcidevs				1.662
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/viaide.c				1.19 via patch

	Add suport for nForce3 250 Audio, IDE and SATA.
	[hira, ticket #1103]

sys/arch/i386/stand/boot/boot2.c		1.5

	Include sys/types.h to make this compile again.
	[tron, ticket #1408]

usr.bin/telnet/telnet.c				1.30

	Plug buffer overflows, ref. CAN 2005-0468 and 2005-0469.
	Patch from MIT/Kerberos (MITKRB5-SA-2005-001-telnet.txt).
	[tron, ticket #1410]

usr.bin/gzip/gzip.c				1.69

	Fixed for PR#28581. If stdin is the input stream, fstat it and check
	if it's file. If so, use it's mtime for the mtime in the header.
	Otherwise use time(2)'s result instead. Lines up with GNU gzip and
	RFC 1952 now as well.
	[jmc, ticket #1031]

games/phantasia/fight.c				1.9-1.10
games/phantasia/gamesupport.c			1.7-1.8
games/phantasia/include.h			1.5
games/phantasia/interplayer.c			1.7-1.8
games/phantasia/io.c				1.7-1.8
games/phantasia/main.c				1.13-1.15
games/phantasia/misc.c				1.11-1.12
games/phantasia/phantstruct.h			1.4
games/phantasia/setup.c				1.13-1.14

	Rework to use curses.h only on the target, not on the host.
	Undef bool before including <curses.h>, since it tries to typedef
	bool. Otherwise we get (at least on gcc 2.95.3) an empty declaration
	warning from "typedef char char;" due to the #define of bool in
	phantstruct.h.
	Redo how void gets init'd.
	setup now just creates an empty file. When main starts and loads it in,
	it stats and if zero size init's a new location and saves it back out.
	Now games.tgz can be shared among MACHINE_ARCH's
	[jmc, ticket #1032]

lib/libpthread/pthread_alarms.c			1.11

	Avoid passing zero-valued timespecs to timer_settime() when we want
	to set a timer, as that will clear the timer instead. Pass in a safely
	in-the-past value instead. Addresses PR lib/28700.
	[nathanw, ticket #1064]

lib/libpthread/pthread_cond.c			1.17

	Correctly return ETIMEDOUT when the absolute time is in the past, in
	the nonthreaded case. Fixes, and fix from, PR lib/25961.
	[nathanw, ticket #1065]

sys/arch/powerpc/powerpc/trap.c			1.106

	Drop the big lock in upcallret() like all the other platforms do.
	[chs, ticket #1066]

sys/arch/cobalt/stand/boot/Makefile		1.7
sys/arch/cobalt/stand/boot/boot.c		1.4
sys/arch/cobalt/stand/boot/boot.h		1.2
sys/arch/cobalt/stand/boot/tgets.c		1.1

	Add a prompt to specify a kernel filename to be loaded on bootloader.
	[tsutsui, ticket #1070]

sys/dev/pci/emuxki.c				1.34

	Add some byteswap ops around DMA descriptors for big endian machines.
	Tested on macppc by matthew green.  
	[tsutsui, ticket #1071]

sys/arch/dreamcast/dreamcast/kloader.c		1.3-1.4

	Fix kloader(4) support on NetBSD-dreamcast.
	[tsutsui, ticket #1069]

sys/arch/x86/x86/mpacpi.c			1.32
sys/arch/x86/x86/mpbios.c			1.23

	Use fixed mode, not lopri, for delivering IO interrupts. Suggested by
	Peter O'Kane. Fixes interrupt problems on some Xeon systems.
	[fvdl, ticket #1073]

include/ctype.h					1.28 via patch

	Replaced the macro name "notyet" with a 0. There's always the
	possibility that a strictly conforming C program uses that name
	itself, so it had to be removed.
	[rillig, ticket #1427]

sys/dev/sun/kbd.c				1.41

	Go back to filtering out KBD_IDLE events by default. The Xsun shipped
	with NetBSD 2.0 gets confused by them (generating events for keycode
	134 when all keys are released), and even when that's fixed we should
	keep one release worth of backward compatibility.
	[bjh21, ticket #1075]

lib/libc/time/localtime.c			1.36

	PR/28324: Takayoshi Kochi: localtime_r(3) returns GMT
	Add missing tzset_unlocked(); as suggested.
	[kochi, ticket #1087]

libexec/ld.elf_so/arch/sparc/mdreloc.c		1.34

	Add support for unaligned relocs on sparc, from PR 26858.
	Should also fix PR 25901 and PR 18296.
	[skrll, ticket #1090]

sys/arch/arm/xscale/i80321_pci.c		1.5

	Start I/O range at base+0x1000 to avoid 0.
	[briggs, ticket #1092]

sys/dev/raidframe/rf_states.c			1.37

	After walking through desc->dagList nuking entries, make sure
	desc->dagList is set to NULL before continuing.  If we don't,
	there's a danger that we'll try to re-free these items later.
	(This should fix a panic reported to me via private communciation.)
	[oster, ticket #1095]

sys/arch/hpcmips/vr/vr.c			1.45

	Make high speed CF cards work under NetBSD-hpcmips. This fixes
	PR hpcmips/26158 and PR install/28656.
	[hamajima, ticket #1097]

sys/dev/raidframe/rf_reconstruct.c		1.79

	ForceReconReadDoneProc() needs a return after doing the first
	rf_CauseReconEvent().
	[oster, ticket #1104]

sys/dev/ata/atavar.h				1.65 via patch
sys/dev/ic/wdc.c				1.217 via patch

	Avoid panics in DIAGNOSTIC kernels on systems using IDE controllers
	with a shared queue. This fixes kern/27421.
	[bouyer, ticket #1105]

sys/arch/powerpc/powerpc/pio_subr.S		1.9

	Fix problem with unclosed comments.
	[matt, ticket #1106]

distrib/sets/lists/xserver/md.amd64		1.13
distrib/sets/lists/xserver/md.cats		1.9
distrib/sets/lists/xserver/md.i386		1.29
distrib/sets/lists/xserver/md.macppc		1.21
x11/Xserver/hw/xfree86/drivers/nv/Makefile	1.7
x11/Xserver/hw/xfree86/drivers/nv/riva128/Makefile 1.1

	Provide Riva 128 support in NetBSD's X11 distribution.
	[rtr, ticket #1112]

lib/librt/sem_open.3				1.2

	Bring in sem_open (& sem_close & sem_unlink) man page from FreeBSD.
	These functions are actually implemented, but the old man page said
	that they simply returned with errors--it was apparently out of date
	at the time of import.
	[briggs, ticket #1114]

share/man/man4/options.4			1.261

	Document option P1003_1B_SEMAPHORE.
	[briggs, ticket #1115]

sys/dev/ic/rtl81x9.c				1.48
sys/dev/ic/rtl81x9var.h				1.16

	Attach rtk(4) as an event source to rnd(4).
	[dan, ticket #1116]

sys/dev/pci/if_tl.c				1.67
sys/dev/pci/if_tlvar.h				1.11

	Attach tl(4) as an event source to rnd(4).
	[dan, ticket #1117]

sys/dev/pci/trm.c				1.19

	Move epprom settings checks to the right place, so that sync/wide
	nego is started based on the eeprom values and adapter capabilities.
	Avoid the driver to negotiate wide transfers with a wide drive
	connected to a non-wide capable controller.
	[bouyer, ticket #1429]

usr.sbin/lastlogin/lastlogin.c			1.12 via patch

	Avoid a NULL pointer dereference. From Karim Ayad in PR bin/28958.
	[martin, ticket #1091]

share/man/man4/sk.4				1.6
sys/dev/pci/if_sk.c				1.13
sys/dev/pci/pcidevs				1.687
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add support for Belkin Gigabit Desktop Network PCI card.
	[fredb, ticket #1120]

sys/netinet/tcp_input.c				patch

	Fix TCP performance problems introduced in ticket 1401.
	[chs, ticket #1445]

sys/dev/pci/if_tl.c				1.69
sys/dev/pci/pcidevs				1.706
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add "Compaq Netelligent 10 T/2 PCI UTP/Coax Controller". Fix kern/29218
	by A L Meyers.
	[bouyer, ticket #1438]

sys/dev/pci/if_wm.c				1.102

	In wm_stop():
	 - Clear the interrupt mask to ensure the device cannot assert its
	   interrupt line.
	 - Clear sc->sc_icr to ensure wm_intr() makes no attempt to service any
	   currently pending or shared interrupt.
	This should address the problem reported in both PR/29903 and PR/22493.
	(wm(4) is susceptible to crashing in wm_intr() when the interface is 
	downed)
	[scw, ticket #1481]

share/man/man4/tlp.4				1.14

	Mention the Compu-Shack FASTline-II PCI adapters as supported.
	[bad, ticket #1483]

sbin/fsck_ffs/inode.c				1.52
sbin/fsck_ffs/pass1.c				1.37

	Remove debugging abort() calls.
	[christos, ticket #1493]

sys/arch/sparc64/sparc64/locore.c		1.197-1.204 via patch

	Various changes from NetBSD-current, revisions 1.197 to 1.204.
	Interrupt and soft-interrupt handling changes that appear to fix
	the "sleep forever" problem (PR port-sparc64/21750).
	[martin, ticket #1487]

xfree/xc/programs/xterm/charproc.c		1.6

	Fix handling of ST sequences outside of complex escape sequences.
	Patch provided by Johnny Billquist in PR xsrc/29003.
	[tron, ticket #1107]

xfree/xc/programs/Xserver/hw/xfree86/os-support/bsd/bsd_init.c 1.2

	Don't switch to primary virtual console during startup under
	NetBSD 2.0 and above as suggested by Cliff Wright in
	PR xsrc/29123. This hack is not necessary any more (probably
	because of wscons).
	[tron, ticket #1127]

xfree/xc/programs/Xserver/hw/xfree86/xf86cfg/screen-cfg.c 1.2

	Stop core dump when configuring ATI driver. PR#29155.
	[dsl, ticket #1135]

etc/Makefile					1.302
share/man/man7/release.7			1.17-1.18

	Permit a "README", "SOURCE_DATE", and "source" at the top-level
	to be added to the CD-ROM (only if they exist), as proposed
	on tech-install and tech-toolchain without objections, and
	tweak release(7) to clarify how to to multi-platform releases.
	[fredb, ticket #1121]

usr.bin/db/db.c					1.13

	When vis encoding with -S, only remove the trailing NUL if -N
	isn't used and the item's size is > 0.
	[seb, ticket #1142]

usr.bin/calendar/calendars/calendar.holiday	1.10

	Fix the date of the Australia Day holiday.
	[simonb, ticket #1147]

sbin/raidctl/raidctl.8				1.41-1.42, 1.44-1.46 via patch

	Sync raidctl(8) with raid(4) regarding booting from RAID 1.
	[fredb, ticket #1151]

sys/dev/pci/pcidevs				1.691-1.692
sys/dev/pci/viaide.c				1.22-1.23
share/man/man4/viaide.4				1.4-1.5 via patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add 'VT642 SATA RAID Controller'. It looks like a viaide, it smells
	like a viaide... but you can only address the drives once you have
	put two or more of them into a RAID or JBOD.
	[abs, ticket #1153]

sys/arch/sparc/sparc/locore.s			1.215

	sun4/sun4c sw interrupt entry: check interrupt register to determine to
	see whether there is a pending software interrupt at the given level.
	If not, it must be a device interrupt sharing that level.
	[pk, ticket #1154]

bin/pax/cpio.c					1.18

	Don't write hardlinked file contents in sv4cpio mode.
	[matt, ticket #1164]

share/man/man9/namecache.9			1.9-1.10
share/man/man9/vnode.9				1.23-1.26 via patch

	Update documentation to match with the recent reality.  PR#28793
	[yamt, ticket #1168]

sys/netinet/ip_encap.c				1.20

	Get zero-cleared field on malloc. PR#27277
	[bouyer, ticket #1188]

x11/share/man/GL/gl/Makefile			1.4

	Process GL manual pages with tbl(1). PR#29662
	[tron, ticket #1310]

usr.bin/vi/cl/cl_bsd.c				1.8
usr.bin/vi/cl/cl_funcs.c			1.8
usr.bin/vi/ex/ex.c				1.14
usr.bin/vi/ex/ex_abbrev.c			1.9
usr.bin/vi/ex/ex_append.c			1.11
usr.bin/vi/ex/ex_args.c				1.10
usr.bin/vi/ex/ex_argv.c				1.12
usr.bin/vi/ex/ex_at.c				1.10
usr.bin/vi/ex/ex_bang.c				1.10
usr.bin/vi/ex/ex_cd.c				1.12
usr.bin/vi/ex/ex_cmd.c				1.6
usr.bin/vi/ex/ex_cscope.c			1.9
usr.bin/vi/ex/ex_delete.c			1.10
usr.bin/vi/ex/ex_display.c			1.9
usr.bin/vi/ex/ex_edit.c				1.9
usr.bin/vi/ex/ex_equal.c			1.11
usr.bin/vi/ex/ex_file.c				1.10
usr.bin/vi/ex/ex_filter.c			1.5
usr.bin/vi/ex/ex_global.c			1.11
usr.bin/vi/ex/ex_init.c				1.11
usr.bin/vi/ex/ex_join.c				1.10
usr.bin/vi/ex/ex_map.c				1.9
usr.bin/vi/ex/ex_mark.c				1.9
usr.bin/vi/ex/ex_mkexrc.c			1.9
usr.bin/vi/ex/ex_move.c				1.11
usr.bin/vi/ex/ex_open.c				1.9
usr.bin/vi/ex/ex_perl.c				1.5
usr.bin/vi/ex/ex_preserve.c			1.9
usr.bin/vi/ex/ex_print.c			1.11
usr.bin/vi/ex/ex_put.c				1.9
usr.bin/vi/ex/ex_quit.c				1.4
usr.bin/vi/ex/ex_read.c				1.12
usr.bin/vi/ex/ex_screen.c			1.10
usr.bin/vi/ex/ex_script.c			1.10
usr.bin/vi/ex/ex_set.c				1.9
usr.bin/vi/ex/ex_shell.c			1.13
usr.bin/vi/ex/ex_shift.c			1.10
usr.bin/vi/ex/ex_source.c			1.10
usr.bin/vi/ex/ex_stop.c				1.9
usr.bin/vi/ex/ex_subst.c			1.17
usr.bin/vi/ex/ex_tag.c				1.16
usr.bin/vi/ex/ex_tcl.c				1.5
usr.bin/vi/ex/ex_txt.c				1.7
usr.bin/vi/ex/ex_undo.c				1.9
usr.bin/vi/ex/ex_usage.c			1.10
usr.bin/vi/ex/ex_util.c				1.12
usr.bin/vi/ex/ex_version.c			1.10
usr.bin/vi/ex/ex_visual.c			1.11
usr.bin/vi/ex/ex_write.c			1.10
usr.bin/vi/ex/ex_yank.c				1.9
usr.bin/vi/ex/ex_z.c				1.9

	Fix the RCSIDs.
	[aymeric, ticket #1195]

sys/kern/uipc_mbuf2.c				1.19

	In m_pulldown avoid a prepend to the next mbuf in the chain if the
	result would still not have all data we want continous. Fixes PR#30098
	[martin, ticket #1503]

share/man/man4/options.4			1.259 via patch

	reference config(8) -x as another way to recover the result of using
	INCLUDE_CONFIG_FILE; bump date
	[hubertf, ticket #1272]

sys/arch/amd64/amd64/db_disasm.c		1.2

	Add disasm support for amd64 (x86-64).
	From Cliff Neighbors.
	[matt, ticket #1275]

sys/arch/powerpc/powerpc/trap_subr.S		1.57

	Don't enable interrupts while calling trap() if the trapping frame
	didn't have them enabled either.
	Addresses PR#29559.
	[matt, ticket #1286]

lib/libc/stdlib/getopt_long.3			1.15

	Document index argument, and mention that long_options
	needs to be terminated with a structure containing zeroes.
	Slightly modified version of patch from PR#30002 by Kailash Sethuraman.
	Bump date.
	[wiz, ticket #1432]

etc/rc.d/sysdb					1.15

	Fix for /bin/ksh, from Jukka Salmi in PR 27232.
	[lukem, ticket #1266]

etc/rc.d/amd					1.12

	Implement reload, using "amq -f".
	Suggested by Hauke Fath in PR 26589.
	[lukem, ticket #1267]

etc/rc.subr					1.65
share/man/man8/rc.subr.8			1.16

	* Implement
		load_rc_config_var cmd var
	  to load the rc.conf(5) configuration for cmd and set var in the
	  current shell, using 'load_rc_config var' in a sub-shell to avoid
	  unwanted side-effects.

	* Improve required_vars warning message.
	[lukem, ticket #1268]

usr.bin/pkill/pkill.c				1.8

	If a user or group is not known, report the problem user/group, rather
	than the first user/group.
	[abs, ticket #1294]

sys/net/if_stf.c				1.46
sys/net/if_stf.h				1.2

	Add support for changing the MTU to stf(4).
	[tron, ticket #1312]

sys/arch/macppc/pci/pci_machdep.c		1.26

	OpenFirmware on machines with the "Grackle" bridge assign an
	'AAPL,interrupts' property instead of 'interrupt-map' and
	'interrupt-map-mask' properties.  Adjust for this by checking
	for the latter, and if they're not present (and the parent isn't
	'pci-bridge'), then look for 'AAPL,interrupts'.

	Problem analyzed and patched by Tim Kelly on port-macppc.  I modified
	the patch to move the fallback into find_node_intr(), tweaking some
	previously-disabled code.
	[briggs, ticket #1330]

sys/net/if_gre.c				1.56
sys/netinet/ip_gre.c				1.34

	Add IPv6 over GRE (contributed by Gert Doering in PR#29150).
	[is, ticket #1382]

distrib/sets/lists/base/mi			1.525
doc/3RDPARTY					1.247,1.251,1.277
share/zoneinfo/asia				1.1.1.28
share/zoneinfo/backward				1.1.1.14
share/zoneinfo/europe				1.1.1.28
share/zoneinfo/iso3166.tab			1.1.1.11
share/zoneinfo/leapseconds			1.1.1.10
share/zoneinfo/northamerica			1.1.1.27
share/zoneinfo/southamerica			1.1.1.26
share/zoneinfo/yearistype.sh			1.5
share/zoneinfo/zone.tab				1.1.1.21

	Update to tzdata2005e, with fixes affecting Argentina, Brazil, Cuba,
	Georgia, Israel, Paraguay, and Uruguay.
	[kleink, ticket #1215]

doc/3RDPARTY					1.296-1.297
share/zoneinfo/asia				1.1.1.29
share/zoneinfo/australasia			1.5
share/zoneinfo/europe				1.1.1.29

	Update to tzdata2005f, with fixes affecting Israel.
	[kleink, ticket #1283]

doc/3RDPARTY					1.303
share/zoneinfo/southamerica			1.1.1.27

	Update to tzdata2005g, with fixes affecting Uruguay right now.
	[kleink, ticket #1326]

doc/3RDPARTY					1.316
share/zoneinfo/antarctica			1.1.1.12
share/zoneinfo/asia				1.1.1.30
share/zoneinfo/australasia			1.6
share/zoneinfo/etcetera				1.1.1.5
share/zoneinfo/iso3166.tab			1.1.1.12

	Update to tzdata2005h, with fixes affecting Kazakhstan right now.
	[kleink, ticket #1397]

etc/rc.d/amd					1.13
etc/rc.d/ipnat					1.13
etc/rc.d/network				1.47
etc/rc.d/nfsd					1.7
etc/rc.d/nfslocking				1.8
etc/rc.d/routed					1.9
etc/rc.d/smmsp					1.4
etc/rc.d/yppasswdd				1.10
etc/rc.d/ypserv					1.8

	Use 'load_rc_config_var CMD VAR' to set VAR for "foreign" rc.conf(5)
	variables that may be set in /etc/rc.conf.d/CMD instead of /etc/rc.conf.
	Fixes PR 20786 from Pavel Cahyna.
	[lukem, ticket #1269]

sys/ufs/lfs/TODO				1.8
sys/ufs/lfs/lfs.h				1.75 via patch
sys/ufs/lfs/lfs_alloc.c				1.74 via patch
sys/ufs/lfs/lfs_balloc.c			1.49, 1.51 via patch
sys/ufs/lfs/lfs_bio.c				1.78
sys/ufs/lfs/lfs_extern.h			1.62 via patch
sys/ufs/lfs/lfs_segment.c			1.156 via patch
sys/ufs/lfs/lfs_subr.c				1.48
sys/ufs/lfs/lfs_syscalls.c			1.101
sys/ufs/lfs/lfs_vfsops.c			1.163 via patch
sys/ufs/lfs/lfs_vnops.c				1.134 via patch
sys/ufs/ufs/ufs_readwrite.c			1.61 via patch
libexec/lfs_cleanerd/clean.h			1.20 via patch
libexec/lfs_cleanerd/cleanerd.c			1.52 via patch
libexec/lfs_cleanerd/library.c			1.41 via patch
regress/sys/fs/lfs/newfs_fsck/Makefile		1.4
regress/sys/fs/lfs/newfs_fsck/mkfs_mount	1.2
regress/sys/fs/lfs/newfs_fsck/smallfiles	1.2
sbin/fsck_lfs/bufcache.c			1.3
sbin/fsck_lfs/bufcache.h			1.3
sbin/fsck_lfs/lfs.h				1.3
sbin/fsck_lfs/lfs.c				1.8
sbin/fsck_lfs/pass3.c				1.8 via patch
sbin/fsck_lfs/pass0.c				1.18 via patch
sbin/fsck_lfs/utilities.c			1.18 via patch
sbin/fsck_lfs/segwrite.c			1.7
sbin/fsck_lfs/setup.c				1.19 via patch
sbin/newfs_lfs/Makefile				1.3
sbin/newfs_lfs/lfs.c				removed
sbin/newfs_lfs/make_lfs.c			1.1
sbin/newfs_lfs/newfs.c				1.15 via patch

	Various minor LFS improvements.

	Kernel:

	* Note when lfs_putpages(9) thinks it is not going to be writing any
	  pages before calling genfs_putpages(9).  This prevents a situation in
	  which blocks can be queued for writing without a segment header.
	* Correct computation of NRESERVE(), though it is still a gross
	  overestimate in most cases.  Note that if NRESERVE() is too high, it
	  may be impossible to create files on the filesystem.  We catch this
	  case on filesystem mount and refuse to mount r/w.
	* Allow filesystems to be mounted whose block size is == MAXBSIZE.
	* Somewhere along the line, ufs_bmaparray(9) started mangling UNWRITTEN
	  entries in indirect blocks again, triggering a failed assertion "daddr	  <= LFS_MAX_DADDR".  Explicitly convert to and from int32_t to correct
	  this.  Should fix PR #29045.
	* Add a high-water mark for the number of dirty pages any given LFS can
	  hold before triggering a flush.  This is settable by sysctl, but off
	  (zero) by default.
	* Be more careful about the MAX_BYTES and MAX_BUFS computations so we
	  shouldn't see "please increase to at least zero" messages.
	* Note that VBLK and VCHR vnodes can have nonzero values in di_db[0]
	  even though their v_size == 0.  Don't panic when we see this.
	  Fixes PR #26680.
	* Change lfs_bfree to a signed quantity.  The manner in which it is
	  processed before being passed to the cleaner means that sometimes it
	  may drop below zero, and the cleaner must be aware of this.
	* Never report bfree < 0 (or higher than lfs_dsize) through
	  lfs_statfs(9).  This prevents df(1) from ever telling us that our full
	  filesystems have 16TB free.
	* Account space allocated through lfs_balloc(9) that does not have
	  associated buffer headers, so that the pagedaemon doesn't run us out
	  of segments.
	* Return ENOSPC from lfs_balloc(9) when bfree drops to zero.
	* Address a deadlock in lfs_bmapv/lfs_markv when the filesystem is being
	  unmounted.  Because vfs_busy() is a shared lock, and
	  lfs_bmapv/lfs_markv mark the filesystem vfs_busy(), the cleaner can be
	  holding the lock that umount() is blocking on, then try to vfs_busy()
	  again in getnewvnode().

	cleaner:

	* Adapt lfs_cleanerd to use the fcntl call to get the Ifile filehandle,
	  so it need not be in the namespace.
	* Make lfs_cleanerd be more careful when there are very few available
	  segments.
	* Make lfs_cleanerd less verbose when the filesystem is unmounted.

	newfs_lfs, fsck_lfs, and regression:

	* Extend the lfs library from fsck_lfs(8) so that it can be used with a
	  not-yet-existent LFS.  Make newfs_lfs(8) use this library, so it can
	  create LFSs whose Ifile is larger than one segment.
	  Addresses PR #11110.
	* Make newfs_lfs(8) use strsuftoi64() for its arguments, a la newfs(8).
	* Make fsck_lfs(8) respect the "file system is clean" flag.
	* Don't let fsck_lfs(8) think it has dirty blocks when invoked with the
	  -n flag.
	* Remove the Ifile from the filesystem namespace.  The cleaner now uses
	  a fcntl call on the root inode to find the Ifile filehandle.  (As a
	  side-effect, addresses PR #29144.)
	[perseant, ticket #1281]

sbin/init/init.c				1.69

	Bump the number of inodes to 1024 in the MFS case, needed to
	create more devices in the ramdisk images, ok'ed by thorpej@.
	[martin, ticket #1331]

usr.sbin/pkg_install/lib/ftpio.c		1.67

	* ftp.fi.netbsd.org returns "257" in return to a "cd" command,
	  accept that (in addition to 250 and 550). Seems to be allowed
	  per RFC 959. (PR#24744.)
	* Make buffer for reply bigger (not too big, as it may hit
	  performance).
	[hubertf, ticket #1333]

sys/dev/pci/pcidevs				1.702
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add missing PCI id for Adaptec ASR-2410SA.
	[tron, ticket #1341]

sys/ufs/ext2fs/ext2fs_bmap.c			1.19

	getblk() can return NULL if we are the pagedaemon. Check for this.
	[bouyer, ticket #1355]

lib/libc/citrus/citrus_none.c			1.13

	Don't sign extend characters when they get converted to wide
	characters in mbtowc. Otherwise you are not going to be able
	to wctomb them. Added regression test.  From kim, many thanks.
	[christos, ticket #1361]

sys/dev/ic/esiop.c				1.28
sys/dev/ic/esiopvar.h				1.9
sys/dev/ic/siop.c				1.73
sys/dev/ic/siop_common.c			1.34
sys/dev/microcode/siop/esiop.ss			1.17
sys/dev/microcode/siop/esioup.out		regen

	Properly compute xs->resid, instead of assuming it'll always be 0 when
	a command is done.
	[bouyer, ticket #1364]

sys/dev/ic/esiop.c				1.29
sys/dev/ic/siop.c				1.74
sys/dev/ic/siop_common.c			1.35
sys/dev/ic/siopvar_common.h			1.28
sys/dev/microcode/siop/esiop.ss			1.18
sys/dev/microcode/siop/siop.ss			1.18

	when an unexpected disconnect occurs only compute the resid; do the
	real save data pointers when we get the message (or rather, at
	disconnect time following the message).
	Factor out code to do this, and to deal with xs->resid, in
	siop_common.c.
	[bouyer, ticket #1365]

sys/dev/ic/esiop.c				1.30
sys/dev/ic/siop.c				1.75
sys/dev/ic/siop_common.c			1.36
sys/dev/ic/siopvar_common.h			1.29

	Add support for the Ignore Wide Residue SCSI message.
	[bouyer, ticket #1366]

sys/dev/ic/siop.c				1.76

	Add missing return, fix handling of Ignore Wide Residue messages.
	[bouyer, ticket #1367]

sys/dev/ic/esiop.c				1.31

	Rmove a redundant BUS_DMASYNC_POSTREAD | BUS_DMASYNC_POSTWRITE, and fix
	another one (POST -> PRE)
	[bouyer, ticket #1368]

sys/arch/evbarm/stand/gzboot/Makefile.gzboot	1.11

	Fix a build problem compiling gzboot with BUILDID on evbarm.
	[bsh, ticket #1362]

usr.bin/lastcomm/lastcomm.c			1.17

	Fix problem where lastcomm mangles elapsed time calculation because
	of incorrect rounding. PR#29819.
	[christos, ticket #1370]

sys/kern/vfs_bio.c				1.143

	Fix validation of new values when setting vm.{hi,low}water. PR#29651.
	[chs, ticket #1380]

etc/etc.i386/Makefile.inc			1.40
sys/arch/i386/conf/GENERIC.MPACPI		1.1 via patch

	Add new kernel configuration for ACPI based SMP systems which can
	also be used to utilize Hyper-Threading.
	[tron, ticket #1398]

sys/arch/alpha/common/shared_intr.c		1.17
sys/arch/alpha/include/intr.h			1.50
sys/arch/alpha/pci/pci_1000.c			1.15
sys/arch/alpha/pci/pci_1000a.c			1.17
sys/arch/alpha/pci/pci_2100_a500.c		1.6
sys/arch/alpha/pci/pci_550.c			1.25
sys/arch/alpha/pci/pci_6600.c			1.11
sys/arch/alpha/pci/pci_eb164.c			1.33
sys/arch/alpha/pci/pci_eb64plus.c		1.13
sys/arch/alpha/pci/pci_eb66.c			1.13
sys/arch/alpha/pci/pci_kn20aa.c			1.45
sys/arch/alpha/pci/pci_kn300.c			1.27
sys/arch/alpha/pci/sio_pic.c			1.33

	- Add a alpha_shared_intr_reset_strays() function that resets the  
	  stray interrupt counter for a given shared interrupt descriptor.
	- When an interrupt is successfully handled, reset the strays counter,
	  thus preventing a "slow leak" from eventually shutting off the  
	  interrupt vector.  Idea taken from pci_kn300.c (which was changed
	  to use the new alpha_shared_intr_reset_strays() function).
	[thorpej, ticket #1373]

distrib/notes/i386/hardware			1.119
sys/dev/ic/aacvar.h				patch
sys/dev/pci/aac_pci.c				1.14
sys/dev/pci/pcidevs				1.705
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Added support for Dell CERC SATA RAID 1.5/6ch.
	[martti, ticket #1402]

share/man/man4/aac.4				1.8 via patch

	Note CERC SATA RAID 1.5/6ch
	[martti, ticket #1403]

sys/uvm/uvm_fault.c				1.90
sys/uvm/uvm_map.c				1.188

	Address 32bit overflow issues when handling memory mapped
	regions on large files.
	[dbj, ticket #1409]

distrib/atari/Makefile				1.5
distrib/atari/misc/Makefile			1.1
distrib/atari/misc/aptck.ttp.uue		1.1
distrib/atari/misc/chg_pid.ttp.uue		1.1
distrib/atari/misc/file2swp.ttp.uue		1.1
distrib/atari/misc/gzip.ttp.uue			1.1
distrib/atari/misc/loadbsd.ttp.uue		1.1
distrib/atari/misc/rawwrite.ttp.uue		1.1

	Last remaining bits of hand built releases. Get all TOS utils into
	CVS and provide rules for putting them into installation/misc
	along with checksums.
	[jmc, ticket #1411]

sys/dev/pci/neo.c				1.28

	* neo_intr()
	  update the watermark for the recording buffer
	  The fix was provided in PR#26706 by Chapman Flack.
	[kent, ticket #1413]

sys/dev/audio.c					patch

	Correct audio recording buffer handling. PR#26706.
	[kent, ticket #1414]

sys/arch/hpcsh/dev/hd64461/hd64461video.c	1.26

	Make Xhpc work in 8-bit mode on Jornada 680.
	[uwe, ticket #1415]

bin/sh/expand.c					1.68

	expbackq() was incorrectly backing up a temporary buffer
	when removing \n from the end of output of commands
	inside $(...) substitutions.  If the program output
	is n*128+1 bytes long (ending in a \n) then the code checks
	buf[-1] for another \n - looking an uninitialised stack.
	On a big-endian system an integer of value 10
	will satisfy this (unlikely on little endian) and can
	happen depending on the last code path to use a lot of stack!
	This caused the problem with newvers.sh on
	sparc64 after ', 2005' was added to the date list.
	PR#28852.
	[martin, ticket #1418]

lib/libc/net/res_send.c				patch

	Fix warnings which prevent compilation without INET6.
	From David Brownlee, PR#29970.
	[christos, ticket #1424]

lib/libpthread/pthread_sleep.c			1.7

	Avoid passing along a timespec with a negative number of seconds if
	the current time plus the caller-supplied time to sleep wraps the
	time_t. Instead, sleep until INT_MAX.
	[nathanw, ticket #1443]

sys/dev/pci/if_hme_pci.c			1.15-1.19

	Add Sun QFE support for non-sparc hardware, and some additional
	cleanup in the driver.  PR#30018.
	[christos, ticket #1444]

sys/arch/sparc/stand/boot/boot.c		1.20
sys/arch/sparc/stand/bootxx/bootxx.c		patch
sys/arch/sparc/stand/common/promdev.c		1.16
sys/arch/sparc/stand/common/promdev.h		1.10

	Do not rely on strings to which pointers are returned by promlib
	functions to persist accross further promlib calls.
	This fixes (at least) bootjs.net.
	[martin, ticket #1484]

sys/conf/files					1.703
sys/dev/pci/usb_pci.c				1.4
sys/dev/usb/ehci.c				1.90
sys/dev/usb/ehcivar.h				1.16
sys/dev/usb/ohci.c				1.153
sys/dev/usb/ohcivar.h				1.34
sys/dev/usb/uhci.c				1.183
sys/dev/usb/uhcivar.h				1.37
sys/dev/usb/usb_mem.c				1.28
sys/dev/usb/usb_mem.h				1.21

	Implement an USB memory reserve. Allocate some memory per
	host controller in the wanted bus_dma space. If an allocation
	fails during operation (i.e. when hotplugging an umass
	device), fall back to using the reserve.
	[bad, ticket #1479]

usr.bin/gzip/gzip.c				1.67

	Count the output file size modulo 2^32 so that the check against
	the size in the compressed file works for files greater than 4GB.
	Fixes the fixable part of PR#26907.
	[wiz, ticket #1447]

sys/dev/vnd.c					1.112-1.114 via patch
sys/dev/vndvar.h				1.14 via patch

	Make vnd do I/O to the underlying file from thread context. This
	allows the strategy routine to be called from interrupt context.
	Now that pool_get() is only called from thread context, change
	PR_NOWAIT to PR_WAITOK. Fixes PR kern/26272 by Juergen Hannken-Illjes.
	[bouyer, ticket #1417]

lib/libc/gen/getttyent.c			1.21

	Fix a bug where getty eats the last character of the last
	field.  PR#24318, PR#28183.
	[is, ticket #1396]

sys/dev/pci/ahd_pci.c				1.16-1.17

	Select the correct chip setup routine for two controllers,
	and add support for a Dell OEM board version shipping with
	current Dell machines.
	[bad, ticket #1480]

sys/dev/usb/ukbd.c				1.86

	If UKBD_LAYOUT isn't defined, but PCKBD_LAYOUT is, use the latter
	as the default layout.  PR#28668 (part 1).
	[augustss, ticket #1489]

sbin/wsconsctl/wsconsctl.8			1.17 via patch
sbin/wsconsctl/wsconsctl.c			1.11

	Change the default controlling devices to /dev/wskbd and /dev/wsmouse
	(instead wskbd0 and wsmouse0), this way changes will affect all devices
	instead of just the first one. PR#28668 (part 2).
	[augustss, ticket #1490]

lib/libc/iconv/iconv.c				1.5

	Make sure to set errno to EINVAL if _citrus_iconv_open() returns
	ENOENT.
	[tshiozak, ticket #1491]

usr.bin/iconv/iconv.c				1.6-1.9
usr.bin/iconv/Makefile				1.4

	Make an error message more useful in some cases. PR#30051
	[tshiozak, ticket #1492]

distrib/sets/lists/comp/mi			1.783 via patch
sys/netinet/Makefile				1.12 via patch

	Install netinet/ipl.h . PR#30095
	[martti, ticket #1495]

sys/dev/usb/ehci.c				1.98 via patch
sys/dev/usb/ehcireg.h				1.21

	Fix the error check on completion of an xfer.  Just because the
	qTD status field has error bits set doesn't mean there
	has been an error, unless the HALTED bit is set as well.
	The old behaviour could result in a transfer being
	considered failed by the software, but a success by the device.
	PR#29731.
	[augustss, ticket #1496]

sys/dev/verified_exec.c				1.6

	Use UIO_SYSSPACE for NDINIT. Found by Eike Dehling.
	[cube, ticket #1505]

sys/arch/mac68k/dev/akbdmap.h			1.7 via patch
sys/dev/pckbport/wskbdmap_mfii.c		1.8-1.9
sys/dev/usb/ukbdmap.c				1.14

	Add Portuguese keymap.
	[abs, ticket #1506]

sys/arch/mips/mips/mipsX_subr.S			1.16

	Change *_TLBUpdate for the MIPS3-style two-entry TLBs to only
	update existing entries and not create new ones. PR#14801.
	[chs, ticket #1508]

sys/dev/pci/iavc_pci.c				1.3

	Correct the type in CFATTACH_DECL. PR#30197
	[martin, ticket #1513]

sys/dev/ic/esiop.c				1.33

	Don't assume all LUNs are probed before scsipi sets the mode,
	and always check if lun_tagtbl needs to be allocated. Patch
	from john heasley in kern/29603.
	[bouyer, ticket #1514]

sys/dev/vnd.c					patch

	Fix a build problem introduced in a previous pullup.
	[bouyer, ticket #1520]

sys/arch/macppc/pci/pci_machdep.c		1.27

	Bring in some code to deal with devices in the lower slots of a
	UMAX S900 and perhaps PowerMac 9500.  These slots sit behind
	a PCI-PCI bridge, and devices in those slots inherit the PCI-PCI
	bridge interrupt.  PR#26341.
	[macallan, ticket #1521]

usr.sbin/pkg_install/lib/ftpio.c		1.66 via patch

	When extracting files from a binary package addition by ftp,
	preserve the modes of the entries in the binary package. PR#28826
	[reed, ticket #1515]

sys/dev/ata/wd.c				1.300

	Add another broken seagate device to the quick list.
	[bouyer, ticket #1522]

sys/arch/hpcmips/conf/GENERIC			1.167
sys/arch/hpcmips/conf/files.hpcmips		1.97
sys/arch/hpcmips/conf/std.hpcmips.tx39		1.2
sys/arch/hpcmips/dev/optpoint.c			1.1
sys/arch/hpcmips/tx/tx39spi.c			1.1
sys/arch/hpcmips/tx/tx39spivar.h		1.1

	Add OptPoint on Telios HC-AJ2 (and maybe AJ1) support for hpcmips.
	[hamajima, ticket #1500]

sys/dev/usb/ehci.c				1.102-1.103

	Make sure to honor the USBD_FORCE_SHORT_XFER flag and generate an empty
	transfer when necessary. Make sure all physical addresses are filled
	in the qTD even when we have a page offset.
	[augustss, ticket #1501]

lib/libpthread_dbg/pthread_dbg.c		1.17-1.22
lib/libpthread_dbg/pthread_dbg.h		1.4-1.5
lib/libpthread_dbg/pthread_dbg_int.h		1.4
lib/libpthread/arch/powerpc/_context_u.S	1.4

	Pull up various libpthread_dbg fixes.
	[matt, ticket #1526]

sys/net/rtsock.c				1.72 via patch

	Ask the kernel for the IP address of the interface that
	will be used to communicate with a given host, needed
	for the Asterisk software PBX to work properly when it
	has multiple interfaces active.  PR#27286
	[christos, ticket #961]

lib/librt/sem_open.3				1.3-1.4

	Clear up a sentence, and correct the library location
	of the function.
	[peter, ticket #1528]

libexec/identd/identd.c				patch

	Save/restore errno in the zombie reaper to fix a race
	condition. PR#30253
	[peter, ticket #1529]

sys/dev/pci/pcidevs				1.637,1.658 via patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/piixide.c				1.16,1.17 via patch

	Add support for the 82801FB/FR (ICH6/6R) SATA and ICH6 IDE controller
	(82801FB). This fixes PR kern/30026.
	[riz, ticket #1531]

sys/dev/pci/if_fxp_pci.c			1.41
sys/dev/pci/pcidevs				1.711
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add support for the 82801FB (ICH6) 10/100 ethernet appearing
	on new Intel motherboards. This fixes PR kern/30025.
	[riz, ticket #1532]

sys/dev/pci/auich.c				1.78

	Add support for the ICH6 AC97 controller.
	[riz, ticket #1533]

