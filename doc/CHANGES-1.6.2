#	$NetBSD: CHANGES-1.6.2,v 1.1.2.13 2003/06/16 12:49:41 grant Exp $

A complete list of changes from NetBSD 1.6.1 to NetBSD 1.6.2:

File						Revision(s)
----						--------

sys/conf/osrelease.sh				patch
share/tmac/doc-common				patch

	Mark this as 1.6.1_STABLE.

sys/dev/ata/ata_wdc.c				1.39
sys/dev/ic/wdcvar.h				1.36
sys/dev/pci/pciide.c				1.191
sys/dev/pci/pciide_pdc202xx_reg.h		1.9

	Make DMA mode works on Promise Ultra66/100 with 48-bit LBA drives.
	Ok'ed by bouyer in tech-kern@netbsd.org.
	[nakayama, ticket #1275]

usr.sbin/etcupdate/etcupdate			1.10

	Use md5 instead of sum (bin/20196).
	[martti, ticket #1146]

sys/dev/pci/if_rtk_pci.c			1.18

	Set RTK_ENABLE flag when it attached. This fixed multicast problem.
	Found by FUKAUMI Naoki <naoki@fukaumi.org>.
	[kanaoka, ticket #1134]

sys/netinet/in.h				1.59

	C++ does not permit static a data member to have the same name as its
	class, so in a C++ environment rename the ip_opts member to Ip_opts as
	observed in several other implementations; from Jon Olsson in
	PR toolchain/19880.
	[kleink, ticket #1119]

etc/services					1.63

	Add ms-sql-{s,m}, currently quite popular in packet filter logs
	worldwide.
	[ross, ticket #1132]

usr.bin/tftp/tftp.c				1.16

	Fix sendto return value check (incomplete change in 1.14).
	Noted by Brian Ginsbach in PR 19842.
	[wiz, ticket #1139]

sys/netiso/clnp_er.c				1.13

	Keep pkthdr when prepending new mbuf in front of a given chain.
	This keeps us from panic()ing in the interface output routine.
	[is, ticket #1295]

sys/kern/init_main.c				1.215
usr.bin/login/login.c				1.72

	Update copyright notice.
	[fair, ticket #1303]

etc/mrouted.conf				1.5
share/man/man4/ntwoc.4				1.4
	Fix typos.
	[keihan, ticket #1135]

sys/dev/scsipi/scsiconf.c			1.199

	Add PQUIRK_NOLUNS entry for "NEC     ", "CD-ROM DRIVE:502".
	Fixes PR kern/18479
	[bouyer, ticket #1140]

sys/dev/pci/pcidevs				1.503
sys/dev/pci/pcidevs.h				regenerate
sys/dev/pci/pcidevs_data.h			regenerate

	Add SiS 651 host bridge.
	[bouyer, ticket #1143]

sys/dev/scsipi/scsiconf.c			1.198

	Remove revision in quirk entry for TOSHIBA XM-4101TASUNSLCD.
	The same drive with a newer revision also fails, so assume all
	revisions are bad until proven otherwise.
	[bouyer, ticket #1155]

sys/kern/kern_malloc.c				1.73
sys/uvm/uvm_amap.c				1.45
sys/uvm/uvm_amap.h				1.18
sys/uvm/uvm_extern.h				1.72
sys/uvm/uvm_km.c				1.58
sys/uvm/uvm_map.c				1.119

	Add a new km flag UVM_KMF_CANFAIL, which causes uvm_km_kmemalloc() to
	return failure if swap is full and there are no free physical pages.
	have malloc() use this flag if M_CANFAIL is passed to it.
	use M_CANFAIL to allow amap_extend() to fail when memory is scarce.
	this should prevent most of the remaining hangs in low-memory
	situations.
	[skrll, ticket #1156]

usr.bin/progress/progress.c			1.7

	Use an even more elaborate wait loop; it turns out we have a
	child before we even start when run from sysinst.
	[ross, ticket #1167]

usr.bin/cdplay/cdplay.c				1.22

	Fix PR 18444 and a few other corner cases in cdplay.c.
	[is, ticket #1172]

sys/arch/mac68k/dev/akbdmap.h			1.4
sys/arch/macppc/dev/akbdmap.h			1.5

Merged mac68k and macppc keayboards, since they are the same. The file
could move to <arch/mac> if one day we create it.

	Added a french keyboard layout.
	Fixed french keymap: option was not mapped correctly, thus making
	impossible to use |{}[] (tested).
	Added jp keymap from PR/15438, and sf, sv, de and uk keymaps from
	OpenBSD. (all untested).
	[manu, ticket #1183]

sys/net/if_ethersubr.c				1.105

	Ignore multicast PPPoE packets ASAP.
	This improves performance a lot on slow machines behind a cable modem.
	Protect it with PPPOE_SERVER as a reminder that this will have to be
	changed if we add PPPoE server code in the kernel one day.
	[aymeric, ticket #1188]

share/misc/style				1.23

	Return value style update (no parentheses)
	[mason, ticket #1191]

lib/libc/citrus/citrus_ctype_template.h		1.15-1.20
lib/libc/citrus/citrus_none.c			1.6-1.7

	mbsrtowcs_priv template:
        	n == 0 is not an error. it's a valid input.
	_citrus_NONE_ctype_mbsrtowcs:
		fix a typo that causes SEGV.
	while i'm here, make them similar each other.
	when s==0, wctomb should initialize its internal state and return if
	encodings have state dependency or not. Fix part of PR 18269.
	In _RESTART_BEGIN macro, don't use external variable directly.
	- add missing _CEI_TO_EI/_TO_CEI.
	- add missing _STATE_NEEDS_EXPLICIT_INIT checks.
	- more comment.
	- add missing _CEI_TO_EI/_TO_CEI.
	- don't use 'cl' before assert it's non NULL.
	- handle s==NULL case of wcrtomb.
	- add a comment about it.
	Fix rest of PR 18269 by wurlitzer.
	[yamt, ticket #1202]

sbin/fdisk/fdisk.c				1.55

	Add partition type 0xaf for Apple HFS.
	[jdarrow, ticket #1205]

sbin/fdisk/fdisk.c				1.56

	Make the -l flage more useful, by actually printing the systype number
	alongside the sysid string (instead of just the array index of the
	struct part_type they are found in).
	Now fdisk -l shows the familiar 169 for NetBSD, 165 for FreeBSD or
	386BSD or old NetBSD, and other possibly-familiar (131 for Linux
	native,	015 for Ext. Partition - LBA) values in with their correct
	numbers.
	[jdarrow, ticket #1206]

sys/uvm/uvm_bio.c				1.27

	For PMAP_CACHE_VIVT platforms, make UBC_RELEASE_UNMAP evaluate to TRUE,
	and add a comment explaining why.
	[thorpej, ticket #1207]

usr.sbin/rtadvd/rtadvd.c			1.27-1.28

	Add missing ND option length validation.  from kame
	correct use of sizeof
	[itojun, ticket #1212]

share/misc/style				1.23

	Return value style update (no parentheses)
	[mason, ticket #1191]

sys/dev/pci/if_sip.c				1.78

	Add a work-around for the "short cable problem" that some DP83815
	revisions have, as discussed on the soekris-tech mailing list a
	while ago, whereby one can experience excessive recieve erros when
	using < 30m cables.  The patch detects overflow in a DSP filter
	parameter, and corrects it by writing a known good value.
	[thorpej, ticket #1228]

crypto/dist/ssh/auth.c				1.18

	Add missing
		hp = strtok(NULL, ",");
	to end of while loop which parses "host.allow" from login.conf(5).
	Otherwise, sshd(8) would just infinite loop unless there was a
	(positive or negative) match in the first word of the "host.allow"
	list...
	[lukem, ticket #1231]

libexec/lfs_cleanerd/cleanerd.c			1.40

	For -b, use ssize instead of segshift.
	Segshift is invalid for v2 filesystems.
	[toshii, ticket #1232]

usr.bin/mail/popen.c				1.15

	Fix a bug introduced by Christos Zoulas in version 1.4.
	He accidently moved the call to block the SIGCHLD to the wrong side of
	the call to findchild().
	Caused a coredump in one in every N thousand invocations of mail,
	which I have been hunting for literally years.
	Fixes PR 19696 from Mason Loring Bliss, too.
	[perry, ticket #1236]

share/man/man8/man8.amiga/boot.8		1.8
share/man/man8/man8.amiga/installboot.8		1.19

	Fix typos reported by Igor Sobrado (PR port-amiga/20950).
	[is, ticket #1238]

sys/uvm/uvm.h					1.32

	Protect "struct uvm" with _KERNEL.
	[cjep, ticket #1240]

sys/netinet6/in6_pcb.c				1.53

	Include opt_inet.h -- found by David Laight
	[itojun, ticket #1241]

etc/rc.d/bootconf.sh				1.7

	Variable substitution happens at trap installation time, not at trap
	execution time - so it used to print "Using default configuration of
	/etc/passwd".
	[is, ticket #1242]

bin/csh/csh.1					1.37

	Additional text & formatting for the csh "limit" command;
	hopefully this satisfies PR 11658
	[fair, ticket #1243]

libexec/talkd/talkd.c				1.16

	verify strvis() buffer length is enough.  make sure string termination
	before use.  remove extra ntohs() which is not needed.  from Charles
	Blundell
	[itojun, ticket #1001]

sys/dev/scsipi/ses.c				1.19-1.20

	The Double-Semi-Colon Police.

	kern/20231- pass the correct argument (arg_addr) on thru to
	scsipi_do_ioctl, not the locally dereferenced fetch.
	[mjacob, ticket #1162]

sys/dev/pci/agp.c				1.26

	Don't match a PCI graphics card in a system which supports an AGP.
	Patch supplied by Quentin Garnier in PR kern/19256.
	[tron, ticket #1181]
