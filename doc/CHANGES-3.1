#	$NetBSD: CHANGES-3.1,v 1.1.2.5 2005/12/30 01:21:41 riz Exp $

A complete list of changes from the NetBSD 3.0 release to the NetBSD 3.1
release:

File						Revision(s)
----						--------
gnu/usr.bin/groff/tmac/mdoc.local		patch
sys/sys/param.h					patch

	Welcome to 3.0_STABLE

doc/README.files				patch

	Update for release and new CHANGES-3.1 file.

include/mntopts.h				1.6
lib/libc/sys/mount.2				1.33
sbin/mount/mount.8				1.47
share/man/man4/options.4			1.280 via patch
share/man/man7/symlink.7			1.7
sys/conf/files					1.720
sys/conf/newvers.sh				1.41
sys/kern/init_main.c				1.248 via patch
sys/kern/vfs_lookup.c				1.61
sys/kern/vfs_syscalls.c				1.223
sys/sys/fstypes.h				1.4
sys/sys/systm.h					1.179

	Implement expansion of special "magic" strings in symlinks into
	system-specific values.  Submitted by Chris Demetriou in Nov 1995 (!)
	in PR kern/1781, modified only slighly by me.
	This is enabled on a per-mount basis with the MNT_MAGICLINKS mount
	flag.  It can be enabled at mountroot() time by building the kernel
	with the ROOTFS_MAGICLINKS option.
	[thorpej, ticket #490]

sys/kern/vfs_lookup.c				1.63

	A few tweaks to magic symlinks:
	- Add a @{var} syntax in addition to @var.  This allows for  
	patterns like
	@{ostype}-@{osrelease}-@{machine_arch}.
	- Add a @emul variable that expands to the process's emulation name
	(e.g. "netbsd", "netbsd32", "linux", etc.)
	[thorpej, ticket #559]

share/man/man7/symlink.7			1.9

	Document the new @emul magic symlink var as well as the new @{var}  
	syntax.
	[thorpej, ticket #560]

usr.sbin/pkg_install/add/perform.c		1.115

	(pkg_do) When marking already installed package as manually installed,
	only print message if we succeeded.
	[dillo, ticket #1039]

sys/dev/mii/brgphy.c				1.24-1.25
sys/dev/mii/miidevs				1.61
sys/dev/mii/miidevs.h				regen
sys/dev/mii/miidevs_data.h			regen

	Add support for bcm5714 phys.
	[jonathan, ticket #1044]

sys/dev/scsipi/sd.c				1.242-1.243

	Some USB devices reports themselves as removable, but have no door and
	so don't support the SCSI_PREVENT_ALLOW_MEDIUM_REMOVAL command.
	When an "Illegal field in CDB" is reported for this command, mark the
	device as non-removable (which is always true for USB keys from the SCSI
	point of view), print a message and ignore the error.
	For DIOCLOCK, return ENOTTY if the device is not removable instead of
	trying a command which will fail.
	[bouyer, ticket #1045]

usr.bin/gzip/gzip.c				1.81

	Remove unhandled H option from getopt() argument.
	Describe -l in usage. Both from Igor Sobrado in private mail.
	While here, sort options.
	[wiz, ticket #1053]

sys/netinet/udp_usrreq.c			1.144

	Fix a bug in ESP over UDP: because udp4_espinudp() called m_pullup, it
	could modify the struct mbuf and calling functions (udp_input() and
	udp4_realinput()) would have used a garbled local copy of the pointer.
	The fix is not perfect. udp4_espinudp() should use m_pulldown()...
	[manu, ticket #1052]

lib/libdes/ornd_keys.c				1.2

	Fix wrong buffer size calculation. From Henning Petersen in PR
	lib/32291.
	[martin, ticket #1056]

usr.bin/su/su.1					1.45 via patch

	Give a general description what this command does before going into
	all the details.
	[hubertf, ticket #1060]

share/mk/bsd.README				1.167

	document MKINET6 and USE_INET6
	[hubertf, ticket #1066]

lib/libc/gen/getcwd.c				1.41

	Allow last component to be non-existing again.
	This is what broke systrace's filename normalization.
	Go back to original behavior as in revision 1.35: return resolved name,
	but also set errno to ENOENT.
	[elad, ticket #1068]

sys/dev/pci/azalia.c				1.12-1.15
sys/dev/pci/azalia.h				1.1-1.3
sys/dev/pci/azalia_codec.c			1.1-1.3
sys/dev/pci/files.pci				1.239

	Improve support for ALC880/ALC882 codec.
	[kent, ticket #916]

sys/dev/ic/rtl81x9reg.h				1.14
sys/dev/pci/if_re_pci.c				1.12

	PR/32386: Dawid Szymanski (arhea). Add support for the 8169SB chipset.
	From FreeBSD.
	[rpaulo, ticket #1070]

sys/kern/kern_subr.c				1.122

	hold kernel_lock while calling systrace_exit().
	fixes PR 25856.
	[chs, ticket #1072]

sbin/newfs/newfs.8				1.67 via patch

	Xref newfs_msdos, noted by rabioli on Freenode #NetBSD
	[hubertf, ticket #1073]

sys/kern/kern_systrace.c			1.50 via patch

	in systrace_make_msg(), sleep uninterruptibly while waiting for
	the response from the systrace daemon, so that the message protocol
	between the kernel and the daemon doesn't get out of sync.
	fixes PR 29654.
	[chs, ticket #1071]

