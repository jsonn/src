#	$NetBSD: CHANGES-3.1,v 1.1.2.106 2006/06/12 13:02:47 tron Exp $

A complete list of changes from the NetBSD 3.0 release to the NetBSD 3.1
release:

File						Revision(s)
----						--------
gnu/usr.bin/groff/tmac/mdoc.local		patch
sys/sys/param.h					patch

	Welcome to 3.0_STABLE

doc/README.files				patch

	Update for release and new CHANGES-3.1 file.

usr.sbin/pkg_install/add/perform.c		1.115

	(pkg_do) When marking already installed package as manually installed,
	only print message if we succeeded.
	[dillo, ticket #1039]

sys/dev/mii/brgphy.c				1.24-1.25
sys/dev/mii/miidevs				1.61
sys/dev/mii/miidevs.h				regen
sys/dev/mii/miidevs_data.h			regen

	Add support for bcm5714 phys.
	[jonathan, ticket #1044]

sys/dev/scsipi/sd.c				1.242-1.243

	Some USB devices reports themselves as removable, but have no door and
	so don't support the SCSI_PREVENT_ALLOW_MEDIUM_REMOVAL command.
	When an "Illegal field in CDB" is reported for this command, mark the
	device as non-removable (which is always true for USB keys from the SCSI
	point of view), print a message and ignore the error.
	For DIOCLOCK, return ENOTTY if the device is not removable instead of
	trying a command which will fail.
	[bouyer, ticket #1045]

usr.bin/gzip/gzip.c				1.81

	Remove unhandled H option from getopt() argument.
	Describe -l in usage. Both from Igor Sobrado in private mail.
	While here, sort options.
	[wiz, ticket #1053]

sys/netinet/udp_usrreq.c			1.144

	Fix a bug in ESP over UDP: because udp4_espinudp() called m_pullup, it
	could modify the struct mbuf and calling functions (udp_input() and
	udp4_realinput()) would have used a garbled local copy of the pointer.
	The fix is not perfect. udp4_espinudp() should use m_pulldown()...
	[manu, ticket #1052]

lib/libdes/ornd_keys.c				1.2

	Fix wrong buffer size calculation. From Henning Petersen in PR
	lib/32291.
	[martin, ticket #1056]

usr.bin/su/su.1					1.45 via patch

	Give a general description what this command does before going into
	all the details.
	[hubertf, ticket #1060]

share/mk/bsd.README				1.167

	document MKINET6 and USE_INET6
	[hubertf, ticket #1066]

lib/libc/gen/getcwd.c				1.41

	Allow last component to be non-existing again.
	This is what broke systrace's filename normalization.
	Go back to original behavior as in revision 1.35: return resolved name,
	but also set errno to ENOENT.
	[elad, ticket #1068]

sys/dev/pci/azalia.c				1.12-1.15
sys/dev/pci/azalia.h				1.1-1.3
sys/dev/pci/azalia_codec.c			1.1-1.3
sys/dev/pci/files.pci				1.239

	Improve support for ALC880/ALC882 codec.
	[kent, ticket #916]

sys/dev/ic/rtl81x9reg.h				1.14
sys/dev/pci/if_re_pci.c				1.12

	PR/32386: Dawid Szymanski (arhea). Add support for the 8169SB chipset.
	From FreeBSD.
	[rpaulo, ticket #1070]

sys/kern/kern_subr.c				1.122

	hold kernel_lock while calling systrace_exit().
	fixes PR 25856.
	[chs, ticket #1072]

sbin/newfs/newfs.8				1.67 via patch

	Xref newfs_msdos, noted by rabioli on Freenode #NetBSD
	[hubertf, ticket #1073]

sys/kern/kern_systrace.c			1.50 via patch

	in systrace_make_msg(), sleep uninterruptibly while waiting for
	the response from the systrace daemon, so that the message protocol
	between the kernel and the daemon doesn't get out of sync.
	fixes PR 29654.
	[chs, ticket #1071]

sys/arch/i386/i386/est.c			1.13

	PR kern/32418: Support for the Pentium M 770.
	[xtraeme, ticket #1075]

xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_dac.c 1.8
xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_driver.c 1.7
xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_hw.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_include.h 1.2
xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_setup.c 1.7
xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_type.h 1.6
xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_video.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/riva_driver.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/riva_include.h 1.2

	Sync the Nvidia drivers with XFree86's sources as of December 24th,
	2005.  These changes fix lots of problems (i.e. freezes) with the
	latest cards (such as a GeForce 6600GT).
	[jmmv, ticket #1074]

sys/arch/sparc64/dev/consinit.c			1.20

	Check the PROM stdin path for the string "/usb@0".  If we find a
	match, call ukbd_cnattach(), so that the USB keyboard will become
	the console keyboard.  Makes the keyboard work on a Blade 100. 
	[jdc, ticket #1076]

lib/libc/gen/getcwd.c				1.42

	Revert back to revision 1.40, as requested by cube@.
	Unbreaks KDE.
	[elad, ticket #1077]

bin/systrace/intercept.c			1.26
bin/systrace/intercept.h			1.18

	Give systrace its own version of realpath() that does what it wants,
	call it intercept_realpath().  Unbreaks systrace.
	[elad, ticket #1078]

sys/arch/i386/i386/identcpu.c			1.19

	Add missing entries in cache information array for, at least,
	Pentium M 770, 760, 750, 740 and 730.
	[tron, ticket #1079]

xsrc/xfree/xc/programs/Xserver/hw/netbsd/alpha/alphaFbs.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/netbsd/amiga/amigaFbs.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/netbsd/dec/decFbs.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/netbsd/dreamcast/dreamcastScreen.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/netbsd/hpc/hpcScreen.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/netbsd/macppc/macppcFbs.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/netbsd/newsmips/newsmipsScreen.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/netbsd/pmax/pmax_io.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/netbsd/vax/mono_io.c 1.2
xsrc/xfree/xc/programs/Xserver/hw/netbsd/x68k/x68kFb.c 1.2

	XFree86 4.x now passes SCREEN_SAVER_CYCLE to the display driver.  The
	netbsd non-xfree86 servers treated this as an unblank event.  If the
	server is set to prefer blanking, and has a cycle time, the sreen will
	initially blank when the screen saver activates, and then unblank after
	the cycle time and stay unblanked.  Treat the SCREEN_SAVER_CYCLE state
	the same as SCREEN_SAVER_ON to keep the display blanked.
	[mhitch, ticket #1080]

gnu/dist/binutils/bfd/elf32-sh.c		1.2

	Don't reset relocation for R_SH_REL32 in shared objects if the
	symbol is locally called.  Makes hidden and protected symbols
	in shared objects work.
	[uwe, ticket #1081]

gnu/dist/gdb/gdb/shnbsd-tdep.c			1.4

	Handle the case when control transfer instruction jumps to its own
	delay slot (e.g. PLT entries use such code).  We can not set the
	breakpoint there, as trapa is illegal in the delay slot.  Set the
	breakpoint to the next instruction instead.  We are guaranteed to
	arrive there, as control transfers are illegal in the delay slot.
	[uwe, ticket #1082]

sys/arch/xen/conf/files.xen			1.29
sys/arch/xen/xen/hypervisor.c			1.16
sys/arch/xen/xen/if_xennet.c			1.31
sys/arch/xen/xen/xbd.c				1.22

	Define a xendevbus attribute and add it to hypervisor.  Use it for
	xen devices which attach to hypervisor. This allows to use
	config_found_ia() instead of config_found(), instead of relying
	on the order of which device are written in ioconf.c.
	[bouyer, ticket #1083]

sys/arch/xen/xen/if_xennet.c			1.32,1.36

	Replace MEXTMALLOC/memcpy with m_copyback().
	[bouyer, ticket #1084]

sys/arch/xen/i386/hypervisor_machdep.c		1.13
sys/arch/xen/include/hypervisor.h		1.15
sys/arch/xen/xen/hypervisor.c			1.17

	inline 2 trivial functions that are called often (according to
	profiling data).
	[bouyer, ticket #1085]

sys/dev/pci/pcidevs				1.755
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/viaide.c				1.27

	Add support for nForce430 ATA133 and SATA controllers. My disks now run
	at a decent speed.
	[manu, ticket #1086]

sys/dev/pci/pciide_common.c			1.29

	Fix forcing use of DMA mode for the generic pciide driver:
	default_chip_map() is called from pciide_attach() and at this point
	we don't know which drives are here. Just assume all drives are
	there and allocate DMA ressources for all of them.
	[bouyer, ticket #1087]

sbin/newfs/mkfs.c				1.93

	The -b option is really on fsck_ffs, not fsck.
	[hubertf, ticket #1088]

sys/fs/union/union_vfsops.c			1.32

	Change union_unmount() to not play with the fs root vnode explicitly.
	Let it get recycled along with all of the others. This is important
	as if the root vnode has already been reclaimed, then we get a panic
	when we try to vget it.  This addresses PR: kern/31382
	[wrstuden, ticket #1091]

sys/net/if_gif.h				1.11
sys/netinet/in_gif.c				1.45
sys/netinet6/in6_gif.c				1.43

	expire cached route. Fixes PR 22792.
	[mlelstv, ticket #1092]

lib/libpthread/arch/i386/pthread_switch.S	1.9
lib/libpthread/arch/sparc/pthread_switch.S	1.8
lib/libpthread/arch/sparc64/pthread_switch.S	1.9
lib/libpthread/arch/x86_64/pthread_switch.S	1.11

	Make libpthread really shared, i.e. not have text reocations.
	[skrll, ticket #1093]

share/man/man9/pfil.9				1.30 via patch

	pfil_add_hook() and pfil_remove_hook() return int, not void.
	[riz, ticket #1110]

sys/net/if_bridge.c				1.35

	Make sure we initialize all structs to 0.
	[christos, ticket #1111]

sys/dev/pci/pcidevs				1.753-1.1754
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	- Spell NVIDIA as "NVIDIA" instead of "Nvidia".
	- Add entry for builtin ethernet of NVIDIA nForce4 chipset.
	[tron, ticket #1112]

lib/libpthread/arch/sh3/pthread_switch.S	1.6
sys/arch/sh3/include/asm.h			1.18-1.24

	Implement WARN_REFERENCES. Provide PIC macros. Adapt pthread_switch.S
	to new PIC macros that are now in <machine/asm.h>.
	[uwe, ticket #1094]

lib/libpthread/arch/sh3/_context_u.S		1.5

	In PIC code call setcontext(2) via PLT to avoid text reloc in the
	shared library.
	[uwe, ticket #1095]

lib/libpthread/arch/x86_64/pthread_switch.S	1.12

	Revert the locked_return_point change. This fixes PR bin/32479.
	[skrll, ticket #1115]

lib/libc/arch/sh3/gen/swapcontext.S		1.4-1.8

	Use PLT for PIC calls to avoid text reloc in the shared library.
	[uwe, ticket #1096]

lib/libc/arch/sh3/sys/syscall.S			1.6
lib/libc/arch/sh3/sys/exect.S			1.5
lib/libc/arch/sh3/sys/__syscall.S		1.6

	Replace with macros from SYS.h, no special treatment is necessary.
	Avoid open-coded calls to cerror.
	[uwe, ticket #1097]

sys/arch/sh3/include/setjmp.h			1.3

	Provide defines for offsets into the jump buffer.
	[uwe, ticket #1098]

lib/libpthread/arch/sh3/pthread_switch.S	1.7

	Use PLT for PIC calls to avoid text relocs in the shared library.
	[uwe, ticket #1099]

sys/arch/xen/xen/xbdback.c			1.16 via patch

	Avoid dom0 kernel crash when destroying a domain with active I/O going.
	[bouyer, ticket #1106]

sys/arch/xen/i386/npx.c				1.7

	Fix the FPU problems detected by paranoia on a NetBSD/Xen guest,
	PR port-xen/30977.
	[bouyer, ticket #1107]

lib/libc/arch/sparc/sys/ptrace.S		1.6-1.7

	Use __errno in the _REENTRANT case.
	[martin, ticket #1109]

sys/dev/raidframe/rf_netbsdkintf.c		1.193

	We need to mark used spares as failed if they encounter IO errors.
	[oster, ticket #1114]

sys/arch/xen/i386/pmap.c			1.14
sys/arch/xen/include/pmap.h			1.5
sys/arch/xen/xen/privcmd.c			1.6
sys/arch/xen/xen/xbdback.c			1.15
sys/arch/xen/xen/xennetback.c			1.12 via patch

	Add a vm_prot_t parameter to pmap_remap_pages(), and use it for
	the new PTE instead to always trying PG_RW and falling back to
	PG_RO if this fails.  Use uvm_map_checkprot() in IOCTL_PRIVCMD_MMAP
	and IOCTL_PRIVCMD_MMAP_BATCH to compute the appropriate
	vm_prot_t for pmap_remap_pages().  Thanks to Jed Davis for
	pointing out uvm_map_checkprot().
	[bouyer, ticket #1104]

sys/dev/ic/ninjascsi32.c			1.6

	- Fix diagnostic panic for unaligned DMA buffer.
	- Fix error cleanup path in attach.
	[itohy, ticket #1117]

lib/libcurses/touchwin.c			1.21

	Don't crash if asked to touch more lines than there are in a window.
	[jdc, ticket #1108]

sys/net/if_tap.c				1.7
share/man/man4/tap.4				1.5

	Set bit 0x2 of the first byte of the generated MAC address, to
	indicate it is a locally administered address.  Pointed out by
	Ignatios Souvatzis.
	[cube, ticket #1113]

sys/arch/i386/conf/GENERIC_LAPTOP		1.166

	Add commented out entries for BRIDGE_IPF, pf(4) and pflog(4) matching
	the entries in "GENERIC".
	[tron, ticket #1116]

lib/libwrap/hosts_access.c			1.18

	Use ntohl(host_address) so that RBL lookups work on little-endian hosts.
	Tested on alpha, i386 and sparc64.  Fixes PR#30402.
	[jdc, ticket #1118]

sys/dev/pci/pccbb.c				1.127

	Use aprint_debug() instead of printf() for obvious debug statement.
	[uwe, ticket #1120]

sys/arch/hpcsh/hpcsh/autoconf.c			1.17

	#include "opt_md.h" as this file uses MEMORY_DISK_* options.
	[uwe, ticket #1121]

sys/conf/files					1.752

	tap(4) depends on arp:  it is an Ethernet interface, after all.
	Solves PR#32548 by Pawel Chwalowski.
	[cube, ticket #1122]

sys/dev/pci/pcidevs				1.739
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/pdcsata.c				1.4

	PR#32238: Ryo Shimizu: Add support for Promise SATA300TX4 SATA
	Controller (PDC40718)
	[simonb, ticket #1126]

sys/compat/ossaudio/ossaudio.c			1.48

	Fix problem in ioctl() handling in OSS audio emulation which caused
	unintentional changes of the audio settings e.g. when running "kphone".
	[tron, ticket #1127]

lib/libc/arch/sh3/gen/__setjmp14.S		patch
lib/libc/arch/sh3/gen/__sigsetjmp14.S		patch
lib/libc/arch/sh3/gen/setjmp.S			patch
lib/libc/arch/sh3/gen/sigsetjmp.S		patch

	Use PLT for PIC calls to avoids text relocs in the shared library.
	[uwe, ticket #1100]

lib/libc/arch/sh3/SYS.h				1.7-1.9
lib/libc/arch/sh3/sys/__clone.S			1.4-1.6
lib/libc/arch/sh3/sys/brk.S			1.10
lib/libc/arch/sh3/sys/cerror.S			1.8-1.10
lib/libc/arch/sh3/sys/fork.S			1.9
lib/libc/arch/sh3/sys/ptrace.S			1.7
lib/libc/arch/sh3/sys/sbrk.S			1.9
lib/libc/arch/sh3/sys/sigprocmask.S		patch
lib/libc/arch/sh3/sys/sigsuspend.S		patch

	Eliminate text relocations in libc.so.
	[uwe, ticket #1101]

lib/libc/arch/sh3/sys/__vfork14.S		1.6
lib/libc/arch/sh3/sys/Ovfork.S			patch

	Use JUMP_CERROR instead of messing with errno directly.
	Simplify.
	[uwe, ticket #1102]

lib/libc/arch/sh3/sys/ptrace.S			1.8

	Provide _REENTRANT version of errno = 0;
	[uwe, ticket #1103]

sys/arch/xen/include/if_xennetvar.h		1.8
sys/arch/xen/xen/if_xennet.c			1.33-1.35 via patch

	- Use MCLGET() instead of local list of buffers.
	- Garbage-collect struct xennet_txbuf usage.
	- Don't allocate cluster mbufs unless needed.
	- Remove no longer used macros.
	[bouyer, ticket #1105]

sys/dev/usb/ums.c				1.61-1.62

	- Support more than 7 buttons for USB mice. This fixes PR kern/30248.
	- Look for a wheel before looking for a Z dir. This makes Apple's
	  Mightymouse work.
	[uwe, ticket #1119]

sys/dev/pci/ehci_pci.c				1.22
sys/dev/usb/ehci.c				1.108
sys/dev/usb/ehcivar.h				1.23

	Add a workaround for VIA EHCI controllers to prevent unrecoverable
	umass(4) stalls.
	[xtraeme, ticket #1123]

sys/dev/ic/wdc.c 1.231

        After a reset don't wait for drives to come ready if there's no
        drives.  fix a 30s hang after resume. Problem reported and fix
	tested by Brian de Alwis.
	[bouyer, ticket #1125]

	tested by Brian de Alwis.
	[bouyer, ticket #1125]

lib/libc/rpc/xdr_rec.c				1.26

	John Kohl: xdr_rec.c missing a bugfix for an improper security
	check.  The correct way to check for a zero record length is to
	check for it without the LAST_FRAG marker in it, since it's legal
	to send a LAST_FRAG marker with 0 bytes of data.  PR#32572

	[christos, ticket #1128]

sys/dev/pci/azalia.c				1.17-1.19
sys/dev/pci/azalia.h				1.5-1.6
sys/dev/pci/azalia_codec.c			1.5-1.7

	- Code cleanup.
	- Various bug fixes including PR port-i386/32485.
	- Support for 8ch playback with STAC9221D codec.
	[kent, ticket #1124]

distrib/amiga/stand/Makefile			1.2
distrib/amiga/stand/loadbsd-2.14.gz.uue		delete
distrib/amiga/stand/loadbsd-2.16.gz.uue		delete
distrib/amiga/stand/loadbsd-2.16.uue		1.1
distrib/amiga/stand/rdbinfo.gz.uue		delete
distrib/amiga/stand/xstreamtodev.gz.uue		delete

	Only provide uncompressed tools, so that they can be run directly
	from CD-ROM, and buggy CD-ROM file systems aren't confused by two
	tools with the same prefix.
	[is, ticket #1129]

distrib/amiga/miniroot/install.md		1.25
distrib/miniroot/install.sh			1.23
distrib/miniroot/upgrade.sh			1.21

	Don't ask for the root device before the user had a chance to
	identify how it's called under NetBSD.
	[is, ticket #1130]

sys/arch/i386/pnpbios/pciide_pnpbios.c		1.22 via patch

	Update pciide at pnpbios to work with the last changes to wdc(4),
	especially the deferral of drive probe. This fixes PR kern/23192.
	[bouyer, ticket #1131]

sys/dev/ata/wd.c				1.318

	Fix support for 1 and 2TB disks (tested under qemu).
	[abs, ticket #1132]

sys/arch/i386/i386/est.c			1.15

	PR port-i386/32606: Add support for the Pentium M 710.
	[xtraeme, ticket #1134]

sys/dev/pci/auixp.c				1.11

	Duh! If askes to halt the input dont halt the output instead. This
	also fixes the timeout on draining when closing.
	[reinoud, ticket #1138]

sys/dist/pf/net/pf_norm.c			1.11

	Fix a bug in the fragment cache which could cause kernel panics.
	[peter, ticket #1139]

lib/libc/stdio/fseek.c				1.22

	Must include "namespace.h" for fseeko()'s internal name.
	[kleink, ticket #1140]

lib/libc/include/namespace.h			1.110
lib/libc/rpc/mt_misc.c				1.5

	Need to give the various rpc locks private names (prefixing them with
	__rpc_).  Rather than scattering changes around the 3rd-party RPC
	code, place them in namespace.h.
	[kleink, ticket #1142]

sys/sys/socket.h				1.78

	Since NULL isn't necessarily available, change CMSG_*() to use the
	integer constant expression directly instead.
	[kleink, ticket #1143]

share/termcap/termcap.src			1.95

	Wscons terminals only have 8 colours and don't need an NC entry.
	Fixes PR misc/32135 by Pavel Cahyna.
	[jdc, ticket #1144]

sys/arch/hp300/stand/common/ite_dv.c		1.6
sys/arch/hp300/stand/common/ite_gb.c		1.6
sys/arch/hp300/stand/common/ite_hy.c		1.6
sys/arch/hp300/stand/common/ite_rb.c		1.6
sys/arch/hp300/stand/common/ite_tc.c		1.6

	Fix bootloader so it doesn't print garbage to the bitmap console.
	[tsutsui, ticket #1145]

sys/arch/mac68k/dev/sbc.c			1.49

	Add fault-protection in sbc_pdma_in() like in all the other PDMA
	functions. This fixes PR port-mac68k/9679.
	[chs, ticket #1146]

sys/arch/sparc/include/param.h			1.64

	Increase NKMEMPAGES_MAX_DEFAULT to 32 MB. This is needed on sun4m
	machines with 512 MB of RAM, and it doesn't seem to cause any
	problems on sun4c.
	[chs, ticket #1147]

sys/dev/rcons/rcons_subr.c			1.16

	Avoid watchdog reset caused by output of certain characters on the
	console. This fixes PR port-sparc/29948.
	[chs, ticket #1148]

sys/dev/pci/viaide.c				1.28

	The NVidia nForce430 IDE Controller supports Ultra-DMA Mode 6,
	enable it.
	[xtraeme, ticket #1149]

libexec/ld.elf_so/rtld.c			1.109

	Fix a bug that showed up when debugging dynamically linked programs.
	References from GDB to "printf" and various other functions would
	find the versions in the dynamic linker itself, rather than the
	versions in the program's libc. This fixes PR toolchain/32074.
	[christos, ticket #1150]

sys/arch/i386/conf/XEN0				1.26

	Change number of vnd to 32 from 4, since many users of XEN0 will need
	more.
	[gdt, ticket #1151]

sys/net/if_pppoe.c				1.64

	Make sure error messages (received from the access concentrator) are
	zero terminated.
	[martin, ticket #1152]

sys/dev/pcmcia/aic_pcmcia.c			patch
doc/HACKS					patch

	aic(4): work around rbus resource allocation problem so cards work
	again.
	[jnemeth, ticket #1153]

sys/arch/xen/xen/if_xennet.c			1.42 via patch
sys/arch/xen/xen/xennetback.c			1.20 via patch

	Check the destination ethernet address when not in promiscous mode.
	Fix problem where packets would be duplicated, possibly looping, when
	a domU is doing IP routing.
	[bouyer, ticket #1155]

share/man/man4/pdcsata.4			1.2
sys/dev/pci/pcidevs				1.758
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/pdcsata.c				1.6

	Add support for Promise PDC2057x SATA/150 IDE controllers.
	From FreeBSD, tested by Douglas Wade Needham.
	[bouyer, ticket #1156]

sys/arch/xen/i386/xen_machdep.c			1.16

	Fix bad cut'n'paste: use the target of strncpy() in sizeof().
	[bouyer, ticket #1157]

sys/dev/pci/amdpm.c				1.9

	PR/32220: Murray Armfield: Enable AMD768 random no generator.
	[tls, ticket #1158]

share/man/man4/amdpm.4				1.4
sys/dev/pci/amdpm.c				1.10

	Add support for the AMD8111 RNG; from Nicolas Joly in PR kern/32284.
	[tls, ticket #1159]

distrib/sets/lists/base/md.alpha		1.35
sys/arch/alpha/stand/Makefile			1.16
sys/arch/alpha/stand/boot/filesystem.c		1.11
sys/arch/alpha/stand/bootxx_ffsv2/Makefile	1.1

	Support booting from ffsv2 filesystems.
	[abs, ticket #738]

sys/dev/pci/if_sip.c				1.104
sys/dev/pci/if_wm.c				1.111

	In the receive interrupt handler, compute the packet length before  
	resetting m to point to the first buffer in the packet. The bug would
	cause the length of jumbo frames to be incorrect.
	[thorpej, ticket #1161]

sys/net/if_bridge.c				1.36

	Fix memory disclosure in bridge(4).
	[adrianp, ticket #1163]

usr.sbin/wsconscfg/wsconscfg.8			1.16-1.17

	Sort options. New sentence, new line. Fix typo.
	[jmmv, ticket #1162]

distrib/sparc/install.md			1.20
distrib/sparc/miniroot/list			1.29

	Change the old pre-sysinst install.md script to not need file(1)
	and take that program and its associated "magic" database
	out of the miniroot image. This fixes PR port-sparc/32379.
	[chs, ticket #1163]

sys/arch/sparc/include/vmparam.h		1.38

	Reduce MAXSSIZ to 32 MB, like most other ports. This fixes
	PR port-sparc/30918.
	[chs, ticket #1165]

sys/arch/amd64/amd64/pmap.c			patch
sys/arch/amd64/include/param.h			1.2

	Increase NKMEMPAGES_MAX_DEFAULT to 1 GB.
	This allows lots more memory to be used for amaps, etc..
	[chs, ticket #1166]

sys/arch/i386/pci/pchb.c			1.57
sys/arch/i386/pci/pchb_rnd.c			1.16
sys/dev/pci/agp.c				1.37
sys/dev/pci/agp_ali.c				1.9
sys/dev/pci/agp_amd.c				1.14
sys/dev/pci/agp_i810.c				1.28
sys/dev/pci/agp_intel.c				1.17
sys/dev/pci/agp_sis.c				1.8
sys/dev/pci/agp_via.c				1.9
sys/dev/pci/agpreg.h				1.10
sys/dev/pci/agpvar.h				1.11
sys/dev/pci/pcidevs				1.723,1.757
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add agp(4) support for Intel i915 chipset integrated graphics.
	This fixes PR port-i386/32550.
	[tron, ticket #1168]

sys/arch/i386/pci/pchb_rnd.c			1.17-1.18
sys/dev/pci/pcidevs				1.763,1.765
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add hardware RNG support for Intel i925X, i945G/P and i955X chipsets.
	[tron, ticket #1169]

sys/dev/raidframe/rf_driver.c			1.110
sys/dev/raidframe/rf_psstatus.c			1.31
sys/dev/raidframe/rf_psstatus.h			1.13

	RAIDframe was erroneously re-initializing the Parity Stripe Status
	pool each time a new array was configured.  This causes grief
	with things like 'vmstat -m' by causing it to loop.  Make RAIDframe
	only initialize PSS bits once.
	[oster, ticket #1170]

usr.bin/systat/ps.c				1.28

	Print system processes' command names in square brackets, like ps(1)
	does.
	[kleink, ticket #1172]

gnu/dist/binutils/ld/ChangeLog			1.2 via patch
gnu/dist/binutils/ld/emulparams/elf32btsmip.sh	1.2

	Pull in a change form binutils-current that removes the gap between
	text and data on mips platforms which was dragged over from the
	Irix defaults.
	[skrll, ticket #1173]

tools/gcc/README.mknative			1.5 via patch
tools/toolchain/README.mknative			1.7

	I haven't touched the mknative stuff since 2002. Take my name off of
	the readmes, so I'm not implied as a point of contact.
	[tv, ticket #1174]

sys/arch/alpha/pci/pci_6600.c			1.14

	Fix to properly add the dec_6600 interrupt event counters so the
	interrupt counts can be displayed.
	[mhitch, ticket #1175]

lib/libpam/modules/pam_nologin/pam_nologin.c	1.6

	Use the class of the user, not then default class, when checking for
	nologin and ignorelogin login.conf(5) capabilities.
	[bouyer, ticket #1176]

sys/dist/pf/net/pf.c				1.21

	Fix TCP/UDP checksum handling. This fixes PR kern/32874.
	[peter, ticket #1177]

sbin/ccdconfig/ccdconfig.c			1.42
sys/dev/ccd.c					1.108

	Fix "ccdconfig -g".
	[lukem, ticket #1178]

sys/dev/DEVNAMES				1.192 via patch
sys/dev/i2c/adt7463.c				1.1
sys/dev/i2c/adt7463reg.h			1.1
sys/dev/i2c/files.i2c				1.7 via patch
sys/dev/pci/amdpm.c				1.11
sys/dev/pci/amdpm_smbus.c			1.1
sys/dev/pci/amdpm_smbusreg.h			1.1
sys/dev/pci/amdpmvar.h				1.1
sys/dev/pci/files.pci				1.242

	Add support for i2c bus on AMD-8111 used on many Opteron server
	motherboards, and ADT 7463c thermal and voltage monitor found on
	the Tyan S2881 and S2882-D(and probably other boards as well).
	From PR kern/32463.
	[tls, ticket #1179]

sys/arch/amd64/conf/GENERIC			1.87
sys/arch/i386/conf/GENERIC			1.727

	Add amdpm(4). This fixes PR kern/32463.
	[tls, ticket #1180]

sys/arch/i386/pci/pchb_rnd.c			patch

	Improve code probing for the Intel hardware RNG to avoid false
	detections.
	[tron, ticket #1181]

sys/dev/pci/twe.c				1.74

	Fix memory leak in the TWEIO_GET_PARAM ioctl.
	[simonb, ticket #1182]

gnu/dist/diffutils/src/sdiff.c			1.2

	Merge the check_child_status function from diffutils-2.8.7.
	The rest of the gnu/dist/diffutils tree remains at version 2.8.1.
	[apb, ticket #1183]

usr.sbin/etcupdate/etcupdate			1.23-1.25,1.28
usr.sbin/etcupdate/etcupdate.8			1.11

	Give etcupdate the ability to use etc.tgz and xetc.tgz.
	* Expand the "-s" flag to -s {srcdir|tgzfile|tempdir}.
	* Deprecate the "-b" flag.  It is replaced by "-s tempdir".
	* Change "-s srcdir" to refer to the top of the source tree (e.g.
  	/usr/src) instead of the etc subdirectory.
	[apb, ticket #1184]

usr.sbin/etcupdate/etcupdate			1.26-1.27

	Pass BUILD=1 in make environment.
	[apb, ticket #1185]

xsrc/xfree/xc/programs/Xserver/hw/xfree86/drivers/i810/i830_driver.c 1.5

	Apply patch by David Dawes, member of the XFree86 project, which allows
	to use screen resolution larger than 640x480 with i830 chipsets.
	This fixes PR xsrc/32939 by Louis Guillaume.
	[tron, ticket #1186]

lib/libc/gen/__getmntinfo13.c			1.2
lib/libc/gen/getmntinfo.c			1.15
lib/libc/sys/statfs.c				1.4

	getmntinfo() is a compatibility function, so there is no point in
	hiding references to the compatibility getfsstat()
	The real problem behind PR lib/29919 was a stale weak_alias, so back
	out the workaround.
	[drochner, ticket #1187]

usr.bin/login/login.c				1.87

	Don't issue different message for root login on insecure terminal.
	This fixes PR lib/31059.
	[jnemeth, ticket #1198]

lib/libpam/modules/pam_securetty/pam_securetty.c 1.5
share/man/man8/afterboot.8			1.2
usr.bin/login					1.13

	Don't issue different message for root login on insecure terminal.
	This fixes PR lib/30923.
	[jnemeth, ticket #1199]

sys/compat/osf1/syscalls.master			1.42
sys/compat/osf1/osf1_syscall.h			regen
sys/compat/osf1/osf1_syscallargs.h		regen
sys/compat/osf1/osf1_syscalls.c			regen
sys/compat/osf1/osf1_sysent.c			regen

	Emulate setreuid()/setregid(). This fixes PR port-alpha/21870.
	[drochner, ticket #1188]

sys/ufs/ffs/ffs_vfsops.c			1.168

	Fix crash in mount error handling.
	[drochner, ticket #1189]

sys/arch/i386/conf/XENU				1.18

	Remove wscons options, XENU doens't have any wscons device.
	[bouyer, ticket #1190]

sys/arch/acorn26/acorn26/cpuswitch.c		1.7
sys/arch/acorn26/acorn26/vm_machdep.c		1.10

	Avoid panics under NetBSD/acorn26 whenever a process exits.
	[bjh21, ticket #1191]

sys/kern/subr_pool.c				1.112
sys/sys/pool.h					1.48

	Stop NetBSD-acorn26 from allocating eight times as much pool memory
	as it needs, leading to a rapid exhaustion of physical memory. 
	NetBSD-acorn26 now boots multi-user again.
	[bjh21, ticket #1192]

usr.bin/login/login.c				1.88

	PR bin/23616: login might not back-off as expected.
	[jnemeth, ticket #1200]

usr.bin/login/login_pam.c			1.14

	PR bin/23616: login might not back-off as expected.
	[jnemeth, ticket #1201]

sys/dev/fss.c					1.23
sys/dev/fssvar.h				1.13

	Prevent a hang when a process tries to open an fss device while
	another process is in the middle of creating a snapshot with it.
	This fixes PR kern/33060.                
	[chs, ticket #1202]

sys/dev/pci/pcidevs				1.774
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/if_rtk_pci.c			1.24

	Add recognition of Nortel Baystack 21 as an RTK8139 variant.
	This fixes PR kern/33044.
	[he, ticket #1203]

usr.bin/mail/send.c				1.24

	PR security/32978: mail(1) creates record file with insecure umask.
	[adrianp, ticket #1204]

lib/libpam/modules/pam_unix/pam_unix.c		1.10

	Fix an uninitialized variable, and remove some unreachable code.
	[jnemeth, ticket #1206]

usr.bin/systat/iostat.c				1.35

	Count both read bytes and write bytes when we are not showing
	separate read and write statistics.
	[dsl, ticket #1208]

sys/kern/exec_elf32.c				1.110-1.111

	Found by coverity issue 887.  Check for NULL before using base_ph so
	an interpreter that does not have PT_LOAD in the program header doesn't
	crash the system.
	[erh, ticket #1211]

gnu/dist/sendmail/libsm/fflush.c		1.2
gnu/dist/sendmail/libsm/local.h			1.2
gnu/dist/sendmail/libsm/refill.c		1.2
gnu/dist/sendmail/sendmail/collect.c		1.13
gnu/dist/sendmail/sendmail/conf.c		1.21
gnu/dist/sendmail/sendmail/deliver.c		1.14
gnu/dist/sendmail/sendmail/headers.c		1.14
gnu/dist/sendmail/sendmail/mime.c		1.8
gnu/dist/sendmail/sendmail/parseaddr.c		1.16
gnu/dist/sendmail/sendmail/savemail.c		1.11
gnu/dist/sendmail/sendmail/sendmail.h		1.17
gnu/dist/sendmail/sendmail/sfsasl.c		1.13
gnu/dist/sendmail/sendmail/sfsasl.h		1.6
gnu/dist/sendmail/sendmail/srvrsmtp.c		1.13
gnu/dist/sendmail/sendmail/tls.c		1.2
gnu/dist/sendmail/sendmail/usersmtp.c		1.13
gnu/dist/sendmail/sendmail/util.c		1.13
gnu/dist/sendmail/sendmail/version.c		1.17

	Apply patch 8.13.5.p0 from sendmail.org; Although we are running 8.13.4,
	this applied with mimimal fixes.
	[christos, ticket #1221]

lib/libcrypt/crypt.3				1.19

	salt is in the second argument
	[drochner, ticket #1212]

distrib/sets/lists/comp/mi			1.815
lib/libm/Makefile				1.69
lib/libm/man/lrint.3				1.1

	Add man page for l{,l}rint{,f}(3), very loosely based on the
	FreeBSD one.
	[drochner, ticket #1213]

sys/dev/cardbus/cardbus.c			1.65

	fix parsing of some informational CIS tuples: correct length and handle
	the case correctly where a string is terminated with 0x00 0xff
	[drochner, ticket #1214]

sys/dev/usb/usb.c				1.83

	Allow a NULL pointer as argument to usb_get_next_event(), and don't
	allocate a "struct usb_event" on stack in usb_add_event().
	[drochner, ticket #1215]

lib/libc/gen/frexp_ieee754.c			1.5

	scale denormal numbers, to get a meaningful exponent (and a mantissa
	which just consists of the implicit bit),
	fixes PR lib/32861 by FX Coudert
	[drochner, ticket #1216]

sys/kern/kern_sysctl.c				1.191

	Check the "oldlen" argument to sysctl(2) before passing it
	to vslock(9). This prevents a local DOS.
	[drochner, ticket #1217]

sys/arch/xen/xen/if_xennet.c			1.44

	m_copyback() doesn't work the way I expexted it: it doesn't update the
	mbuf fields, and it seems it doesn't allocate mbuf clusters for large
	packets. So revert to using MCLGET() if needed and memcpy to get the
	data in the mbuf.
	[bouyer, ticket #1218]

sbin/ifconfig/ifconfig.c			1.169
sbin/ifconfig/ifconfig.8			1.79 vi patch

	Added a new ifconfig flag, -h, allowing, in conjunction with -v,
	the display of interface I/O bytes in human-format.
	[rpaulo, ticket #1219]

sys/dev/sun/cgsix.c				1.24

	fixed a typo in cg6_ras_do_cursor and made using the blitter to draw the
	cursor optional when using RASTERCONSOLE
	[macallan, ticket #1220]

sys/netipsec/xform_esp.c			1.8

	FreeBSD SA-06:11 and CVE-2006-0905: update the replay sequence number
	or else the anti-reply technique won't work as expected.
	[rpaulo, ticket #1222]

sys/arch/powerpc/powerpc/sig_machdep.c		1.25

	Make cpu_setmcontext() fix up the passed-in MSR value.  PR#31386
	[shige, ticket #1223]

etc/defaults/rc.conf				1.74
etc/mtree/special				1.93
share/man/man5/rc.conf.5			1.99 via patch

	Document the defaultroute6 rc.conf variable and the /etc/mygate6 file in
	/etc/defaults/rc.conf, /etc/mtree/special, and rc.conf(5).
	[ghen, ticket #1226]

sys/dev/ata/wd.c				1.310 via patch

	Use a pmatch(9) expression which should catch all present and future
	seagate drives larger than 200GB for the WD_QUIRK_FORCE_LBA48 quirks.
	Based on infos from
	http://www.seagate.com/support/kb/disc/howto/interpret_model.html
	[bouyer, ticket #1227]

usr.sbin/rpc.statd/statd.c			1.27

	Use sigaction(2) to setup automatic disposal of child processes after
	daemonizing. This is more portable and avoids zombie "rpc.statd"
	processes after an NFS client running e.g. Mac OS X shuts down.
	[tron, ticket #1228]

sys/dev/pci/if_sk.c				1.19
sys/dev/pci/if_skvar.h				1.8

	PR kern/31304: Contribute to the random pool.
	[riz, ticket #1229]

sys/dev/pci/if_sk.c				1.20 via patch
sys/dev/pci/if_skreg.h				1.6
sys/dev/pci/if_skvar.h				1.9

	Not all chips supported by this driver use the same interrupt
	moderation timer frequency. Also add sysctl support for changing
	the interrupt moderation timer at runtime; each board is controlled
	independently.
	[riz, ticket #1230]

sys/arch/xen/conf/Makefile.xen			patch
sys/arch/xen/conf/files.xen			patch

	Add support for ath at pci for XEN domain0.
	[bouyer, ticket #1231]


sys/dev/pcmcia/wdc_pcmcia.c			1.105

	Make sure that disks are probed before trying to mount root, if the
	card is plugged in at boot time. Fixes PR kern/33137.
	[bouyer, ticket #1232]

sys/arch/i386/i386/est.c			1.8,1.10-1.12,1.14,1.16-1.24 via patch

	Improve Enhanced SpeedStep support:
	- Recognize many more CPU modules.
	- Properly handle LV and ULV CPUs.
	[tron, ticket #1234]

sys/netinet/in.c				1.105

	Close NULL dereference when a GIFALIAS is performed on
  	a non existant address.
	[seanb, ticket #1235]

share/man/man9/mbuf.9				1.41

	Fix up the description of m_copyback_cow(), which was at best
	ambiguous, and at worst, wrong.
	[riz, ticket #1233]

lib/libm/arch/i387/s_scalbn.S			1.8
lib/libm/arch/i387/s_scalbnf.S			1.7

	Fix the ldexp() bug reported on the port-amd64 mailing list.
	[drochner, ticket #1236]

etc/MAKEDEV.tmpl				1.51
sys/kern/tty_bsdpty.c				1.6 via patch

	Fix tty name resolution for high numbered ptys.
	[christos, ticket #1237]

etc/rc.subr					1.66

	In order to handle some perl scripts running as daemons, add a
	pattern which also matches "`basename $interpreter`: $command" in the
	ps listing. This fixes PR bin/31932.
	[he, ticket #1238]

sys/arch/xen/include/if_xennetvar.h		1.9
sys/arch/xen/xen/if_xennet.c			1.37

	Significantly reduce the number of interrupts generated on the
	xennet backend and thereby the time spent doing hypercalls.
	[bouyer, ticket #1239]

sys/arch/xen/xen/xbd.c				patch

	Avoid panics under high system load. This fixes PR port-xen/33110.  
	[jld, ticket #1240]

sys/arch/m68k/include/signal.h			1.23
sys/arch/hp300/stand/common/samachdep.h		1.11

	Fix a huge number of "pkgsrc" build problems in by avoiding
	namespace pollution.
	[oster, ticket #1242, #1243]

sys/kern/init_sysctl.c				1.65 via patch
sys/sys/lwp.h					1.35-1.36 via patch
sys/sys/proc.h					1.219 via patch

	PR kern/32809: Conflicting flags in l_flag and p_flag caused
	ps(1) to print incorrect information.
	[pavel, ticket #1244]

sys/arch/i386/conf/INSTALL_XEN3_U		patch
sys/arch/i386/conf/XEN3_U			patch
sys/arch/xen/conf/files.compat			patch
sys/arch/xen/conf/files.xen			patch
sys/arch/xen/i386/autoconf.c			patch
sys/arch/xen/i386/genassym.cf			patch
sys/arch/xen/i386/hypervisor_machdep.c		patch
sys/arch/xen/i386/identcpu.c			patch
sys/arch/xen/i386/locore.S			patch
sys/arch/xen/i386/machdep.c			patch
sys/arch/xen/i386/sys_machdep.c			patch
sys/arch/xen/i386/trap.c			patch
sys/arch/xen/i386/vector.S			patch
sys/arch/xen/i386/xen_machdep.c			patch
sys/arch/xen/include/cpufunc.h			patch
sys/arch/xen/include/frameasm.h			patch
sys/arch/xen/include/granttables.h		patch
sys/arch/xen/include/hypervisor.h		patch
sys/arch/xen/include/xen.h			patch
sys/arch/xen/include/if_xennetvar.h		patch
sys/arch/xen/include/segments.h			patch
sys/arch/xen/include/xenbus.h			patch
sys/arch/xen/include/xenpmap.h			patch
sys/arch/xen/include/xen-public/xen.h		patch
sys/arch/xen/include/xen3-public/COPYING	patch
sys/arch/xen/include/xen3-public/arch-ia64.h	patch
sys/arch/xen/include/xen3-public/arch-x86_64.h	patch
sys/arch/xen/include/xen3-public/dom0_ops.h	patch
sys/arch/xen/include/xen3-public/event_channel.h patch
sys/arch/xen/include/xen3-public/grant_table.h	patch
sys/arch/xen/include/xen3-public/memory.h	patch
sys/arch/xen/include/xen3-public/physdev.h	patch
sys/arch/xen/include/xen3-public/sched.h	patch
sys/arch/xen/include/xen3-public/sched_ctl.h	patch
sys/arch/xen/include/xen3-public/trace.h	patch
sys/arch/xen/include/xen3-public/vcpu.h		patch
sys/arch/xen/include/xen3-public/version.h	patch
sys/arch/xen/include/xen3-public/arch-x86_32.h	patch
sys/arch/xen/include/xen3-public/xen.h		patch
sys/arch/xen/include/xen3-public/io/blkif.h	patch
sys/arch/xen/include/xen3-public/io/console.h	patch
sys/arch/xen/include/xen3-public/io/netif.h	patch
sys/arch/xen/include/xen3-public/io/tpmif.h	patch
sys/arch/xen/include/xen3-public/io/xenbus.h	patch
sys/arch/xen/include/xen3-public/io/ring.h	patch
sys/arch/xen/include/xen3-public/io/xs_wire.h	patch
sys/arch/xen/xen/clock.c			patch
sys/arch/xen/xen/ctrl_if.c			patch
sys/arch/xen/xen/evtchn.c			patch
sys/arch/xen/xen/hypervisor.c			patch
sys/arch/xen/xen/if_xennet.c			patch
sys/arch/xen/xen/if_xennet_xenbus.c		patch
sys/arch/xen/xen/xbd_xenbus.c			patch
sys/arch/xen/xen/xbd.c				patch
sys/arch/xen/xen/xencons.c			patch
sys/arch/xen/xen/xengnt.c			patch
sys/arch/xen/xenbus/xenbus_client.c		patch
sys/arch/xen/xenbus/xenbus_comms.c		patch
sys/arch/xen/xenbus/xenbus_comms.h		patch
sys/arch/xen/xenbus/xenbus_dev.c		patch
sys/arch/xen/xenbus/xenbus_probe.c		patch
sys/arch/xen/xenbus/xenbus_xs.c			patch

	Add Xen-3 domU support.
	[bouyer, ticket #1245]

usr.bin/calendar/calendar.c			1.39

	Correct logic error in wildcard handling, which was causing the
	day-of-month on normal entries to always be treated as a wildcard.
	[jld, ticket #1246]

distrib/i386/floppies/instkernel/Makefile	1.5
etc/etc.i386/Makefile.inc			1.42

	Build XEN3_U and INSTALL_XEN3_U kernels as part of release process.
	[bouyer, ticket #1248]

distrib/sets/lists/man/mi			1.870 via patch
share/man/man4/Makefile				1.378
share/man/man4/ciss.4				1.1-1.2
sys/conf/files					1.764
sys/dev/ic/ciss.c				1.1
sys/dev/ic/cissreg.h				1.1
sys/dev/ic/cissvar.h				1.1
sys/dev/pci/ciss_pci.c				1.1
sys/dev/pci/files.pci				1.245
sys/dev/pci/pcidevs				1.776
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add a driver, ciss(4), for the HP/Compaq drivers using the newer
	"Command Interface to SCSI-3 Support" command interface.
	[he, ticket #1247]

sys/arch/m68k/include/frame.h			1.25

	Fix build problems caused by recent "signal.h" changes.
	[oster, ticket #1249]

crypto/dist/ssh/includes.h			1.12
crypto/dist/ssh/namespace.h			new file
crypto/dist/ssh/readpassphrase.c		1.7
crypto/dist/ssh/readpassphrase.h		1.6
distrib/sets/lists/base/shl.mi			patch
lib/libpam/libpam/Makefile			1.6 via patch
lib/libssh/shlib_version			patch
share/mk/bsd.prog.mk				1.208

	Make PAM work on NetBSD ports without shared library support.
	This fixes PR lib/32421.
	[tsutsui, ticket #1256]

etc/etc.cobalt/MAKEDEV.conf			1.3

	Create LCD panel device node by default under NetBSD-cobalt.
	[tsutsui, ticket #1257]

sys/dev/audio.c					1.203 via patch
sys/dev/audio_if.h				1.60 via patch
sys/dev/audiovar.h				1.35 via patch

	PR kern/32563: Fix the 'audioctl of death' problem.
	[jmcneill, ticket #1277]

sys/arch/mips/include/cpu.h			1.77
sys/arch/mips/mips/fp.S				1.30

	Avoid kernel panics caused by binaries compiled with "-mips2" or
	better. This fixes PR port-mips/27298.
	[tsutsui, ticket #1259]

sys/arch/mips/conf/files.mips			1.54
sys/arch/mips/mips/fp.S				1.31
sys/arch/mips/mips/mips_fputrap.c		1.3-1.4

	Update FPE trapsignal functions for new siginfo.
	This fixes PR port-mips/26410.
	[tsutsui, ticket #1260]

lib/libpthread/arch/i386/pthread_md.h		1.7

	Instead of using hard-coded values for various registers, get them 
	rom the current context. Valid values can change depending on how
	the kernel is setup. i386 and amd64 happen to be setup differently.
	[cube, ticket #1265]

sys/dev/audio.c					1.204 via patch
sys/dev/audio_if.h				1.61
sys/dev/audiovar.h				1.36

	Don't use simple_locks; we can't hold them while calling malloc and
	friends.
	[jmcneill, ticket #1281]

distrib/sets/lists/man/mi			1.863
share/man/man4/Makefile				1.377
share/man/man4/nfe.4				1.1-1.2
sys/arch/amd64/conf/GENERIC			1.88
sys/arch/amd64/conf/INSTALL			1.48
sys/arch/i386/conf/GENERIC			1.733
sys/arch/i386/conf/INSTALL			1.282
sys/arch/i386/conf/XEN0				1.35
sys/dev/mii/ciphy.c				1.5
sys/dev/mii/ciphyreg.h				1.4 via patch
sys/dev/pci/files.pci				1.244 via patch
sys/dev/pci/if_nfe.c				1.1-1.3
sys/dev/pci/if_nfereg.h				1.1
sys/dev/pci/if_nfevar.h				1.1
sys/dev/pci/pcidevs				1.775 via patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add NVIDIA nForce MCP Ethernet driver nfe(4).
	[tron, ticket #1266]

share/misc/airport				1.25-1.26,1.28-1.30

	Updates for share/misc/airport.
	[tron, ticket #1252]

sys/arch/sparc64/conf/GENERIC32			1.122, 1.136

	Add wm(4) support to sparc64 GENERIC32 config.
	[tron, ticket #1267]

sys/arch/amd64/conf/GENERIC			1.91
sys/arch/amd64/conf/INSTALL			1.50
sys/arch/i386/conf/GENERIC			1.741
sys/arch/i386/conf/INSTALL			1.284
sys/arch/i386/conf/INSTALL_SMALL		1.125
sys/arch/i386/conf/INSTALL_TINY			1.102

	Added ciss(4).
	[martti, ticket #1258]

sys/dev/ic/ciss.c				1.2

	Repair commands with no SCSI transfer.
	[martti, ticket #1275]

sys/dev/pci/if_sip.c				1.107

	PR kern/32644: Fix VLAN tagging in gsip(4) driver.
	[pavel, ticket #1279]

sys/dev/pci/if_sip.c				1.106

	PR kern/32900 and 33216: Fix checksum support in the gsip(4) driver.
	[pavel, ticket #1280]

sys/dev/fss.c					1.24

	Fix locking issue in fss(4).
	[hannken, ticket #1282]

sbin/dump/main.c				1.61

	Emit "a snapshot of" message for snap_internal case too.
	[hannken, ticket #1283]

sys/arch/hp300/include/param.h			1.46
sys/arch/mvme68k/include/param.h		1.27

	Fix a huge number of "pkgsrc" build problems in by avoiding
	inclusion of "sys/device.h" unless we are building a kernel.
	[oster, ticket #1284]

lib/libc/stdlib/rand48.3			1.11

	correct multiplicand in pseudorandom generation
	[drochner, ticket #1286]

sys/compat/osf1/osf1_misc.c			1.72-1.73

	- Consistently check the buffer length in getsysinfo(),
 	and require one additional byte for string termination
 	in the GSI_PLATFORM_NAME case.
 	This should fix PR kern/33198 by Nicolas Joly.
	- Make sysinfo() behave more like the original: return
 	the length needed and copy out as much as possible.
	- In sysinfo(), force NUL termination of truncated
	strings if the buffer was too small, as OSF1 does
	[drochner, ticket #1287]

games/sail/pl_main.c				1.17

	Fix buffer overflow (CVE-2006-1744).
	[drochner, ticket #1289]

sys/compat/mach/mach_vm.c			1.50

	Make this compile without the KTRACE option enabled.
	This fixes PR kern/33212.
	[drochner, ticket #1288]

sys/dev/scsipi/cd.c				1.224

	Allow ejecting the media in a CD-ROM drive even if the media is bad.
	This fixes PR kern/30288.
	[pavel, ticket #1290]

lib/libc/locale/wcstod.c			1.4-1.8
regress/lib/libc/locale/wcstod/Makefile		1.1
regress/lib/libc/locale/wcstod/wcstod_test.c	1.1

	replaced by FreeBSD version wcstod(3) for make it work
	with L"inf", L"nan", and hex conversion.
	[tnozaki, ticket #1272]

dist/pf/share/man/man4/pf.4			1.4
dist/pf/share/man/man5/pf.conf.5		1.6

	The "group" keyword is not supported in NetBSD, so:
	- add a CAVEATS section to pf(4) and note it
	- in the description in pf.conf(5) say it is unsupported
	- remove it from the grammar in pf.conf(5).
	[pavel, ticket #1291]

sys/dev/mii/brgphy.c				1.27
sys/dev/mii/miidevs				1.66
sys/dev/mii/miidevs.h				regen
sys/dev/mii/miidevs_data.h			regen

	Add support for BCM5780 integral copper gigabit phy.
	[jonathan, ticket #1292]

lib/libc/rpc/clnt_vc.c				1.14

	Fix some unpaired sigblocks which possibly leave the process with all
	signals blocked. Fixes PR#22483
	[drochner, ticket #1293]

sys/arch/i386/conf/GENERIC_LAPTOP		1.181
sys/arch/i386/conf/INSTALL_LAPTOP		1.100

	Add sip(4) to support the network port of an Acer Aspire 1705SCi.
	[tron, ticket #1294]

sys/dev/pci/pcidevs				1.785
sys/dev/pci/viaide.c				1.29

	PR port-amd64/33393: viaide driver patch for VT8237R SATA.
	[xtraeme, ticket #1295]

sys/arch/sparc/include/ansi.h			1.16
sys/arch/sparc/include/stdarg.h			1.22
sys/arch/sparc64/include/ansi.h			1.10

	For GCC3 and later, use the __builtin_va* constructs. PR#33169
	[nakayama, ticket #1296]

sys/net/if_pppoe.c				1.66

	Don't allow to connect a non ethernet interface to a PPPoE interface.
	[tron, ticket #1297]

dist/pf/share/man/man4/pf.4			1.5 via patch
dist/pf/share/man/man5/pf.conf.5		1.7 via patch

	We do not support pfsync, so:
	- remove xrefs to pfsync(4)
	- remove the no-sync keyword from pf.conf(5)
	- add a note to pf(4).
	[pavel, ticket #1300]

gnu/usr.bin/groff/tmac/mdoc.local		1.27-1.29

	Add NetBSD 3.0.1 and 3.1 to the list of recognized operating systems.
	[tron, ticket #1303]

distrib/sets/lists/man/mi			1.862
share/man/man4/Makefile				1.376 via patch
share/man/man4/pciide.4				1.60
share/man/man4/svwsata.4			1.1-1.2
sys/arch/amd64/conf/GENERIC			1.94
sys/arch/amd64/conf/INSTALL			1.53
sys/arch/i386/conf/GENERIC			1.732
sys/arch/i386/conf/INSTALL			1.281
sys/arch/i386/conf/XEN0				1.34
sys/dev/pci/files.pci				1.243
sys/dev/pci/pcidevs				1.771-1.772 via patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/pciide_svwsata_reg.h		1.1
sys/dev/pci/pciidevar.h				1.33
sys/dev/pci/svwsata.c				1.1-1.2

	Add svwsata(4), a driver for Serverworks K2 SATA, Frodo4, Frodo8 and
	HT-1000 controllers.
	[jonathan, ticket #1298]

sys/arch/i386/conf/XEN0				1.18 via patch
sys/arch/xen/conf/files.xen			1.31 via patch

	Sync with i386/conf/GENERIC:
	- add a buch of PCI storage devices
	- add firewire devices
	- add some missing PCI network devices
	- add serial and parallel PCI adapters
	- add lpt0 at isa
	- add com1 at isa
	  com0 not added for the benefit of serial console users
	[bouyer, ticket #1311]

usr.sbin/rtadvd/rtadvd.c			patch

	Process Source Link-Layer Address (SLLA) option correctly.
	[martti, ticket #1308]

sys/sys/cdefs.h					1.59

	Add an __UNVOLATILE() macro. It should be used with caution, but
	it is required to use this whenever you want to pass a pointer to
	volatile data e.g. to memset(). This allows us to still compile
	files doing such things with -Wcast-qual and get the rest of the
	code checked under that option.
	[bouyer, ticket #1304]

sys/arch/xen/xen/xencons.c			1.15

	Fix a race condition which seems to be triggered by recent
	xen3 hypervisor or tools.
	[bouyer, ticket #1305]

sys/netatalk/aarp.c				1.17

	PR kern/31051: problem finding devices on AppleTalk(Netatalk) networks.
	[hira, ticket #1310]

sys/arch/amd64/amd64/fpu.c			1.14-1.15
sys/arch/i386/isa/npx.c				1.112
sys/arch/xen/i386/npx.c				1.8

	Apply fix from FreeBSD's advisory: fxrstor on AMD FPU's does not
	restore FIP,FDP,FOP thus leaking other process's execution history.
	[adrianp, ticket #1321]

dist/pf/share/man/man4/pf.4			patch
dist/pf/share/man/man5/pf.conf.5		patch

	Remove references to ALTQ and add a recipe to use the "old ALTQ".
	[pavel, ticket #1312]

distrib/notes/common/main			1.310

	Update release engineering member list.
	[ghen, ticket #1313]

lib/libpthread/pthread.c			1.48

	Fix bug which caused programs which are linked against "libpthread"
	but don't use threads don't inherit the signal mask of the parent
	process but start up with "all unblocked".
	[drochner, ticket #1314]

sys/dev/audio.c					1.205

	Fixes a bug that audio_offset_t::samples for AUDIO_GETxOFFS has
	incorrect value. It also affects SNDCTL_DSP_GETOPTR of
	ossaudio. This fixes PR kern/32405.
	[kent, ticket #1317]

sys/dev/pci/azalia_codec.c			1.8

	PR kern/33326: Fix incorrect ADC list for ALC880.
	[kent, ticket #1318]

sys/arch/xen/xen/xbd_xenbus.c			1.10 via patch

	Fix configurations with more than one xbd attached at boot time.
	[bouyer, ticket #1319]

sys/dist/ipf/netinet/fil.c			1.24

	Make sure IPF can correctly pullup short headers.
	This fixes PR kern/33423.
	[martti, ticket #1320]

distrib/atari/floppies/prepare/Makefile		1.3
distrib/atari/floppies/prepare/list		1.4

	Add usr/bin/sort and install.sub to prepare.fs.
	This fixes PR port-atari/33455.
	[jdc, ticket #1322]

distrib/sets/lists/comp/mi			1.882 via patch
distrib/sets/lists/man/mi			1.891 via patch

	Mark specific manpages, catpages, and info files as "gcccmds", so that
	a "distribution" build with MKGCCCMDS=no and any of MKCATPAGES, MKMAN,
	and MKINFO set to yes can still succeed.
	[riz, ticket #1326]

share/man/man4/ahc.4				1.30 via patch

	Do not warn that Ultra160 controllers are limited to 80MB/s.
	[pavel, ticket #1329]

sys/arch/i386/i386/machdep.c			1.564-1.565

	Reset the AMD Geode SC1100. Previously, the Geode hung after
	printing "resetting...".  Now it really restarts.
	[riz, ticket #1330]

sys/arch/i386/conf/GENERIC			1.701
sys/arch/i386/conf/files.i386			1.270
sys/arch/i386/pci/geode.c			1.1
sys/arch/i386/pci/geodereg.h			1.1

	Add a driver for the watchdog timer on the AMD Geode SC1100.
	[riz, ticket #1331]

distrib/sets/lists/man/mi			1.829
share/man/man4/man4.i386/Makefile		1.58
share/man/man4/man4.i386/geodewdog.4		1.1

	Add the manual page for geodewdog(4), the driver for the AMD Geode
	SC1100's integrated watchdog timer.
	[riz, ticket #1332]

sys/arch/i386/pci/geode.c			1.2

	Suppress false 'WARNING: LAST RESET DUE TO WATCHDOG EXPIRATION!'
	indications by clearing the WDOVF status flag for real.
	[riz, ticket #1333]

sys/ufs/lfs/lfs.h				1.87-1.91,1.96-1.106
sys/ufs/lfs/lfs_alloc.c				1.83-1.84,1.87-1.93
sys/ufs/lfs/lfs_balloc.c			1.60
sys/ufs/lfs/lfs_bio.c				1.86,1.91-1.92
sys/ufs/lfs/lfs_debug.c				1.31-1.32
sys/ufs/lfs/lfs_extern.h			1.68,1.76-1.78,1.80-1.81 via patch
sys/ufs/lfs/lfs_inode.c				1.96,1.101-1.103 via patch
sys/ufs/lfs/lfs_segment.c			1.164,1.165,1.170-1.178
sys/ufs/lfs/lfs_subr.c				1.53,1.57-1.59
sys/ufs/lfs/lfs_syscalls.c			1.106-1.107,1.109,1.111-1.112
sys/ufs/lfs/lfs_vfsops.c			1.179-1.181,1.185,1.194-1.196,1.198-1.207,1.209 via patch
sys/ufs/lfs/lfs_vnops.c				1.151-1.153,1.158-1.159,1.161-1.173,1.175,1.177 via patch
sbin/newfs_lfs/extern.h				1.9
sbin/newfs_lfs/make_lfs.c			1.7
sbin/newfs_lfs/newfs.c				1.20
sbin/newfs_lfs/newfs_lfs.8			1.21

	Various fixes to LFS, including at least:
	* Several MP locking fixes
	* Fix a couple of deadlocks, including one between the pagedaemon,
	  the cleaner and a writing process
	* Make df output look rational
	* Break out of VOP_PUTPAGES if we need the cleaner to run,
	  without interrupting dirop writes.  Let the writer thread
	  know to write individual vnodes rather than flush the whole
	  filesystem.
	* Keep the inode free list in order to minimize the cost of
	  file creation on aged filesystems
	* Address the case of "vinvalbuf: dirty blocks" panic when
	  the cleaner tries to clean many small files at once
	* Better segment use accounting when files are truncated while
	  cleaning is occurring
	[perseant, ticket #1327]

sys/dev/ata/wd.c				1.324

	Add yet another broken 160Gb seagate drive.
	[bouyer, ticket #1337]

sys/netinet6/ip6_input.c			1.87 via patch

	In ip6_savecontrol(), ignore IPv4 packets.
	From JINMEI Tatuya (KAME). PR#33269.
	[rpaulo, ticket #1338]

usr.bin/su/su_pam.c				1.12

	Restore elevated priority before launching command in
	user context.
	[mlelstv, ticket #1343]

usr.bin/ftp/util.c				1.135

	Fix a NULL pointer dereference in ftp(1).
	[jnemeth, ticket #1339]

games/dm/dm.c					1.23

	Read config more strictly.
	[dan, ticket #1342]

sys/kern/vfs_vnops.c				1.112

	Limit the size of any kernel buffers allocated by the VOP_READDIR
	routines to MAXBSIZE.
	[simonb, ticket #1347]

sys/dev/ic/rtl8169.c				1.23

	Disable hardware VLAN tagging in re(4) to prevent untagged packets
	from sometimes getting tagged incorrectly. This fixes PR kern/32643.
	[pavel, ticket #1340]

share/man/man4/raid.4				1.32

	Mention that we can boot from RAID 1 sets on amd64 now too.
	This fixes PR misc/31511.
	[ghen, ticket #1344]

sys/arch/hp300/dev/grf_dv.c			1.31
sys/arch/hp300/dev/grf_gb.c			1.30
sys/arch/hp300/dev/grf_hy.c			1.28
sys/arch/hp300/dev/grf_rb.c			1.31
sys/arch/hp300/dev/grf_tc.c			1.33

	Fix boot failure problem on HP400t with fb console.
	[tsutsui, ticket #1348]

sys/dev/pci/pcidevs				1.788
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add a couple DLINK product IDs.
	[riz, ticket #1349]

sys/dev/pci/if_sk.c				1.26
sys/dev/pci/if_skreg.h				1.7

	Add support for the DLink DGE-530T revision B1 and the DGE-560T.
	[riz, ticket #1350]

sys/dev/pci/if_bge.c				patch
sys/dev/pci/if_bgereg.h				patch
sys/dev/pci/pcidevs				patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add support to bge(4) for bcm5714, bcm5715, bcm5780/HT-2000 and
	bcm5752 chip variants.
	[jonathan, ticket #1351]

usr.bin/crunch/crunchgen/crunchgen.c		1.69

	Fix problems with program names with a "-" in them, where crunchgen was
	outputting the original program name for the stub name instead of the
	mangled name.
	[simonb, ticket #1355]

dist/pf/share/man/man4/pf.4			patch
dist/pf/share/man/man5/pf.conf.5		patch

	Bump manual page date of after recent updates.
	[pavel, ticket #1356]

xsrc/xfree/xc/extras/freetype2/include/freetype/fterrdef.h	1.2
xsrc/xfree/xc/extras/freetype2/src/base/ftmac.c			1.2
xsrc/xfree/xc/extras/freetype2/src/base/ftutil.c		1.2
xsrc/xfree/xc/extras/freetype2/src/bdf/bdflib.c			1.2
xsrc/xfree/xc/extras/freetype2/src/cff/cffgload.c		1.2
xsrc/xfree/xc/extras/freetype2/src/cff/cfftypes.h		1.2
xsrc/xfree/xc/extras/freetype2/src/pshinter/pshglob.c		1.2
xsrc/xfree/xc/extras/freetype2/src/sfnt/ttcmap0.c		1.2
xsrc/xfree/xc/extras/freetype2/src/type1/t1load.c		1.2

	Fixes for several integer overflows and null-pointer dereferences in
	freetype2.
	[tron, ticket #1354]

games/tetris/scores.c				1.14

	Check data read from "tetris.scores". This address CVE-2006-1539.
	A standard NetBSD installation is not as much risk because "tetris"
	is set-group-ID "games", and users shouldn't be in that group.
	[dan, ticket #1368]

sys/arch/cobalt/dev/gt.c			1.15-1.19
sys/arch/cobalt/dev/gtreg.h			1.3-1.4
sys/arch/cobalt/pci/pci_machdep.c		1.20-1.22

	Fix possible problems and improve performance of certain PCI devices
	under NetBSD-cobalt.
	[tsutsui, ticket #1359]

bin/sh/expand.c					1.74

	Correct error when expanding "$@". This fixes PR bin/33472.
	[dsl, ticket #1336]

lib/libpam/modules/pam_unix/pam_unix.c		1.11

	Make password aging work again. This fixes PR bin/30730 and
	PR security/33502.
	[jnemeth, ticket #1370]

sys/dev/ata/wd.c				1.325

	Adjust quirk entry for seagate drives. This fixes PR kern/33637.
	[bouyer, ticket #1375]

