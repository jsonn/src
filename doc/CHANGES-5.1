# $NetBSD: CHANGES-5.1,v 1.1.2.10 2009/05/10 21:39:22 snj Exp $

A complete list of changes from the NetBSD 5.0 release to the NetBSD 5.1
release:

gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 5.0_STABLE.
	[snj]

sys/arch/i386/conf/ALL				1.187
sys/arch/i386/conf/GENERIC			1.922
sys/dev/pci/files.pci				1.309
sys/dev/pci/gcscaudio.c				1.1
sys/dev/pci/gcscaudioreg.h			1.1

	Add AMD Geode CS5536 audio driver; written by SHIMIZU Ryo.
	[jmcneill, ticket #260]

distrib/sets/lists/man/mi			1.1117
share/man/man4/Makefile				1.485
share/man/man4/gcscaudio.4			1.1

	Add man page for the gcscaudio driver.
	[jmcneill, ticket #261]

sys/dev/mii/inphy.c				1.51
sys/dev/mii/iophy.c				1.35
sys/dev/mii/nsphy.c				1.56
sys/dev/mii/rlphy.c				1.25
sys/dev/mii/ukphy_subr.c			1.11
sys/dev/pci/if_txp.c				1.28

	Our drivers give 100BASE-T4 a higher priority than 100BASE-TX
	full duplex.  Fix this.
	[cegger, ticket #474]

sys/arch/i386/acpi/npx_acpi.c			1.18
sys/arch/i386/acpi/spic_acpi.c			1.21
sys/dev/acpi/acpi_ec.c				1.53
sys/dev/acpi/acpi_resource.c			1.27
sys/dev/acpi/atppc_acpi.c			1.16
sys/dev/acpi/attimer_acpi.c			1.12
sys/dev/acpi/com_acpi.c				1.28
sys/dev/acpi/fdc_acpi.c				1.35
sys/dev/acpi/hpet_acpi.c			1.4
sys/dev/acpi/joy_acpi.c				1.9
sys/dev/acpi/lpt_acpi.c				1.18
sys/dev/acpi/mpu_acpi.c				1.9
sys/dev/acpi/pckbc_acpi.c			1.31
sys/dev/acpi/pcppi_acpi.c			1.11
sys/dev/acpi/ug_acpi.c				1.5
sys/dev/acpi/wss_acpi.c				1.20
sys/dev/acpi/ym_acpi.c				1.6

	Cut the amount of spam from acpi devices in roughly half by
	printing resources on the same line as autoconf messages.
	[jmcneill, ticket #498]

sys/dev/acpi/acpi_ec.c				1.54

	Change a confusing attach message.
	[jmcneill, ticket #535]

distrib/sets/lists/base/mi			1.797 via patch
sys/dev/microcode/zyd/Makefile			1.2
sys/dev/microcode/zyd/zd1211-licence		delete
sys/dev/microcode/zyd/zd1211-license		1.1

	- Rename filename of license.
	- Correct filename in license (add missing prefix).
	[hira, ticket #538]

sys/dev/ic/hme.c				1.69, 1.70, 1.73
sys/dev/ic/gem.c				1.83

	hme.c rev 1.69: tcp4csum-rx and udp4csum is not enabled
	properly due to lack of "else" statement.
	hme.c rev 1.70: local ether_cmp() funcion has a wrong return
	value, so multicast is not set properly.
	hme.c rev 1.71, gem.c rev 1.83: These chips are configured to
	calculate RX packet checksum from offset ETHER_HDR_LEN +
	sizeof(struct ip), so if RX packets has IP options headers the
	drivers have to deduct the sum of the IP options header part.
	But there is a bug in the deduction calculation, so if
	tcp4csum-rx or udp4csum-rx are enabled all RX TCP/UDP packets
	with IP option headers will be discarded.
	[tsutsui, ticket #595]

sys/dev/ic/rtl8169.c				1.109-1.113
sys/dev/ic/rtl81x9var.h				1.43-1.45
sys/dev/ic/rtl81x9reg.h				1.34, 1.35

	Add hardware checksum support for newer 8168/8111/8102 chips.
	[tsutsui, ticket #597]

sys/dev/raidframe/rf_dagfuncs.c			1.30
sys/dev/raidframe/rf_diskqueue.c		1.52
sys/dev/raidframe/rf_diskqueue.h		1.23

	Rework/simplify the disk queuing code.  A bunch of this was
	still holdovers from the simulator and would never be seen/used
	in-kernel.
	[oster, ticket #607]

sys/kern/sys_module.c				1.9

	copyin the modctl_load_t for the non-x86 world. Fixes PR/41294.
	[skrll, ticket #729]

lib/libc/net/getifaddrs.3			1.10
lib/libc/net/getifaddrs.c			1.12
sbin/ifconfig/af_link.c				1.4 - 1.6
sbin/ifconfig/ifconfig.c			1.216 - 1.218
sbin/ifconfig/util.c				1.10, 1.11
sbin/ifconfig/util.h				1.7

	address in the 'address: ' field
	For non-AF_LINK ifaddrs, ifa_data is NULL.  AFAICT, this has always
	been so.  Say so in the documentation.
	Bring getifaddrs(3) behavior in line with the documentation: the
	ifa_data member of every AF_LINK struct ifaddrs points at the
	corresponding struct if_data.  In ifconfig(8), do not try to suppress
	duplicate AF_LINK ifaddrs by checking for a NULL ifa_data.
	Don't copy out two AF_LINK struct ifaddrs for each active link-layer
	address. getifaddrs(3) used to copy out one ifaddrs for the kernel's
	RTM_IFINFO message, and one more for the kernel's RTM_NEWADDR message.
	I suppress the first duplicate with a highly conservative change that
	wastes a little bit of ifaddrs storage.  The storage is not leaked.
	[dyoung, ticket #730]

sys/kern/uipc_socket.c				1.189

	PR kern/41311: Mutex error: mutex_vector_enter: locking against myself
	[ad, ticket #731]

sys/kern/vfs_dirhash.c				1.10

	port-vax/41315: fix off by one error
	Previous code ususally works since compiler won't put gap between
	those struct members but there is no reason to rely on that.
	[martin, ticket #732]

sys/netinet6/ip6_input.c			1.127

	Add missing paranthesis - from Kurt Lidl in PR port-vax/41316
	[martin, ticket #733]

sys/dev/ic/ncr53c9x.c				1.138

	Add missing braces - patch from Kurt Lidl in PR port-vax/41314.
	[martin, ticket #734]

common/dist/zlib/zlib.h				1.3
sys/lib/libkern/Makefile			patch
sys/lib/libkern/crc32.c				1.1-1.4
sys/lib/libkern/crc32.h				1.1
sys/lib/libkern/libkern.h			1.89, 1.90 via patch
sys/lib/libkern/arch/i386/Makefile.inc		1.28
sys/lib/libsa/cread.c				1.23
sys/lib/libz/Makefile				1.16
sys/net/zlib.h					1.14 via patch
sys/opencrypto/crypto.c				1.33
sys/opencrypto/cryptodev.c			1.46
sys/opencrypto/cryptodev.h			1.16
sys/opencrypto/cryptosoft.c			1.24
sys/opencrypto/cryptosoft.h			1.6
sys/opencrypto/deflate.h			1.6
sys/opencrypto/cryptosoft_xform.c		1.12
sys/opencrypto/deflate.c			1.13
sys/opencrypto/files.opencrypto			1.20
sys/opencrypto/ocryptodev.c			1.1
sys/opencrypto/ocryptodev.h			1.1
sys/opencrypto/xform.c				1.18
sys/opencrypto/xform.h				1.10

	Extend the Opencrypto API to allow the destination buffer
	size to be specified when it is not the same size as the input
	buffer (i.e., for operations like compress and decompress).
	The crypto_op and crypt_n_op structures gain a u_int dst_len
	field.  The session_op structure gains a comp_alg field to
	specify a compression algorithm.
	Moved four ioctls to new ids; CIOCGSESSION, CIOCNGSESSION,
	CIOCCRYPT, and CIOCNCRYPTM.  Added four backward compatible
	ioctls; OCIOCGSESSION, OCIOCNGSESSION, OCIOCCRYPT, and
	OCIOCNCRYPTM.
	Backward compatibility is maintained in ocryptodev.h and
	ocryptodev.c which implement the original ioctls and set
	dst_len and comp_alg to 0.
	Add user-space access to compression features.
	Add software gzip support (CRYPTO_GZIP_COMP).
	Add the fast version of crc32 from zlib to libkern. This should
	be generally useful and provide a place to start normalizing
	the various crc32 routines in the kernel.  The crc32 routine is
	used in this patch to support GZIP.
	Fixes PR kern/41069 and PR kern/41070.
	[tls, ticket #611]

sys/dev/pci/if_wm.c:                            1.168, 1.169 via patch
sys/dev/pci/if_wmreg.h:                         1.26 via patch

        On i82563, the em driver says that the ready bit in the MDIC
        register may be incorrectly set. Insert delay(200) like the
        em driver.
        Examine the management mode and mark DRV_LOAD (for
        ICH{8,9,10},80003, 8257{1,2,3,4}).  Add some error printf()s.
        Make the bank detect routine into the function.
        [spz, ticket #621]

sys/dev/pci/if_wm.c				1.171, 1.172

	Enable hardware VLAN support.
	[tls, ticket #627]

sys/dev/pci/if_wm.c				1.170

	Add workaround for 82543GC: We need to force speed and duplex
	on the MAC equal to what the PHY speed and duplex configuration
	is. Fixes PR#36430.
	[msaitoh, ticket #630]

sys/net/if_vlan.c				1.63

	Also inherit the parent's TCP segmentation offload capability.
	Note the vlan interface does not see updates to the parents
	capabilities so if, for example, TSO is on in both, then turned
	off in the parent it will remain on in the vlan interface.
	[darran, ticket #644]

sbin/ping/ping.c				1.88

	PR/41111: Ed Ravin: ping -R gives misleading error when remote
	side doesn't support record route.
	Deal with source route and record route specially giving a
	meaningful error message.
	[christos, ticket #636]

sbin/drvctl/drvctl.8				1.6
sbin/drvctl/drvctl.c				1.8 via patch
sys/kern/kern_drvctl.c				1.24

	Allow querying for root devices in the tree by specifying
	an empty device name. Ensure that l_devname is NUL-terminated
	and fail otherwise.  If drvctl -l is used without argument, print
	the root device nodes.
	[joerg, ticket #675]

lib/libedit/common.c				1.23

	Fix mis-evaluating whether a char is digit or not.
	[msaitoh, ticket #703]

sys/dev/mii/miidevs				1.81-1.83
sys/dev/mii/miidevs.h				regen
sys/dev/mii/miidevs_data.h			regen

	Add ATHEROS F1 and F2 PHYs.  Add ATTANSIC and their L1/L2 PHYs.
	Add a comment explaining how to regenerate miidevs.h and
	miidevs_data.h.
	[sborrill, ticket #721]

sys/dev/pci/pcidevs				1.973
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add Attansic L1E Gigabit Ethernet Adapter.
	[sborrill, ticket #722]

sys/dev/pci/if_age.c				1.1-1.28
sys/dev/pci/if_agereg.h				1.1-1.2
sys/dev/pci/if_ale.c				1.1-1.3
sys/dev/pci/if_alereg.h				1.1-1.2
sys/dev/pci/files.pci				1.310-1.313
sys/dev/mii/atphy.c				1.1-1.5
sys/dev/mii/files.mii				1.42
share/man/man4/age.4				1.1-1.3
share/man/man4/ale.4				1.1-1.2
share/man/man4/atphy.4				1.1-1.2
share/man/man4/Makefile				1.486, 1.489
strib/sets/lists/man/mi				1.1118, 1.1132
sys/arch/i386/conf/GENERIC			1.928, 1.933
sys/arch/i386/conf/XEN2_DOM0			1.57, 1.60
sys/arch/amd64/conf/GENERIC			1.239, 1.241
sys/arch/amd64/conf/XEN3_DOM0			1.38, 1.42

	Add the age(4) and ale(4) drivers for Attansic L1 and Atheros
	AR8121/AR8113/AR8114 devices respectively.
	[cegger, ticket #735]

sys/arch/x86/pci/pchb.c				1.15 - 1.17
sys/dev/pci/agp.c				1.63 - 1.65
sys/dev/pci/agp_i810.c				1.57 - 1.64
sys/dev/pci/agpreg.h				1.20
sys/dev/pci/pcidevs				1.965, 1.967 via patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add AGP support for Intel G35, G45, and Q45
	[snj, ticket #737]

gnu/dist/binutils/bfd/elf32-vax.c		1.9

	Allocate relocation section using bfd_zalloc() to ensure no garbage
	relocations when not all the entries are used.
	Fixes PR port-vax/39182.
	[mhitch, ticket #738]

sys/ufs/ffs/ffs_alloc.c				1.123 via patch

	Fix random 'filesystem full' messages by trapping a couple of
	32-bit overflow areas missed in rev 1.110 and switching cgbase().
	[sborrill, ticket #726]

share/man/man4/age.4				1.4
share/man/man4/ale.4				1.3

	age(4) and ale(4) will first appear in 5.1, not 6.0.
	[cegger, ticket #739]

usr.sbin/racoonctl/Makefile			1.5 via patch

	Adjust the ADMINPORTDIR to match that of racoon (with which it'll
	want to talk).  Fixes PR 41376.
	[spz, ticket #740]

sys/arch/hp700/include/intr.h			1.14

	Add __insn_barrier after updating cpl in splraise. PR/41369.
	[skrll, ticket #741]

sys/arch/m68k/include/psl.h			1.14

	Add memory clobber to the instructions that change the IPL in the
	status register.  See also kern/38637.
	[mhitch, ticket #743]

sys/arch/hp700/dev/pdc.c			1.27

	Pass proper timeval args to pdc_call() to save TOD with
	PDC_TOD_WRITE.
	[skrll, ticket #744]

sys/netinet/in_pcb.c				patch

	Fix compilation with IPNOPRIVPORTS option.
	[sborrill, ticket #745]

share/man/man8/afterboot.8			1.39

	Fix typo, from Shannon -jj Behrens in PR 41375.
	[dholland, ticket #746]

distrib/sets/lists/etc/mi			1.209
doc/3RDPARTY					1.691
doc/CHANGES					1.1220
etc/defaults/rc.conf				1.103
etc/rc.d/Makefile				1.78 via patch
etc/rc.d/dhcpcd					1.1
external/bsd/dhcpcd/dist/README			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/arp.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/arp.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/bind.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/bind.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/bpf-filter.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/bpf.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/client.c		removed
external/bsd/dhcpcd/dist/client.h		removed
external/bsd/dhcpcd/dist/common.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/common.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/config.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/configure.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/configure.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/control.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/control.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcp.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcp.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-run-hooks.8.in	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-run-hooks.in	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.8.in		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.conf		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.conf.5.in	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/duid.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/duid.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/eloop.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/eloop.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-bsd.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-options.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-options.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-pref.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-pref.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/ipv4ll.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/ipv4ll.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/logger.c		removed            
external/bsd/dhcpcd/dist/logger.h		removed
external/bsd/dhcpcd/dist/net.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/net.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/signals.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/signals.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/01-test	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/10-mtu	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/20-resolv.conf dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/29-lookup-hostname dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/30-hostname dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/50-ntp.conf dhcpcd-5-0-1
external/bsd/dhcpcd/sbin/dhcpcd/Makefile	1.4

	Update dhcpcd to 5.0.1.
	[roy, ticket #534]

