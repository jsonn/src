# $NetBSD: CHANGES-5.1,v 1.1.2.31 2009/06/17 20:37:27 bouyer Exp $

A complete list of changes from the NetBSD 5.0 release to the NetBSD 5.1
release:

gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 5.0_STABLE.
	[snj]

sys/arch/i386/conf/ALL				1.187
sys/arch/i386/conf/GENERIC			1.922
sys/dev/pci/files.pci				1.309
sys/dev/pci/gcscaudio.c				1.1
sys/dev/pci/gcscaudioreg.h			1.1

	Add AMD Geode CS5536 audio driver; written by SHIMIZU Ryo.
	[jmcneill, ticket #260]

distrib/sets/lists/man/mi			1.1117
share/man/man4/Makefile				1.485
share/man/man4/gcscaudio.4			1.1

	Add man page for the gcscaudio driver.
	[jmcneill, ticket #261]

sys/dev/mii/inphy.c				1.51
sys/dev/mii/iophy.c				1.35
sys/dev/mii/nsphy.c				1.56
sys/dev/mii/rlphy.c				1.25
sys/dev/mii/ukphy_subr.c			1.11
sys/dev/pci/if_txp.c				1.28

	Our drivers give 100BASE-T4 a higher priority than 100BASE-TX
	full duplex.  Fix this.
	[cegger, ticket #474]

sys/arch/i386/acpi/npx_acpi.c			1.18
sys/arch/i386/acpi/spic_acpi.c			1.21
sys/dev/acpi/acpi_ec.c				1.53
sys/dev/acpi/acpi_resource.c			1.27
sys/dev/acpi/atppc_acpi.c			1.16
sys/dev/acpi/attimer_acpi.c			1.12
sys/dev/acpi/com_acpi.c				1.28
sys/dev/acpi/fdc_acpi.c				1.35
sys/dev/acpi/hpet_acpi.c			1.4
sys/dev/acpi/joy_acpi.c				1.9
sys/dev/acpi/lpt_acpi.c				1.18
sys/dev/acpi/mpu_acpi.c				1.9
sys/dev/acpi/pckbc_acpi.c			1.31
sys/dev/acpi/pcppi_acpi.c			1.11
sys/dev/acpi/ug_acpi.c				1.5
sys/dev/acpi/wss_acpi.c				1.20
sys/dev/acpi/ym_acpi.c				1.6

	Cut the amount of spam from acpi devices in roughly half by
	printing resources on the same line as autoconf messages.
	[jmcneill, ticket #498]

sys/dev/acpi/acpi_ec.c				1.54

	Change a confusing attach message.
	[jmcneill, ticket #535]

distrib/sets/lists/base/mi			1.797 via patch
sys/dev/microcode/zyd/Makefile			1.2
sys/dev/microcode/zyd/zd1211-licence		delete
sys/dev/microcode/zyd/zd1211-license		1.1

	- Rename filename of license.
	- Correct filename in license (add missing prefix).
	[hira, ticket #538]

sys/dev/ic/hme.c				1.69, 1.70, 1.73
sys/dev/ic/gem.c				1.83

	hme.c rev 1.69: tcp4csum-rx and udp4csum is not enabled
	properly due to lack of "else" statement.
	hme.c rev 1.70: local ether_cmp() funcion has a wrong return
	value, so multicast is not set properly.
	hme.c rev 1.71, gem.c rev 1.83: These chips are configured to
	calculate RX packet checksum from offset ETHER_HDR_LEN +
	sizeof(struct ip), so if RX packets has IP options headers the
	drivers have to deduct the sum of the IP options header part.
	But there is a bug in the deduction calculation, so if
	tcp4csum-rx or udp4csum-rx are enabled all RX TCP/UDP packets
	with IP option headers will be discarded.
	[tsutsui, ticket #595]

sys/dev/ic/rtl8169.c				1.109-1.113
sys/dev/ic/rtl81x9var.h				1.43-1.45
sys/dev/ic/rtl81x9reg.h				1.34, 1.35

	Add hardware checksum support for newer 8168/8111/8102 chips.
	[tsutsui, ticket #597]

sys/dev/raidframe/rf_dagfuncs.c			1.30
sys/dev/raidframe/rf_diskqueue.c		1.52
sys/dev/raidframe/rf_diskqueue.h		1.23

	Rework/simplify the disk queuing code.  A bunch of this was
	still holdovers from the simulator and would never be seen/used
	in-kernel.
	[oster, ticket #607]

sys/kern/sys_module.c				1.9

	copyin the modctl_load_t for the non-x86 world. Fixes PR/41294.
	[skrll, ticket #729]

lib/libc/net/getifaddrs.3			1.10
lib/libc/net/getifaddrs.c			1.12
sbin/ifconfig/af_link.c				1.4 - 1.6
sbin/ifconfig/ifconfig.c			1.216 - 1.218
sbin/ifconfig/util.c				1.10, 1.11
sbin/ifconfig/util.h				1.7

	address in the 'address: ' field
	For non-AF_LINK ifaddrs, ifa_data is NULL.  AFAICT, this has always
	been so.  Say so in the documentation.
	Bring getifaddrs(3) behavior in line with the documentation: the
	ifa_data member of every AF_LINK struct ifaddrs points at the
	corresponding struct if_data.  In ifconfig(8), do not try to suppress
	duplicate AF_LINK ifaddrs by checking for a NULL ifa_data.
	Don't copy out two AF_LINK struct ifaddrs for each active link-layer
	address. getifaddrs(3) used to copy out one ifaddrs for the kernel's
	RTM_IFINFO message, and one more for the kernel's RTM_NEWADDR message.
	I suppress the first duplicate with a highly conservative change that
	wastes a little bit of ifaddrs storage.  The storage is not leaked.
	[dyoung, ticket #730]

sys/kern/uipc_socket.c				1.189

	PR kern/41311: Mutex error: mutex_vector_enter: locking against myself
	[ad, ticket #731]

sys/kern/vfs_dirhash.c				1.10

	port-vax/41315: fix off by one error
	Previous code ususally works since compiler won't put gap between
	those struct members but there is no reason to rely on that.
	[martin, ticket #732]

sys/netinet6/ip6_input.c			1.127

	Add missing paranthesis - from Kurt Lidl in PR port-vax/41316
	[martin, ticket #733]

sys/dev/ic/ncr53c9x.c				1.138

	Add missing braces - patch from Kurt Lidl in PR port-vax/41314.
	[martin, ticket #734]

common/dist/zlib/zlib.h				1.3
sys/lib/libkern/Makefile			patch
sys/lib/libkern/crc32.c				1.1-1.4
sys/lib/libkern/crc32.h				1.1
sys/lib/libkern/libkern.h			1.89, 1.90 via patch
sys/lib/libkern/arch/i386/Makefile.inc		1.28
sys/lib/libsa/cread.c				1.23
sys/lib/libz/Makefile				1.16
sys/net/zlib.h					1.14 via patch
sys/opencrypto/crypto.c				1.33
sys/opencrypto/cryptodev.c			1.46
sys/opencrypto/cryptodev.h			1.16
sys/opencrypto/cryptosoft.c			1.24
sys/opencrypto/cryptosoft.h			1.6
sys/opencrypto/deflate.h			1.6
sys/opencrypto/cryptosoft_xform.c		1.12
sys/opencrypto/deflate.c			1.13
sys/opencrypto/files.opencrypto			1.20
sys/opencrypto/ocryptodev.c			1.1
sys/opencrypto/ocryptodev.h			1.1
sys/opencrypto/xform.c				1.18
sys/opencrypto/xform.h				1.10

	Extend the Opencrypto API to allow the destination buffer
	size to be specified when it is not the same size as the input
	buffer (i.e., for operations like compress and decompress).
	The crypto_op and crypt_n_op structures gain a u_int dst_len
	field.  The session_op structure gains a comp_alg field to
	specify a compression algorithm.
	Moved four ioctls to new ids; CIOCGSESSION, CIOCNGSESSION,
	CIOCCRYPT, and CIOCNCRYPTM.  Added four backward compatible
	ioctls; OCIOCGSESSION, OCIOCNGSESSION, OCIOCCRYPT, and
	OCIOCNCRYPTM.
	Backward compatibility is maintained in ocryptodev.h and
	ocryptodev.c which implement the original ioctls and set
	dst_len and comp_alg to 0.
	Add user-space access to compression features.
	Add software gzip support (CRYPTO_GZIP_COMP).
	Add the fast version of crc32 from zlib to libkern. This should
	be generally useful and provide a place to start normalizing
	the various crc32 routines in the kernel.  The crc32 routine is
	used in this patch to support GZIP.
	Fixes PR kern/41069 and PR kern/41070.
	[tls, ticket #611]

sys/dev/pci/if_wm.c:                            1.168, 1.169 via patch
sys/dev/pci/if_wmreg.h:                         1.26 via patch

        On i82563, the em driver says that the ready bit in the MDIC
        register may be incorrectly set. Insert delay(200) like the
        em driver.
        Examine the management mode and mark DRV_LOAD (for
        ICH{8,9,10},80003, 8257{1,2,3,4}).  Add some error printf()s.
        Make the bank detect routine into the function.
        [spz, ticket #621]

sys/dev/pci/if_wm.c				1.171, 1.172

	Enable hardware VLAN support.
	[tls, ticket #627]

sys/dev/pci/if_wm.c				1.170

	Add workaround for 82543GC: We need to force speed and duplex
	on the MAC equal to what the PHY speed and duplex configuration
	is. Fixes PR#36430.
	[msaitoh, ticket #630]

sys/net/if_vlan.c				1.63

	Also inherit the parent's TCP segmentation offload capability.
	Note the vlan interface does not see updates to the parents
	capabilities so if, for example, TSO is on in both, then turned
	off in the parent it will remain on in the vlan interface.
	[darran, ticket #644]

sbin/ping/ping.c				1.88

	PR/41111: Ed Ravin: ping -R gives misleading error when remote
	side doesn't support record route.
	Deal with source route and record route specially giving a
	meaningful error message.
	[christos, ticket #636]

sbin/drvctl/drvctl.8				1.6
sbin/drvctl/drvctl.c				1.8 via patch
sys/kern/kern_drvctl.c				1.24

	Allow querying for root devices in the tree by specifying
	an empty device name. Ensure that l_devname is NUL-terminated
	and fail otherwise.  If drvctl -l is used without argument, print
	the root device nodes.
	[joerg, ticket #675]

lib/libedit/common.c				1.23

	Fix mis-evaluating whether a char is digit or not.
	[msaitoh, ticket #703]

sys/dev/mii/miidevs				1.81-1.83
sys/dev/mii/miidevs.h				regen
sys/dev/mii/miidevs_data.h			regen

	Add ATHEROS F1 and F2 PHYs.  Add ATTANSIC and their L1/L2 PHYs.
	Add a comment explaining how to regenerate miidevs.h and
	miidevs_data.h.
	[sborrill, ticket #721]

sys/dev/pci/pcidevs				1.973
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add Attansic L1E Gigabit Ethernet Adapter.
	[sborrill, ticket #722]

sys/dev/pci/if_age.c				1.1-1.28
sys/dev/pci/if_agereg.h				1.1-1.2
sys/dev/pci/if_ale.c				1.1-1.3
sys/dev/pci/if_alereg.h				1.1-1.2
sys/dev/pci/files.pci				1.310-1.313
sys/dev/mii/atphy.c				1.1-1.5
sys/dev/mii/files.mii				1.42
share/man/man4/age.4				1.1-1.3
share/man/man4/ale.4				1.1-1.2
share/man/man4/atphy.4				1.1-1.2
share/man/man4/Makefile				1.486, 1.489
strib/sets/lists/man/mi				1.1118, 1.1132
sys/arch/i386/conf/GENERIC			1.928, 1.933
sys/arch/i386/conf/XEN2_DOM0			1.57, 1.60
sys/arch/amd64/conf/GENERIC			1.239, 1.241
sys/arch/amd64/conf/XEN3_DOM0			1.38, 1.42

	Add the age(4) and ale(4) drivers for Attansic L1 and Atheros
	AR8121/AR8113/AR8114 devices respectively.
	[cegger, ticket #735]

sys/arch/x86/pci/pchb.c				1.15 - 1.17
sys/dev/pci/agp.c				1.63 - 1.65
sys/dev/pci/agp_i810.c				1.57 - 1.64
sys/dev/pci/agpreg.h				1.20
sys/dev/pci/pcidevs				1.965, 1.967 via patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add AGP support for Intel G35, G45, and Q45
	[snj, ticket #737]

gnu/dist/binutils/bfd/elf32-vax.c		1.9

	Allocate relocation section using bfd_zalloc() to ensure no garbage
	relocations when not all the entries are used.
	Fixes PR port-vax/39182.
	[mhitch, ticket #738]

sys/ufs/ffs/ffs_alloc.c				1.123 via patch

	Fix random 'filesystem full' messages by trapping a couple of
	32-bit overflow areas missed in rev 1.110 and switching cgbase().
	[sborrill, ticket #726]

share/man/man4/age.4				1.4
share/man/man4/ale.4				1.3

	age(4) and ale(4) will first appear in 5.1, not 6.0.
	[cegger, ticket #739]

usr.sbin/racoonctl/Makefile			1.5 via patch

	Adjust the ADMINPORTDIR to match that of racoon (with which it'll
	want to talk).  Fixes PR 41376.
	[spz, ticket #740]

sys/arch/hp700/include/intr.h			1.14

	Add __insn_barrier after updating cpl in splraise. PR/41369.
	[skrll, ticket #741]

sys/arch/m68k/include/psl.h			1.14

	Add memory clobber to the instructions that change the IPL in the
	status register.  See also kern/38637.
	[mhitch, ticket #743]

sys/arch/hp700/dev/pdc.c			1.27

	Pass proper timeval args to pdc_call() to save TOD with
	PDC_TOD_WRITE.
	[skrll, ticket #744]

sys/netinet/in_pcb.c				patch

	Fix compilation with IPNOPRIVPORTS option.
	[sborrill, ticket #745]

share/man/man8/afterboot.8			1.39

	Fix typo, from Shannon -jj Behrens in PR 41375.
	[dholland, ticket #746]

distrib/sets/lists/etc/mi			1.209
doc/3RDPARTY					1.691
doc/CHANGES					1.1220
etc/defaults/rc.conf				1.103
etc/rc.d/Makefile				1.78 via patch
etc/rc.d/dhcpcd					1.1
external/bsd/dhcpcd/dist/README			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/arp.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/arp.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/bind.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/bind.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/bpf-filter.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/bpf.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/client.c		removed
external/bsd/dhcpcd/dist/client.h		removed
external/bsd/dhcpcd/dist/common.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/common.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/config.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/configure.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/configure.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/control.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/control.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcp.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcp.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-run-hooks.8.in	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-run-hooks.in	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.8.in		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.conf		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.conf.5.in	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/duid.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/duid.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/eloop.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/eloop.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-bsd.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-options.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-options.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-pref.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/if-pref.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/ipv4ll.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/ipv4ll.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/logger.c		removed            
external/bsd/dhcpcd/dist/logger.h		removed
external/bsd/dhcpcd/dist/net.c			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/net.h			dhcpcd-5-0-1
external/bsd/dhcpcd/dist/signals.c		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/signals.h		dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/01-test	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/10-mtu	dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/20-resolv.conf dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/29-lookup-hostname dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/30-hostname dhcpcd-5-0-1
external/bsd/dhcpcd/dist/dhcpcd-hooks/50-ntp.conf dhcpcd-5-0-1
external/bsd/dhcpcd/sbin/dhcpcd/Makefile	1.4

	Update dhcpcd to 5.0.1.
	[roy, ticket #534]

BUILDING					1.83
doc/BUILDING.mdoc				1.72
external/mit/xorg/lib/freetype/Makefile		1.5

	Introduce MKSUBPIXEL, which allows enabling subpixel rendering code
	in FreeType.
	[snj, ticket #742]

gnu/usr.bin/groff/tmac/mdoc.local		1.51 via patch

	Add an entry for 5.1.
	[snj, ticket #747]

sys/dist/ipf/netinet/ip_fil_netbsd.c		1.50

	Don't call callout_stop() without callout_init()
	Fixes PR/41364
	[kefren, ticket #748]

sys/dev/md.c					1.58

	Check the RAMdisk size in mdattach() and not nothing if it's 0.
	This allows mdattach() to be called twice, once from config_finalize()
	and once from tftproot_getfile(). Fix options TFTPROOT.
	[manu, ticket #749]

sys/arch/sparc/include/math.h			1.5
sys/arch/sparc64/include/math.h			1.7

	merge these two files, makes sparc64 sparc/libc work again.
	only provide __HAVE_LONG_DOUBLE if _LP64.
	[mrg, ticket #750]

sys/dev/pci/if_wm.c				patch
	Remove extra printf().
	[msaitoh, ticket #751]

sys/arch/amd64/amd64/lock_stubs.S		1.22, 1.23
sys/arch/i386/i386/lock_stubs.S			1.23
sys/arch/x86/include/mutex.h			1.6
sys/arch/x86/x86/patch.c			1.18
sys/kern/kern_rwlock.c				1.30

	Add a workaround for a bug with some Opteron revisions where
	locked operations sometimes do not serve as memory barriers,
	allowing memory references to bleed outside of critical sections.
	[ad, ticket #725]

usr.sbin/postinstall/postinstall		1.95

	Teach postinstall about /etc/dhcpcd.conf.
	[jnemeth, ticket #752]

usr.sbin/postinstall/postinstall		1.96 via patch

	Teach postinstall about /etc/rc.d/dhcpcd.
	[jnemeth, ticket #753]

sys/arch/xen/xen/if_xennet_xenbus.c		1.35

	Do not forget to detach rnd(4) device when removing a xennet
	device.
	[jym, ticket #754]

usr.sbin/postinstall/postinstall		1.97

	Fetch /etc/dhcpcd.conf from the correct place when building
	the system from source.
	[jnemeth, ticket #756]

etc/rc.d/network				1.58

	Only start dhcpcd per interface if not running the full dhcpcd daemon.
	Only stop dhcpcd pre interface if it's running for the interface.
	Fixes PR bin/40320
	[roy, ticket #757]

distrib/utils/sysinst/arch/i386/md.c		1.122
distrib/utils/sysinst/bsddisklabel.c		1.52
distrib/utils/sysinst/defs.h			1.143
distrib/utils/sysinst/disks.c			1.105
distrib/utils/sysinst/mbr.c			1.80
distrib/utils/sysinst/mbr.h			1.23
distrib/utils/sysinst/msg.mi.de			1.49
distrib/utils/sysinst/msg.mi.en			1.155
distrib/utils/sysinst/msg.mi.es			1.26
distrib/utils/sysinst/msg.mi.fr			1.106
distrib/utils/sysinst/msg.mi.pl			1.65
distrib/utils/sysinst/savenewlabel.c		1.6

	Support drives over 1TB in size in sysinst.
	Error if drive is over 2TB in size (and thus over the disklabel limit).
	[sborrill, ticket #758]

sys/dev/pci/if_bnx.c				1.21

	Protect against spurious "bnx0: Double mbuf allocation failure!"
	panics.
	[kefren, ticket #760]

sys/arch/x86/include/cacheinfo.h		1.11, 1.12
usr.sbin/cpuctl/arch/i386.c			1.18, 1.19 via patch

	Extend CPU probe of Intel processors to handle extended-models:
	new Intel 45nm processors, Core i7, Atom, and the 45nm Xeon MP.
	Properly decode several new Intel cache descriptors, as listed in the
	most recent (March 2009) edition of Intel's Application Note 485.
	Addresses PR bin/41289 and bin/41290
	[pgoyette, ticket #761]

sys/kern/sys_mqueue.c				1.17

	sys_mq_open: remove broken access flag check.
	Noted by Stathis Kamperis.
	[rmind, ticket #762]

usr.sbin/schedctl/schedctl.c			1.14

	Skip LSIDL and LSZOMB threads when retrieving info.
	[rmind, ticket #763]

sys/arch/sparc/include/psl.h                    1.45

        Add memory clobbers to the inline assembler modifying/testing the %psr
	register, to avoid the compiler reordering instructions out of critical
	sections. Should fix PR port-sparc/41372.
	[martin, ticket #764]

share/man/man7/sysctl.7				1.22 via patch

	Document PROC_PID_LIMIT_SBSIZE.  From Greg A. Woods in PR lib/36463.
	Wording is taken from getrlimit(2).
	[snj, ticket #765]

usr.bin/paste/paste.c				1.15

	Null-terminate the delimiter list string after processing escapes
	(which can shorten it) because the code that issues delimiters depends
	on it being null-terminated. This caused e.g. paste -d '\0' a b to
	print a '0' at the beginning of each line. Closes PR 41159.
	[dholland, ticket #766]

dist/wpa/src/drivers/driver_bsd.c		1.6

	Use new way of associating, which fixes wpa with ral(4)
	[roy, ticket #755]

external/bsd/dhcpcd/dist/README				patch
external/bsd/dhcpcd/dist/bind.c				patch
external/bsd/dhcpcd/dist/config.h			patch
external/bsd/dhcpcd/dist/dhcpcd.c			patch
external/bsd/dhcpcd/dist/dhcpcd.conf			patch
external/bsd/dhcpcd/dist/net.c				patch
external/bsd/dhcpcd/dist/dhcpcd-hooks/10-mtu		patch
external/bsd/dhcpcd/dist/dhcpcd-hooks/20-resolv.conf	patch
external/bsd/dhcpcd/dist/dhcpcd-hooks/50-ntp.conf	patch
	
	Update dhcpcd to 5.0.4:
	* ServerID requirement in DHCP messages can be toggled in dhcpcd.conf
	* If MTU is requested, don't apply if less than 576
	* Enforce a minimum lease time of 20 seconds
	* -n option now starts dhcpcd if not already started
	* 29-lookup-hostname hook installed by default, but skipped in
	  dhcpcd.conf
	* Fix warning about missing dirs if we don't have any existing state
	[roy, ticket #759]

sys/arch/vax/include/mtpr.h			1.21, 1.22

	Add "memory" clobber to mtpr for barrier.  See also kern/38637.
	[mhitch, ticket #767]

sys/dev/pci/pcidevs				1.975, 1.981, 1.982 via patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/if_wm.c				1.164, 1.167, 1.173, 1.174 via patch
sys/dev/pci/if_wmreg.h				1.25, 1.27 via patch

	Sync wm(4) driver with HEAD, adding support for more devices and
	fixing some bugs (including a NULL pointer dereference).
	[bouyer, ticket #771]

distrib/utils/sysinst/arch/arc/md.c		1.32
distrib/utils/sysinst/arch/bebox/md.c		1.52
distrib/utils/sysinst/arch/cobalt/md.c		1.3
distrib/utils/sysinst/arch/evbmips/md.c		1.5
distrib/utils/sysinst/arch/evbppc/md.c		1.28
distrib/utils/sysinst/arch/hpcarm/md.c		1.6
distrib/utils/sysinst/arch/hpcmips/md.c		1.44
distrib/utils/sysinst/arch/landisk/md.c		1.6
distrib/utils/sysinst/arch/ofppc/md.c		1.5
distrib/utils/sysinst/arch/playstation2/md.c	1.23
distrib/utils/sysinst/arch/prep/md.c		1.30
distrib/utils/sysinst/arch/sandpoint/md.c	1.29
distrib/utils/sysinst/arch/zaurus/md.c		1.4

	Catch up with ticket 755.
	[sborrill, ticket #773]

dist/ntp/ntpd/ntp_crypto.c			1.15

	Fix CVE-2009-1252: Buffer overflow in ntpd crypto code. A remote
	attacker can send a specially constructed request packet that
	would overflow the sprintf()'ed buffer causing ntpd to crash.
	[dholland, ticket #777]

sys/arch/sparc64/sparc64/vm_machdep.c           1.88

	When preparing the initial trap frame for a new forked lwp,         
	explicitly clear condition code. Otherwise we might catch a signal
	(handlers are inherited from the parent) before we ever return to
	userland. The current trapframe is converted into a ucontext and
	after the signal handler returns, the lwp stays in userland and
	directly uses the ucontext to return to the fork call.
	Fixes PR 41302.
	[martin, ticket #774]

distrib/utils/sysinst/arch/mac68k/md.c		1.54

	Fix build by explicitly narrowing dlsize to an unsigned 32-bit
	quantity as supported by disklabel.  Fixes fallout from ticket
	755.
	[sborrill, ticket #778]

sys/kern/sys_mqueue.c				1.18

	- Slightly rework the way permissions are checked. Neither
	mq_receive() nor mq_send() should fail due to permissions.
	- Check for empty message queue name (POSIX does not allow this
	for regular files, and it's weird), check for DTYPE_MQUEUE, fix
	permission check in mq_unlink(), clean up.
	[rmind, ticket #779]

sys/kern/kern_physio.c				1.91

	Remove a race where physio_done() may use memory already
	freed.  Fixes PR kern/39536.
	[hannken, ticket #781]

src/external/bsd/fetch/dist/libfetch/common.c	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/common.h	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/errlist.sh	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/fetch.3	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/fetch.c	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/fetch.cat3	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/fetch.h	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/file.c	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/ftp.c	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/ftp.errors	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/http.c	libfetch-2-23
src/external/bsd/fetch/dist/libfetch/http.errors libfetch-2-23
        
	Pull up libfetch-2.23:
	- if-not-modified support               
	- document that struct URL is not part of the ABI
	- fetchRestartCalls cleanup for signal handlers
	- allow HTTP basic auth to be specified in the URL, allow : as part of
	  the cleartext password
	- fix a file descriptor leak in the file:// iteration code
	[joerg, ticket #670]

UPDATING					patch
distrib/sets/lists/base/mi			patch
distrib/sets/lists/etc/mi			patch
distrib/sets/lists/man/mi			patch
external/bsd/pkg_install/Makefile.inc		patch
external/bsd/pkg_install/prepare-import.sh	patch
external/bsd/pkg_install/dist/add/add.h		pkg_install-20090528
external/bsd/pkg_install/dist/add/main.c	pkg_install-20090528
external/bsd/pkg_install/dist/add/perform.c	pkg_install-20090528
external/bsd/pkg_install/dist/add/pkg_add.1	pkg_install-20090528
external/bsd/pkg_install/dist/admin/admin.h	pkg_install-20090528
external/bsd/pkg_install/dist/admin/audit.c	pkg_install-20090528
external/bsd/pkg_install/dist/admin/check.c	pkg_install-20090528
external/bsd/pkg_install/dist/admin/main.c	pkg_install-20090528
external/bsd/pkg_install/dist/admin/pkg_admin.1	pkg_install-20090528
external/bsd/pkg_install/dist/bpm/bpm.1		pkg_install-20090528
external/bsd/pkg_install/dist/create/build.c	pkg_install-20090528
external/bsd/pkg_install/dist/create/create.h	pkg_install-20090528
external/bsd/pkg_install/dist/create/main.c	pkg_install-20090528
external/bsd/pkg_install/dist/create/perform.c	pkg_install-20090528
external/bsd/pkg_install/dist/create/pkg_create.1 pkg_install-20090528
external/bsd/pkg_install/dist/create/pl.c	pkg_install-20090528
external/bsd/pkg_install/dist/create/util.c	pkg_install-20090528
external/bsd/pkg_install/dist/delete/pkg_delete.1 pkg_install-20090528
external/bsd/pkg_install/dist/info/info.h	pkg_install-20090528
external/bsd/pkg_install/dist/info/main.c	pkg_install-20090528
external/bsd/pkg_install/dist/info/perform.c	pkg_install-20090528
external/bsd/pkg_install/dist/info/pkg_info.1	pkg_install-20090528
external/bsd/pkg_install/dist/info/show.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/automatic.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/config.h.in	pkg_install-20090528
external/bsd/pkg_install/dist/lib/conflicts.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/decompress.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/dewey.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/fexec.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/file.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/global.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/iterate.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/lib.h		pkg_install-20090528
external/bsd/pkg_install/dist/lib/lpkg.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/opattern.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/pkg_io.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/pkg_summary.5	pkg_install-20090528
external/bsd/pkg_install/dist/lib/pkgdb.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/plist.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/str.c		pkg_install-20090528
external/bsd/pkg_install/dist/lib/var.c		pkg_install-20090528
external/bsd/pkg_install/dist/lib/version.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/version.h	pkg_install-20090528
external/bsd/pkg_install/dist/lib/vulnerabilities-file.c pkg_install-20090528
external/bsd/pkg_install/dist/admin/audit-packages.sh.in pkg_install-20090528
external/bsd/pkg_install/dist/admin/download-vulnerability-list.sh.in pkg_install-20090528
external/bsd/pkg_install/dist/delete/pkg_delete.c pkg_install-20090528
external/bsd/pkg_install/dist/lib/gpgsig.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/license.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/parse-config.c pkg_install-20090528
external/bsd/pkg_install/dist/lib/pkcs7.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/pkg_install.conf.5.in pkg_install-20090528
external/bsd/pkg_install/dist/lib/pkg_signature.c: pkg_install-20090528
external/bsd/pkg_install/dist/lib/remove.c	pkg_install-20090528
external/bsd/pkg_install/dist/lib/xwrapper.c	pkg_install-20090528
external/bsd/pkg_install/dist/x509/pkgsrc.cnf	pkg_install-20090528
external/bsd/pkg_install/dist/x509/pkgsrc.sh	pkg_install-20090528
external/bsd/pkg_install/dist/x509/signing.txt	pkg_install-20090528
external/bsd/pkg_install/lib/Makefile		patch
external/bsd/pkg_install/sbin/Makefile		patch
external/bsd/pkg_install/sbin/Makefile.inc	patch
external/bsd/pkg_install/sbin/pkg_add/Makefile	patch
external/bsd/pkg_install/sbin/pkg_admin/Makefile patch
external/bsd/pkg_install/sbin/pkg_create/Makefile patch
external/bsd/pkg_install/sbin/pkg_delete/Makefile patch
external/bsd/pkg_install/sbin/pkg_info/Makefile	patch
external/bsd/pkg_install/dist/add/extract.c	removed
external/bsd/pkg_install/dist/add/futil.c	removed
external/bsd/pkg_install/dist/add/verify.c	removed
external/bsd/pkg_install/dist/add/verify.h	removed
external/bsd/pkg_install/dist/admin/config.c	removed
external/bsd/pkg_install/dist/audit-packages/AUTHORS removed
external/bsd/pkg_install/dist/audit-packages/COPYING removed
external/bsd/pkg_install/dist/audit-packages/README removed
external/bsd/pkg_install/dist/audit-packages/audit-packages.1.in removed
external/bsd/pkg_install/dist/audit-packages/audit-packages.c removed
external/bsd/pkg_install/dist/audit-packages/audit-packages.conf.5.in removed
external/bsd/pkg_install/dist/audit-packages/audit-packages.conf.in removed
external/bsd/pkg_install/dist/audit-packages/download-vulnerability-list.1.in removed
external/bsd/pkg_install/dist/audit-packages/download-vulnerability-list.sh.in removed
external/bsd/pkg_install/dist/delete/delete.h	removed
external/bsd/pkg_install/dist/delete/main.c	removed
external/bsd/pkg_install/dist/delete/perform.c	removed
external/bsd/pkg_install/dist/lib/ftpio.c	removed
external/bsd/pkg_install/dist/lib/path.c	removed
external/bsd/pkg_install/dist/lib/path.h	removed
external/bsd/pkg_install/dist/lib/pen.c		removed
external/bsd/pkg_install/dist/lib/pexec.c	removed
external/bsd/pkg_install/dist/view/linkfarm.1	removed
external/bsd/pkg_install/dist/view/linkfarm.sh.in removed
external/bsd/pkg_install/dist/view/pkg_view.1	removed
external/bsd/pkg_install/dist/view/pkg_view.sh.in removed
external/bsd/pkg_install/sbin/audit-packages/Makefile removed
external/bsd/pkg_install/sbin/pkg_view/Makefile	removed

	Merge pkg_install-20090528 from HEAD.
	[joerg, ticket #784]

usr.sbin/puffs/mount_sysctlfs/sysctlfs.c	1.11

	Fix a crash while trying to read nodes on amd64, reported in
	PR/41494.
	[njoly, ticket #783]

sys/arch/sparc/sparc/autoconf.c			1.233 via patch
sys/arch/sparc/sparc/cpu.c			1.213 via patch
sys/arch/sparc/sparc/cpuvar.h			1.76 via patch
sys/arch/sparc/sparc/db_interface.c		1.83 via patch
sys/arch/sparc/sparc/intr.c			1.102 via patch
sys/arch/sparc/sparc/pmap.c			1.325 via patch
sys/arch/sparc/sparc/timer_sun4m.c		1.17 via patch

	Work in progress fixes for sparc SMP support.  Makes
	non-MULTIPROCESSOR kernels work with LOCKDEBUG.  Rearange
	cpu_info access and hide the actual implementation of the
	mapping from all parts of the code that do not directly deal
	with it. Do the mapping early in pmap_bootstrap, so that
	post-vmlocking2 kernels have a chance to work.
	[mrg, ticket #776]

sys/fs/udf/udf_strat_direct.c			1.10
sys/fs/udf/udf_strat_rmw.c			1.19
sys/fs/udf/udf_strat_sequential.c		1.10
sys/fs/udf/udf_subr.c				1.90
sys/fs/udf/udf_subr.c				1.91

	Descriptor version is 16 bit and not 8 so use udf_rw16() to access
	them.  UniqueID was written in the logical volume integrity without
	byteswapping for big endian machines.

	Retire IN_CALLBACK_ULK flagging since its not used anymore and the
	old assertions on it would trigger without cause.
	[reinoud, ticket #772]

sys/netinet/ip_carp.c				1.37

	PR/38260: Improve carp logging.
	[christos, ticket #785]

sys/arch/sparc64/include/cpu.h			1.86
sys/arch/sparc64/sparc64/locore.s		1.291
sys/arch/sparc64/sparc64/vm_machdep.c		1.89

	cpu_setfunc() can not use lwp_trampoline, as that has additional
	lwp startup semantics. Use a simpler setfunc_trampoline instead.
	[martin, ticket #786]

sys/arch/m68k/include/m68k.h			1.14
sys/arch/m68k/m68k/switch_subr.s		1.22
sys/arch/m68k/m68k/vm_machdep.c			1.28

	Do not use lwp_trampoline for cpu_setfunc, we do not want to call
	lwp_startup() after a setfunc. Grow a simplified setfunc_trampoline
	instead.
	[martin, ticket #787]

sys/dev/pci/if_wm.c				1.175 via patch
sys/net/agr/ieee8023ad_lacp.c			1.9 via patch
sys/net/agr/if_agr.c				1.23 via patch
sys/net/agr/if_agrether.c			1.7 via patch
sys/net/agr/if_agrvar_impl.h			1.8 via patch
sys/net/if_ethersubr.c				1.172 via patch

	Add vlan support and hardware offload capabilities to agr.
	These changes allow vlans to be layered above agr, with the attach
	and detach propogated to the member ports in the aggregation.
	Note the agr interface must be up before the vlan is attached.

	Adds SIOCSIFADDR support to the wm driver for setting the AF_LINK
	address, necessary for agr to be able to set the mac addresses of
	each port to the agr address (i.e. so it can receive all intended
	traffic at the hardware level).

	Adds support for disabling the LACP protocol by setting LINK1 on
	the agr interface (e.g. ifconfig agr0 link1).
	[darran, ticket #792]

sys/arch/hp700/hp700/locore.S			1.35
sys/arch/hp700/include/cpu.h			1.34
sys/arch/hppa/hppa/vm_machdep.c			1.36

	Do not use lwp_trampoline for cpu_setfunc, but a simplified
	setfunc_trampoline that does not call lwp_startup().
	[skrll, ticket #793]

sbin/drvctl/drvctl.8				1.7 - 1.10
sbin/drvctl/drvctl.c				1.7, 1.9, 1.10 via patch

	fix sign-compare issues
	Add flag -n to suppress the first column of drvctl -l output.
	[dyoung, ticket #736]

sys/fs/udf/ecma167-udf.h			1.12

	Make ecma167 header file compilable by pcc
	[reinoud, ticket #769]

sbin/newfs_udf/udf_create.c			1.16
sys/fs/udf/udf_allocation.c			1.22, 1.23
sys/fs/udf/udf_bswap.h				1.6, 1.7
sys/fs/udf/udf_subr.c				1.88, 1.89

	Various fixes for big endian machines.
	[reinoud, ticket #770]

distrib/common/parselist.awk			1.16
distrib/sets/maketars				1.66
share/dict/Makefile				1.17
share/mk/bsd.README				1.249
share/mk/bsd.hostprog.mk			1.55
share/mk/bsd.kmodule.mk				1.19
share/mk/bsd.lib.mk				1.298
share/mk/bsd.links.mk				1.34
share/mk/bsd.man.mk				1.100
share/mk/bsd.prog.mk				1.241
share/zoneinfo/Makefile				1.43
usr.bin/xinstall/xinstall.c			1.106 - 1.108 via patch

	Various METALOG fixes, including entries sorting to
	fix inconsistent shared sets among builds as seen in
	/pub/NetBSD-daily/netbsd-5/200904010000Z/shared/ and
	/pub/NetBSD-daily/netbsd-5/200904010002Z/shared/ dirs.
	Should fix PR 24457 and PR 41155.
	[snj, ticket #790]

sys/kern/sched_4bsd.c				1.25

	sched_pstats_hook: fix estcpu decay.
	this makes my desktop usable when running "make -j4".
	[rmind, ticket #791]

sbin/atactl/atactl.c				1.54

	make space for a trailing \0 in model,revision and serial buffers.
	[mlelstv, ticket #794]

external/mit/xorg/server/drivers/xf86-video-s3/Makefile patch
 
	Add missing object file to build a properly working s3 module.
	Fixes PR xsrc/41206.
	[ahoka, ticket #795]

sys/netinet/ip_carp.c				1.38

	Make ip_carp.c compile, fixing usage of CARP_LOG().
	[taca, ticket #796]

bin/df/df.c					1.86

	Block numbers are measured in f_frsize units. Make -P option
	use this instead of f_bsize. Also account for reserved blocks
	like normal non-P output.
	Fixes PR bin/41541.
	[mlelstv, ticket #797]

sys/arch/alpha/alpha/locore.s			1.114
sys/arch/alpha/alpha/vm_machdep.c		1.100
sys/arch/alpha/include/alpha.h			1.24

	Do not use lwp_trampoline for cpu_setfunc, but a simplified
	setfunc_trampoline that does not call lwp_startup() instead.
	[martin, ticket #798]

sys/arch/mips/include/locore.h			1.79
sys/arch/mips/mips/locore_mips1.S		1.65
sys/arch/mips/mips/mipsX_subr.S			1.28
sys/arch/mips/mips/mips_machdep.c		1.211
sys/arch/mips/mips/vm_machdep.c			1.123

	Do not use the same trampoline for cpu_lwp_fork and
	cpu_setfunc - only the former needs to call lwp_startup().
	[martin, ticket #799]

sys/arch/sparc/dev/zs.c				1.116

	Properly initialize child attach args to zero - we could end
	up with various devices having different ideas about being
	console otherwise.
	[martin, ticket #800]

sys/arch/powerpc/powerpc/locore_subr.S		1.38
sys/arch/powerpc/powerpc/vm_machdep.c		1.77

	Do not use the same trampoline for cpu_setfunc and
	cpu_lwp_fork, the latter does a lot more work.
	[martin, ticket #801]

sys/arch/sh3/sh3/locore_subr.S			1.52

	Fix logic error in copyinstr() when deciding whether to return EFAULT
	or ENAMETOOLONG.
	[uwe, ticket #802]

sbin/newfs/newfs.c				1.103

	Issue a better error message if attempting to create a file system
	on a block device.  Inspired by PR kern/41127.
	[snj, ticket #803]

sys/arch/x86/conf/files.x86			1.52 via patch
sys/arch/x86/include/cpu.h			1.17
sys/arch/x86/x86/cpu_topology.c			1.1
sys/arch/x86/x86/identcpu.c			1.16 via patch
sys/arch/xen/conf/files.xen			1.99 via patch

	Move x86 CPU topology detection code into the separate file.
	[rmind, ticket #782]

sys/arch/x86/include/specialreg.h		1.36
sys/arch/x86/x86/cpu_topology.c			1.2

	Add CPU topology detection support for AMD processors.
	Tested on the following AMD CPUs:
	- Family 15, model 65
	- Family 15, model 67
	- Family 15, model 75
	- Family 16, model 2
	- Family 17, model 3
	[rmind, ticket #789]

distrib/sets/lists/xbase/mi			1.76
external/mit/xorg/bin/xvidtune/Makefile		1.2

	fix xsrc/41577: install the Xvidtune app-defaults file, after the
	necessary preprocessing and sed processing it needs.
	[mrg, ticket #805]

sys/compat/linux/common/linux_socket.c		1.100

	In sendmsg(2), do copy the msghdr structure before trying to use it.
	[njoly, ticket #806]

sys/kern/tty_pty.c				1.117

	Writes on the controlling tty were not being awoken from blocks,
	use the correct condvar to make this happen.
	this fixes PR/41566
	[plunky, ticket #807]

external/bsd/am-utils/lib/libamu/mkconf		1.2

	PR/41580: Hauke Fath: am-utils uses "netbsd${OSVER}" selector, still.
	Changed to "netbsd"
	[christos, ticket #808]

sys/kern/subr_kobj.c				1.35

	Fix a crash observed when trying to load a corrupted ELF kernel module.
	[rmind, ticket #809]

sys/netinet/tcp_usrreq.c			1.155

	sysctl_inpcblist: fix a lock leak in error path
	[rmind, ticket #812]

usr.bin/window/ttgeneric.c			1.11

	PR/41581: Der mouse: window SEGV with certain terminals.
	does strcmp first and then checks for null pointer for
	underline and bold.
	[christos, ticket #813]

sys/dev/pci/ehci_pci.c				1.45

	Apply hw workaround required for all SB600 revisions and SB700
	revisions A12 and A13 to avoid USB subsystem hang symptom.
	The USB subsystem hang symptom is observed when the system has
	multiple USB devices connected to it or one USB device is often
	re-connected.
	[cegger, ticket #814]

lib/libpam/modules/pam_unix/pam_unix.c		1.13

	Restore the good old UNIX behavior of root password changing: only root
	may change the root password.
	[tonnerre, ticket #817]

