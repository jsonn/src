# $NetBSD: CHANGES-5.0,v 1.1.2.15 2008/11/11 02:19:46 snj Exp $

A complete list of changes from the initial NetBSD 5.0 branch on October 2008
until the 5.0 release:

gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Welcome to 5.0_BETA!

sys/arch/arm/gemini/obio_wdt.c			1.2
distrib/evbarm/instkernel/instkernel/Makefile	1.14
distrib/evbarm/gzboot/gzimg/Makefile		1.20

	Register gemini watchdog with sysmon_wdog_register and rip out some
	debugging code.  Create gemini instkernel and gzimg.	
	[cliff, ticket #2]

etc/etc.cobalt/MAKEDEV.conf			1.10

	Create bpf(4) device node on ramdisk for sysinst.
	[tsutsui, ticket #4]

sys/kern/vfs_dirhash.c				1.5-1.8

	Clean up dirhash and use hash32_strn(). Remove old KASSERTS that
	were commented out. Protect the dirhash_queue when purging hashed
	directories in memory overflow situations. Clarify the dirhash
	locking protocol and remove unnessiary #ifdef DEBUG flag.
	[reinoud, ticket #5]

etc/etc.amd64/MAKEDEV.conf			1.13-1.15
etc/etc.i386/MAKEDEV.conf			1.17-1.19

	Create 4 Xen disks by default and all three Xen devices to make it
	usable out-of-the-box.  Create 8 dk instances by default, since GPT
	autodiscovery is enabled.
	[joerg, ticket #3]

sys/fs/udf/udf_strat_rmw.c			1.10

	Explicitly set buffer's block numbers. Blocks were always read/written
	correctly only the sheduling could go less than optimal.
	[reinoud, ticket #6]

external/mit/xorg/lib/Makefile			1.5

	Move libXft down in the hierarchy, because it depends on libXrandr.
	[cube, ticket #7]

sys/fs/udf/udf_strat_rmw.c			1.11

	Introduce an extra state to wich all pushed ecclines are pushed
	on.  This extra state has a holding time in wich no writeouts will
	be done effectively collecting more sectors before its even scheduled
	for writing.  Significantly boosts write performance.
	[reinoud, ticket #8]

sys/miscfs/genfs/genfs_io.c			1.14
sys/nfs/nfs_bio.c				1.180
sys/uvm/uvm_extern.h				1.149

	- allocate 8 pointers on the stack to avoid stack overflow in nfs.
	- make that 8 a constant
	- remove bogus panic
	Fixes PR kern/39777. 
	[tron, ticket #9]

dist/file/src/apprentice.c			1.20

	Fix build of file when cross-compiling on Solaris.
	[hubertf, ticket #11]

usr.sbin/mmcformat/mmcformat.8			1.2

	Fix manpage; it showed option -i where it had to be -I
	[reinoud, ticket #12]

sys/arch/atari/dev/clock.c			1.42

	Move tc_init(&clk_timecounter) to stop the "timecounter:" message
	appearing in the middle of the clock0 attach message.
	[abs, ticket #13]

sys/arch/atari/dev/md_root.c			1.26

	Use brelse() to unbusy bp buffer to allow user to swap floppy
	disks when prompted.
	[abs, ticket #14]

sys/dev/sysmon/sysmon_envsys_events.c		1.59-1.60

	Restore previous behavior concerning CRITICAL events.  Send an
	event whenever state enters or exits CRITICAL, or whenever value
	of sensor changes while the state is CRITICAL.
	[pgoyette, ticket #15]

external/mit/xorg/lib/libXaw7/Makefile		1.4

	Add necessary defines (-DXAW7).
	[cube, ticket #16]

sys/arch/x86/include/ipmivar.h			1.9
sys/arch/x86/x86/ipmi.c				1.22-1.25

	Initialize the sc_dev.dv_xname in ipmi_match, which is enough to
	make DEVNAME work. Finally this also allows the device_t/softc
	split. If ipmi failed to attach we would crash because we would
	end up using callouts while cold. If cold, wait 10 times longer,
	and if we spinout fail instead of trying to poll.
	[cegger, ticket #10]

distrib/amd64/ramdisks/ramdisk/list		1.8
distrib/i386/ramdisks/common/list.ramdisk	1.8
etc/etc.amd64/MAKEDEV.conf			1.16
etc/etc.i386/MAKEDEV.conf			1.20
sys/arch/i386/conf/INSTALL_FLOPPY		1.2

	Make x86 installation use tmpfs and stop distinguishing MAKEDEV
	init and MAKEDEV all.
	[joerg, ticket #18]

sys/arch/atari/conf/GENERIC.in			1.74
sys/arch/atari/conf/README			1.3
sys/arch/atari/conf/ATARITT			regen
sys/arch/atari/conf/BOOT			regen
sys/arch/atari/conf/HADES			regen
sys/arch/atari/conf/BOOTX			regen
sys/arch/atari/conf/FALCON			regen
sys/arch/atari/conf/MILAN-ISAIDE		regen
sys/arch/atari/conf/MILAN-PCIIDE		regen

	Add a note that SERCONSOLE breaks on the Falcon, and remove from
	FALCON config.
	[abs, ticket #19]

compat/libexec/ld.elf_so/Makefile		1.2
distrib/sets/lists/base/md.i386			1.129-1.130
distrib/sets/lists/comp/md.i386			1.107-1.108
distrib/sets/lists/base/md.amd64		1.26
distrib/sets/lists/base/md.sparc64		1.24
distrib/sets/lists/comp/md.amd64		1.40
distrib/sets/lists/comp/md.sparc64		1.38
distrib/sets/lists/base/ad.arm			1.10
distrib/sets/lists/base/md.shark		1.7
distrib/sets/lists/base/md.sparc		1.75
distrib/sets/lists/base/md.vax			1.26
distrib/sets/lists/comp/ad.arm			1.31
distrib/sets/lists/comp/md.pmax			1.59
distrib/sets/lists/comp/md.shark		1.13
distrib/sets/lists/comp/md.sparc		1.68
distrib/sets/lists/comp/md.vax			1.35
libexec/ld.aout_so/Makefile			1.46
sbin/ldconfig/Makefile				1.22

	Make MKPIC=no builds work on i368, shark, vax, pmax, sgimips,
	sparc, maybe all mips and all arm as well.
	[mrg, ticket #20]

sys/kern/kern_cpu.c				1.38

	cpuctl_ioctl: use cpu_index(), instead of cpuid.  Fixes cpuctl(8)
	on machines where the cpu's apic id are different from their
	device unit.
	[cegger, ticket #21]

external/mit/xorg/lib/Makefile			1.6
external/mit/xorg/lib/libOSMesa/Makefile	1.3
external/mit/xorg/lib/libXScrnSaver/Makefile	1.4
external/mit/xorg/lib/libXcomposite/Makefile	1.4
external/mit/xorg/lib/libXdamage/Makefile	1.3
external/mit/xorg/lib/libXevie/Makefile		1.4
external/mit/xorg/lib/libXfixes/Makefile	1.4
external/mit/xorg/lib/libXfont/Makefile		1.4
external/mit/xorg/lib/libXft/Makefile		1.5
external/mit/xorg/lib/libXinerama/Makefile	1.4
external/mit/xorg/lib/libXprintAppUtil/Makefile	1.3
external/mit/xorg/lib/libXprintUtil/Makefile	1.3
external/mit/xorg/lib/libXres/Makefile		1.7
external/mit/xorg/lib/libXvMC/Makefile		1.3
external/mit/xorg/lib/libXxf86dga/Makefile	1.3
external/mit/xorg/lib/libXxf86misc/Makefile	1.4
external/mit/xorg/lib/libXxf86vm/Makefile	1.4
external/mit/xorg/lib/liblbxutil/Makefile	1.4
external/mit/xorg/lib/libxkbfile/Makefile	1.3
external/mit/xorg/lib/libxkbui/Makefile		1.3
external/mit/xorg/lib/pixman/Makefile		1.7

	Add missing LIBDPLIBS, found by using 'LDFLAGS += -Wl,-z,defs' and
	sort src/external/mit/xorg/lib/Makefile to match the new order.
	[veego, ticket #22]

lib/libc/arch/sparc/sys/brk.S			1.15

	Redo rev.1.13.  We must refer to CURBRK via GOT in case of PIC.
	[nakayama, ticket #23]

sys/dev/fss.c					1.61

	fss_bs_thread: initialize b_error and b_resid.
	Before it was possible for fss reads to return bogus b_resid values
	leading to "delta > 0" panics from physio().
	[hannken, ticket #24]

external/mit/xorg/lib/dri/Makefile		1.3

	don't build dri drivers on shark
	[macallan, ticket #32]

external/mit/xorg/lib/dri/Makefile		1.4

	Just some nits:
	- test for macppc, not powerpc when building DRI drivers for mac
	- fix a typo in the shark branch
	- don't build DRI drivers on ibmnws either
	[macallan, ticket #26]

xsrc/external/mit/xorg-server/dist/hw/xfree86/os-support/bsd/ppc_video.c 1.4

	Add ARM support.
	[macallan, ticket #27]

distrib/sets/lists/xserver/md.shark		1.23

	Sync list with reality.
	[macallan, ticket #28]

external/mit/xorg/server/drivers/Makefile	1.19

	build only chips and wsfb drivers on shark
	[macallan, ticket #29]

external/mit/xorg/server/drivers/xf86-video-wsfb/Makefile 1.3

	include hw cursor support
	[macallan, ticket #30]

external/mit/xf86-video-wsfb/dist/src/wsfb.h	1.1
external/mit/xf86-video-wsfb/dist/src/wsfb_cursor.c 1.1
external/mit/xf86-video-wsfb/dist/src/wsfb_driver.c 1.2

	Add hw cursor support and unbork shadow fb support.
	[macallan, ticket #31]

distrib/sets/lists/base/mi			1.781
external/intel-fw-public/ipw3945/Makefile	1.2
external/intel-fw-public/ipw3945/dist/ipw3945.ucode removed
external/intel-fw-public/ipw3945/dist/iwlwifi-3945.ucode iwlwifi-3945-ucode-2-14-4
external/intel-fw-public/ipw3945/dist/LICENSE.ipw3945-ucode removed
external/intel-fw-public/ipw3945/dist/LICENSE.iwlwifi-3945-ucode iwlwifi-3945-ucode-2-14-4
external/intel-fw-public/ipw3945/dist/README.ipw3945-ucode removed
external/intel-fw-public/ipw3945/dist/README.iwlwifi-3945-ucode iwlwifi-3945-ucode-2-14-4
share/man/man4/ipw.4				1.3, 1.4
share/man/man4/iwi.4				1.11, 1.12, 1.13
share/man/man4/iwn.4				1.3, 1.4
share/man/man4/wpi.4				1.7, 1.8
sys/dev/pci/if_ipw.c				1.44
sys/dev/pci/if_ipwvar.h				1.14
sys/dev/pci/if_iwi.c				1.76
sys/dev/pci/if_iwn.c				1.26

	(a) Sync man pages with sysctl and the included firmware images.
	(b) Make sure the drivers use the upstream image names, not the mangled
	ones from pkgsrc.
	(c) Use the second generation firmware for wpi(4).
	[joerg, ticket #25]

distrib/sets/lists/xcomp/mi			1.72, 1.73

	Fix MKDEBUG=yes for MKXORG=yes.
	[rtr, ticket #33]

usr.bin/stat/stat.1				1.25

	Be consistent: document the birthtime field of struct stat for
	the "B" field specifier.
	[reed, ticket #34]

etc/etc.atari/MAKEDEV.conf			1.8

	The NetBSD/atari installer can use md2a as a root device, so ensure
	the 'floppy' target creates md2
	[abs, ticket #35]

doc/CHANGES					patch

	Correct description of NSP2000 driver.  It didn't come from the
	public FreeBSD sources, it was generously contributed by its owner,
	NBMK Encryption Technologies, Inc.      
	[tls, ticket #36]

gnu/usr.bin/groff/tmac/mdoc.local		1.46 via patch
distrib/sets/lists/man/mi			1.1110, 1.1111
share/man/man4/nsp.4				1.1, 1.2
sys/dev/pci/n8/helper.c				1.2

	- Add nsp(4) manpage.
	- Remove include of useless i386/include/clock.h which broke builds
	on other architectures.
	[tls, ticket #37]

usr.bin/make/util.c				1.46

	Don't use putenv() because it is not portable.  Fixes crossbuild
	on Solaris.
	[cube, ticket #38]

sys/dev/pci/if_iwi.c				1.77

	Fix typo in firmware name.
	[joerg, ticket #43]

sys/arch/xen/xen/evtchn.c			1.40

	evtchn_do_event(): Avoid KASSERT(iplbit !=0).
	[bouyer, ticket #39]

external/mit/xorg/bin/xdm/config/Makefile	1.3

	- Define CPPSCRIPTFLAGS_Xsession, fixing a broken Xsession file
	- Use -DXPM for xdm-config too
	- Move DEFAULTVT up before CPPSCRIPTS, so the later is in one block.
	[veego, ticket #40]

share/man/man4/acpitz.4				1.9
sys/dev/acpi/acpi_tz.c				1.38, 1.39

	- Temp sensor should report a critical-overtemp condition
	(ENVSYS_SCRITOVER) not a simple critical (ENVSYS_SCRITICAL)
	condition.  
	- Leave the task of displaying sensor states to envsys_sysmon()
	unless we are in debug mode.
	[pgoyette, ticket #41]

