#	$NetBSD: CHANGES-3.0,v 1.1.2.19 2005/03/23 11:12:47 tron Exp $

A complete list of changes from the initial NetBSD 3.0 branch on 16 March 2005
until the 3.0 release:

doc/LAST_MINUTE					patched by hand

	Null out in preparation for 3.0

gnu/usr.bin/groff/tmac/mdoc.local		patched by hand
sys/sys/param.h					patched by hand

	Update to 3.0_BETA

doc/BRANCHES					1.37

	Close out 1.5 and note differences between netbsd-2 and netbsd-2-0
	branches.
	[jmc, ticket #7]

usr.sbin/pkg_install/lib/ftpio.c		1.67

	Address PR pkg/24744 by Jarmo Jaakkola <jarmo.jaakkola@iki.fi>:
	  * ftp.fi.netbsd.org returns "257" in return to a "cd" command, accept
	    that (in addition to 250 and 550). Seems to be allowed per RFC 959.
	  * Make buffer for reply bigger (not too big, as it may hit
	    performance).
	[hubertf, ticket #8]

usr.sbin/pkg_install/lib/version.h		1.65

	Bump PKGTOOLS_VERSION to today's date to allow telling in which version
	PR 24744 was fixed (affects lib/ftpio.c).
	[hubertf, ticket #9]

sbin/mount/mount.c				1.77

	Fix core dump when doing
		mount fileserver:/somepath
	by not passing a NULL pointer to getfsfile(3).
	(Bug was introduced in rev 1.74 as part of fix for PR 28644.)
	[lukem, ticket #10]

sbin/sysctl/sysctl.c				1.98

	Use regexes instead of static lists of annoying numbers to recognize
	sysctl nodes that have "helpers". This is more concise, imho more
	easy to understand, and has the added bonus of making it *possible* to
	assign helpers to dynamically numbered nodes.
	[atatat, ticket #11]

sys/sys/select.h				1.23

	Make sure to declare functions with C linkage; should fix PR bin/29730
	from Juergen Hannken-Illjes.
	[kleink, ticket #14]

doc/3DPARTY					1.305

	Update XFree86 Information.
	[tron, ticket #12]

xsrc/Makefile					1.44

	Remove code handling "contrib" directory.
	[tron, ticket #13]

etc/pam.d/sshd					1.6-1.7

	Make the SSH daemon work again if PAM is enabled.
	[jwise, ticket #19]

etc/pam.d/xserver				1.3

	pam_self is "required" not just sufficient to authorize the Xserver.
	[jwise, ticket #20]

lib/libpam/modules/pam_unix/pam_unix.c		1.6

	Clear the authorization token at the entry of each loop, so that
	we get a chance to re-enter.
	[christos, ticket #22]

lib/libpam/modules/pam_ssh/pam_ssh.c		1.9

	Remove debugging printf's.
	[christos, ticket #23]

libexec/getty/main.c				1.47

	Print ptyfs ptys properly.
	[christos, ticket #24]

libexec/telnetd/utility.c			1.28

	Handle printing ptyfs pty names.
	[christos, ticket #25]

sys/dev/cgd_crypto.c				1.4

	Clear freed memory.
	[dan, ticket #26]

distrib/sets/lists/base/shl.mi			1.305
lib/libc/shlib_version				1.162
lib/libc/sys/Makefile.inc			1.157
lib/libpthread/pthread_cancelstub.c		1.11
lib/libpthread/shlib_version			1.8

	Interpose cancellation points in pollts() and pselect(), bringing us
	to libc.so.12.127 and libpthread.so.0.6.
	[kleink, ticket #27]

sys/arch/xen/i386/hypervisor_machdep.c		1.5

	Avoid loosing upcalls in stipending() by checking evtchn_upcall_pending
	with upcalls unmasked.
	[bouyer, ticket #29]

sys/arch/xen/i386/vector.S			1.7

	When handling a defered event, unmasking it isn't enouth, we also need
	to check if the corresponding bit needs to be set in
	evtchn_pending_sel, and eventually force an upcall (if we got a second
	event when this one what being handled). For now to this by calling
	hypervisor_enable_irq(), this could be rewritten in inline assembly by
	someone knowing enouth about i386 assembly :)
	[bouyer, ticket #30]

sys/arch/xen/xen/ctrl_if.c			1.3

	Print the IRQ used by the domain controller.
	[bouyer, ticket #31]

sys/arch/xen/xen/evtchn.c			1.4

	Protect various IRQ and event allocation/deallocations with splhigh().
	Print the IRQ used for debug and misdirect events.
	[bouyer, ticket #32]

sys/arch/xen/xen/if_xennet.c			1.14

	Convert to ether_ioctl(), and claim IFF_SIMPLEX | IFF_MULTICAST.
	This allows IPv6 on NetBSD domU.
	[bouyer, ticket #33]

sys/arch/i386/conf/XEN0				1.2

	Add PCI audio devices from i386/conf/GENERIC.
	[bouyer, ticket #34]

sys/arch/xen/i386/npx.c				1.4

	npxintr(): this function does the right thing if we don't try to clear
	the interrupt latch (which is probably done by the hypervisor,
	linux/xen doesn't do it either). Now the "fputest" configure test from
	pkgsrc/math/yorick works as expected.
	[bouyer, ticket #35]

sbin/sysctl/sysctl.c				1.99

	Fix possible segmentation fault when retrieving descriptions.
	[atatat, ticket #36]

sys/arch/prep/conf/INSTALL			1.33

	Add PLATFORM_IBM_6015 to INSTALL, as present in GENERIC.
	[kleink, ticket #37]

lib/libpthread/pthread_cancelstub.c		1.12

	Include <sys/select.h> explicitly rather than relying on other headers
	to do it.
	[kleink, ticket #38]

usr.bin/login/login.c				1.83

	Make S/Key prompt compliant with RFC 2289. Patch supplied by Dave
	Huang in PR bin/23167.
	[tron, ticket #28]

include/dlfcn.h					1.18
share/man/man3/dlfcn.3				1.19

	Add restrict qualifiers to dlsym() (XSI) and dladdr() arguments.
	[kleink, ticket #39]

include/netdb.h					1.50
lib/libc/net/getaddrinfo.3			1.42
lib/libc/net/getnameinfo.3			1.35

	Add restrict qualifiers to getaddrinfo() and getnameinfo() arguments.
	[kleink, ticket #40]

lib/libc/net/getaddrinfo.3			1.43
lib/libc/net/getnameinfo.3			1.36

	Only name <netdb.h> in the synopsis, like the old manual page used to.
	[kleink, ticket #41]

lib/librt/sem_getvalue.3			1.2

	Add restrict qualifiers to function arguments (already in
	<semaphore.h>).
	[kleink, ticket #42]

lib/libpam/modules/pam_skey/pam_skey.c		1.2

	Make S/Key prompt compliant with RFC 2289. Patch supplied by Dave Huang
	in PR bin/23167.
	[christos, ticket #43]

usr.sbin/ipwctl/ipwctl.8			1.8
usr.sbin/iwictl/iwictl.8			1.4

	Document where to get firmware binaries (pkgsrc!).
	[hubertf, ticket #45]

lib/libpthread/pthread.h			1.21
lib/libpthread/pthread_attr.3			1.4
lib/libpthread/pthread_barrier_init.3		1.6
lib/libpthread/pthread_cond_init.3		1.5
lib/libpthread/pthread_cond_wait.3		1.6
lib/libpthread/pthread_create.3			1.4
lib/libpthread/pthread_mutex_init.3		1.3
lib/libpthread/pthread_mutexattr.3		1.4
lib/libpthread/pthread_rwlock_init.3		1.6
lib/libpthread/pthread_rwlock_rdlock.3		1.8
lib/libpthread/pthread_rwlock_wrlock.3		1.6
lib/libpthread/pthread_schedparam.3		1.4

	Add restrict qualifiers to <pthread.h> function arguments.
	[kleink, ticket #46]

sys/arch/xen/xen/if_xennet.c			1.15

	In xennet_ioctl, we need a declaration for sc when debugging macros are
	active.  Reported on current-users by Teemu Rinta-aho.
	[bouyer, ticket #47]

doc/CHANGES					patch

	Document last month's ext2fs change.
	[ws, ticket #48]

sys/arch/evbppc/conf/Makefile.ev64260.inc	1.3
sys/arch/evbppc/conf/Makefile.obs405.inc	1.2
sys/arch/evbppc/conf/Makefile.walnut.inc	1.3

	Can't depend on shell scripts being executable from CVS. Preface
	mkimg.sh with ${HOST_SH}
	[jmc, ticket #49]

doc/CHANGES					patch

	Belatedly document ifconfig(8) "tso4" changes.
	[hubertf, ticket #44]

include/search.h				1.17
lib/libc/stdlib/tfind.c				1.4
lib/libc/stdlib/tsearch.3			1.7

	* Add restrict qualifiers to tdelete() function arguments.
	* Const-poison tfind()'s rootp argument, per SVID Issue 1 and later.
	[kleink, ticket #51]

sbin/sysctl/sysctl.c				1.100

	If a "create" or "destroy" operation succeeds, mark the cached tree as
	"stale" so that the next time we try to read or write to it, we can
	purge (and refresh) it. Addresses PR 29222.
	[atatat, ticket #52]

usr.sbin/pppd/pppd/Makefile			1.37

	If SMALLPROG is set, do not build in PAM support. While there, depend
	USE_INET6 on SMALLPROG/SMALLPROG_INET6 like ftp does it.
	This fixes the build of install media (pc532 and sparc64) that include
	ppp support.
	[martin, ticket #53]

lib/libc/stdlib/tfind.c				1.5

	Avoid lint warning after previous.
	[kleink, ticket #54]

