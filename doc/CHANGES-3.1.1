#	$NetBSD: CHANGES-3.1.1,v 1.1.2.34 2007/03/29 09:09:07 ghen Exp $

A complete list of changes from the NetBSD 3.1 release to the NetBSD 3.1.1
release:

File						Revision(s)
----						--------
gnu/usr.bin/groff/tmac/mdoc.local		patch
sys/sys/param.h					patch

	Welcome to 3.1.0_PATCH

sys/arch/sparc64/sparc64/locore.s		1.217-1.218 via patch

	Fix a couple of %y register save/restore errors.
	[nakayama, ticket #1517]

sys/netinet/tcp_sack.c				1.20

	Fix alignment problems causing regular panics in tpc_sack_option on
	NetBSD/alpha and NetBSD/sparc. This fixes PR#34751.

	Fix provided by Izumi Tsutsui and ok'd by Martin.
	[reinoud, ticket #1561]

sys/miscfs/specfs/spec_vnops.c			1.91 via patch

	Protect spec_poll from racing against revocation and thus
	dereferencing a NULL v_specinfo (race condition between polling
	and revoking a character device).
	[jld, ticket #1557]

sys/arch/arm/iomd/iomdkbc.c			1.3

	Interpret the argument to iomdkbc_set_poll() correctly.  Quite how we
	got this far with it the wrong way around is beyond me.
	[bjh21, ticket #1562]

sbin/dump/dump.h				1.44 via patch
sbin/dump/main.c				1.63 via patch
sbin/dump/snapshot.c				1.3 via patch
sbin/dump/snapshot.h				1.3 via patch
sbin/dump/tape.c				1.47 via patch

	When using a snapshot take the snapshot raw device on further open.
	Fixes PR #34923  dump(8) only dumps a corefile with -X (snapshots)
	[hannken, ticket #1573]

sys/kern/sys_process.c				1.112

	check for negative length in PT_COREDUMP (from Neil)
	[christos, ticket #1574]

sys/arch/xen/xen/if_xennet_xenbus.c		1.14

	Prevent xennet (Xen 3) from occasionally becoming unable to receive
	packets for several minutes when under certain types of load
	[jld, ticket #1581]

usr.sbin/postinstall/postinstall		1.30

	/etc/postfix/post-install needs to be 555 not 444.
	[lukem, ticket #1585]

sys/dev/pci/bktr/bktr_core.c			patch
	fix bug introduced by missing braces around a if() block in
	ticket #1511
	[aymeric, ticket #1587]

sys/net/if_pppoe.c				1.61

	Fix bogus uninitialized variable warning ifdef PPPOE_SERVER.
	Noticed by Marcin Jessa on current-users.
	[martin, ticket #1588]

sys/dev/ata/wd.c				1.334

	Yet another broken seagate drive: ST3160811A.
	[bouyer, ticket #1583]

games/banner/banner.c				1.16 via patch

	Check that -w width is not above maximum. (It already checks for zero
	or negative.) Using width above DWIDTH may cause overflow as noted by
	Gruzicki Wlodek on bugtraq.
	While here replace one use of 132 with DWIDTH.
	[reed, ticket #1591]

sys/netiso/esis.c				1.42

	Check parameters to avoid potential panic root user.
	Patch checked by chopps@.
	[is, ticket #1593]

lib/libc/gen/glob.c				1.13 via patch

	Don't overflow when DEBUG is defined.
	PR/30833, from Tomas Skare.
	[joerg, ticket #1596]

sys/ufs/ffs/ffs_snapshot.c			1.38

	Prevent kernel panics when creating snapshots on filesystems which
	use quotas. This fixes PR kern/35121.
	[hannken, ticket #1598]

sys/arch/xen/x86/consinit.c			1.7

	PR port-xen/35217: Fix compile failure if CONS_OVERRIDE is defined.
	[bouyer, ticket #1600]

sys/dev/vnd.c					1.153

	Don't accept a compressed vnd(4) image with block size 0 to avoid a
	kernel panic.
	[cube, ticket #1530]

dist/dhcp/server/dhcp.c				1.10

	Fix get-lease-hostnames option in dhcpd.conf(5) to make dhcpd(8) use
	the DNS hostname as the DHCP hostname given to the client.
	[drochner, ticket #1619]

sys/net/if_ethersubr.c				1.142

	Don't define dropanyway: label unless ISO or NETATALK is defined.
	Fixes a build failure for certain kernel configurations.
	[bouyer, ticket #1623]

sys/arch/xen/xen/xbd_xenbus.c			1.16

	Don't try to handle xbd interrupts if the device is not yet connected.
	Fixes a Xen3 xbd panic at boot when more than one xbd device is
	configured.
	[bouyer, ticket #1624]

sys/arch/xen/xen/xencons.c			1.20

	Fix Xen console hangs.
	[bouyer, ticket #1625]

sys/dist/ipf/netinet/ip_state.c			1.16 via patch

	TCP window scaling was being recognised but the recorded settins were
	being clobbered and thus effectively disabled.
	[darrenr, ticket #1610]

sys/arch/mac68k/mac68k/locore.s			1.146

	Avoid kernel panic before reboot. This fixes PR port-mac68k/35068.
	[chs, ticket #1626]

xsrc/xfree/xc/programs/Xserver/dbe/dbe.c		1.2
xsrc/xfree/xc/programs/Xserver/render/render.c	1.3

	fix integer overflow in dbe and render extensions
	(CVE-2006-6101, CVE-2006-6102 and CVE-2006-6103), from xfree86 CVS
	[drochner, ticket #1631]

usr.sbin/etcupdate/etcupdate			1.29 - 1.30
usr.sbin/etcupdate/etcupdate.8			1.12

	Use "stty size" to acquire screen width reliably.
	The fields of the first line of "stty -a" is not fixed.
	Fix PR bin/32343.
	Clean ${SRCDIR}/etc when done. Patch provided by rudolf.
	http://mail-index.netbsd.org/tech-toolchain/2007/01/11/0001.html
	Xref postinstall(8)
	[martti, ticket #1630]

sys/arch/xen/xen/xbd_xenbus.c			1.17

	Fix occasional panics in NetBSD domUs caused by a race condition.
	[bouyer, ticket #1632]

sys/arch/xen/include/cpufunc.h			1.13
sys/arch/xen/include/xen3-public/io/ring.h	1.6

	Avoid block I/O stalls in Xen 3 guests on SMP systems.
	[bouyer, ticket #1652]

sys/netinet/ip_output.c				1.173

	Avoid problems if PF's fragment reassemble feature is used.
	[yamt, ticket #1656]

dist/bzip2/bzlib.c				1.3

	Avoid dereference of NULL pointer.
	[adrianp, ticket #1658]

usr.sbin/etcupdate/etcupdate			1.31

	Run pwd_mkdb(8) before running mtree(8) to get updated user and
	group information. This fixes PR bin/35570.
	[martti, ticket #1666]

sys/kern/vfs_syscalls.c				1.293 via patch

	Fix issue noted by Ilja van Sprundel and disclosed at 23C3.
	Make sure we always FILE_UNUSE the file. To make it easier, exit
	via a new "out:" exit path that does so, setting error beforehand.
	Fix suggested by Elad, hand-typed by me.
	[wrstuden, ticket #1616]

dist/bind/lib/dns/resolver.c                    patch
dist/bind/lib/dns/validator.c                   patch
dist/bind/lib/dns/include/dns/validator.h       patch   
dist/bind/version                               patch

	Fix CVE-2007-0493 and CVE-2007-0494.
	[adrianp, ticket #1675]

sys/dev/audio.c					1.221

	return information about playing buffer, not recording bufer,
	for AUDIO_WSEEK. Fix PR#35171.
	[kent, ticket #1678]

sys/netiso/clnp_subr.c				1.27 via patch

	The clnp(4) functions now check the length of arguments passed and will
	return an appropriate error if the value passed is to large.  This
	prevents a local denial of service and privilege escalation attack.

	Issue found by Christer Oberg and patch from christos.
	(NetBSD-SA2007-004)
	[adrianp, ticket #1733]

