#	$NetBSD: CHANGES-2.0.2,v 1.1.2.16 2005/03/22 00:54:01 jmc Exp $

A complete list of changes from the NetBSD 2.0.1 release to the NetBSD 2.0.2
release.

File						Revision(s)
----						--------
sys/kern/kern_descrip.c				1.128 (via patch)

	Avoid endless loop in F_CLOSEM fnctl which could be abused for a
	local DoS. This fixes PR kern/28929.
	[cube, ticket #1089]

sys/arch/amd64/amd64/copy.S			1.2
sys/arch/i386/i386/locore.S			1.33

	Check the passed in address as well as determining the maximum length
	using VM_MAXUSER_ADDRESS in copyinstr and copyoutstr.
	[fvdl, ticket #1317]

sys/nfs/nfs_subs.c				1.146

	nfs_clearcommit: don't attempt to clear commit info (n_pushlo, etc)
	unless the vnode is of VREG. union members used to keep commit info
	are used for other purposes in the case of !VREG.
	[yamt, ticket #1148]

sys/netinet/ip_state.c				patch

	Disable the oow test because it is broken. It is killing valid packets.
	[martti, ticket #1110]

sys/arch/sparc/stand/common/mmu.c		1.5

	Make pmap_map() work on sun4 machines.
	[pk, ticket #1118]

sys/nfs/nfs_vnops.c				1.206

	nfs_commit: use NAC_NOTRUNC when loading an attribute
	as we're called holding pages locked.
	[yamt, ticket #1134]

sys/uvm/uvm_amap.c				1.57
sys/uvm/uvm_pdaemon.c				1.61

	Hack around a UVM problem that causes hangs when large processes fork.
	See PR 26908 for details.
	[chs, ticket #1137]

sys/arch/sparc/sparc/trap.c			1.156

	sun4c hardware reports faults by the atomic load/store instructions as
	read faults even if the problem was that the memory was read-only.
	detect this case and relabel the fault as both read and write.
	part of PR 25633, PR 25896.
	[chs, ticket #1158]

sys/sys/param.h                                 patch
share/tmac/doc-common                           patch
gnu/usr.bin/groff/tmac/mdoc.local               patch

	Welcome to 2.0.2_BETA

sys/arch/sparc/include/lock.h			1.18

	Add the early-clobber modifier on the destination reg of ldstub.
	In some implementations (eg. sun4c), the hardware modifies the
	destination reg before checking for write permission on the memory
	location. Without this change, gcc was using the same register for
	the address and the destination, so if the store part of the
	instruction faulted, the address was already gone when the instruction
	was retried after resolving the fault. Part of PR 25633, PR 25896.
	[chs, ticket #1159]

gnu/usr.bin/groff/tmac/mdoc.local		1.19 via patch

	Teach groff about NetBSD 1.6.3 (used by njs(4), noted by tron).
	[wiz, ticket #1167]

sys/nfs/nfs_vnops.c				1.219

	nfs_readdirrpc, nfs_readdirplusrpc:
	Avoid infinite loops when getting readdir response without
	any entries or EOF. PR/28971.
	[yamt, ticket #1208]

sys/arch/sun3/include/param3.h			1.50

	Bring back the sun3 MAXPHYS definition that has been missing for
	8 years. More recently, we changed to relying on MAXPHYS rather
	than MAXBSIZE to limit page cache I/O sizes, and sun3 has been
	broken since then.
	[chs, ticket #1229]

sys/kern/vfs_lookup.c				1.57

	Adjust error case handling. If the VOP_LOOKUP() call unlocked the
	parent directory node, remember that.
	[wrstuden, ticket #1298]

xsrc/xfree/xc/extras/Xpm/lib/Attrib.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/CrDatFrI.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/hashtab.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/parse.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/scan.c		1.4
xsrc/xfree/xc/extras/Xpm/lib/CrBufFrI.c		1.3
xsrc/xfree/xc/extras/Xpm/lib/RdFToI.c		1.3
xsrc/xfree/xc/extras/Xpm/lib/WrFFrI.c		1.3
xsrc/xfree/xc/extras/Xpm/lib/XpmI.h		1.3
xsrc/xfree/xc/extras/Xpm/lib/data.c		1.3
xsrc/xfree/xc/extras/Xpm/lib/xpm.h		1.3
xsrc/xfree/xc/extras/Xpm/lib/Imakefile		1.2
xsrc/xfree/xc/extras/Xpm/lib/RdFToBuf.c		1.2
xsrc/xfree/xc/extras/Xpm/lib/WrFFrBuf.c		1.2
xsrc/xfree/xc/extras/Xpm/lib/misc.c		1.2
xsrc/xfree/xc/extras/Xpm/lib/create.c		1.6

	Import latest Xpm sources from OpenBSD:
	  o Changes from X.Org 6.8.2 RC1
	  o Fix security problems reported in CAN-2005-0605
	[tron, ticket #1304]

sys/arch/xen/i386/locore.S			1.10

	Sync with i386/locore.S 1.33:
	Check the passed in address as well as determining the maximum length
	using VM_MAXUSER_ADDRESS in copyinstr and copyoutstr.
	[bouyer, ticket #1321]

distrib/notes/sparc64/install			1.24-1.25

	Add description for Solaris 10 dual boot installation from Ben Collver
	in PR port-sparc64/29703.
	[martin, ticket #1322]

gnu/dist/binutils/bfd/ChangeLog			1.2 via patch
gnu/dist/binutils/bfd/elf64-sparc.c		1.4

	Fix bug in "binutils" which broke Firefox under NetBSD-sparc64.
	[skrll, ticket #1101]

sys/dev/tc/px.c					1.22

	Fix a 3 year old error which caused px_init() to fail. Fixes PR 28798.
	[mhitch, ticket #1063]

sys/netinet6/ipsec.c				1.101

	Fix possible remote DoS via IPSec AH packets.
	[itojun, ticket #1327]

sys/arch/prep/prep/ibm_7043_140.c		1.4
sys/arch/prep/prep/machdep.c			1.52

	Ensure that the OpenPIC register window is mapped during
	the startup; only parts of the PCI memory space is mapped
	already.  Move initialization since it requires UVM.
	[jkunz, ticket 1152]

lib/libpthread/pthread.3			1.4

	Document PTHREAD_CONCURRENCY.
	[daniel, ticket #1166]

sys/arch/sparc/sparc/machdep.c			1.252
sys/arch/sparc64/sparc64/machdep.c		1.177
sys/kern/kern_sa.c				1.57 via patch
sys/sys/lwp.h					1.25 via patch

	Define a new LWP flag which indicates that we're in the process of
	doing a context switch.  use this on sparc and sparc64 to avoid trying
	to access user memory (writing the register windows back to the stack)
	in this case (since it's both unnecessary and wrong).
	[chs, ticket #1160]

sys/dev/cgd_crypto.c				1.4

	Clear freed memory.
	[dan, ticket #1343]

distrib/notes/common/contents			patch
distrib/notes/common/main			patch
distrib/notes/common/sysinst			patch
distrib/notes/common/xfer			patch
doc/LAST_MINUTE

	Update release notes for 2.0.2

sys/sys/param.h					patch

	Welcome to 2.0.2
