#	$NetBSD: CHANGES-4.0.1,v 1.1.2.23 2008/03/30 15:28:05 jdc Exp $

A complete list of changes from the NetBSD 4.0 release to the NetBSD 4.0.1
release:

File						Revision(s)
----						--------
gnu/usr.bin/groff/tmac/mdoc.local		patch
sys/sys/param.h					patch

	Welcome to 4.0.0_PATCH

xsrc/xfree/xc/lib/font/bitmap/pcfread.c		1.3

	Apply security fix for CVE-2008-0006.
	[tron, ticket #1047]

sys/arch/sun3/sun3/obmem.c			1.24

	Pass correct size to allocate struct obmem_softc. Fixes an
	occasional panic on my 3/80.
	[tsutsui, ticket #1025]

sys/arch/cobalt/cobalt/machdep.c		1.91

	In icu_intr_establish(), don't panic if the specified irq
	is already in use and just return NULL instead.
	[tsutsui, ticket #1026]

common/dist/zlib/inflate.c			1.4

	Disable a sanity check output buffer != NULL in _STANDALONE case.
	Some kernels are loaded at address 0x0 by bootloaders and
	output buffer address could be zero in such case.
	[tsutsui, ticket #1027]

sys/dev/ic/i82557.c				1.105
sys/dev/ic/i82557reg.h				1.19
sys/dev/ic/i82557var.h				1.36

	Pull several fixes from OpenBSD's fxp.c, fixing PR#30560 as
	well as random pool corruption.
	[tsutsui, ticket #1028]

dist/nawk/lex.c					1.8

	Bring back the fix in revision 1.6, apparently accidentally lost 
	during last merge, to allow escape of a newline in string literals.
	[christos, ticket #1034]

games/larn/bill.c				1.9
games/larn/header.h				1.18 via patch
games/larn/main.c				1.21
games/larn/scores.c				1.16 via patch

	Since games are (now) setgid, not setuid, it is no longer necessary to
	manipulate the effective uid, only the effective gid.
	Use mkstemp to make the temporary files used when you win.
	[dholland, ticket #1067]

sys/netipsec/ipsec_mbuf.c			1.10 via patch

	Avoid a buffer overrun which could crash a FAST_IPSEC kernel.
	PR#30124.
	[seanb, ticket #1015]

etc/namedb/root.cache				1.12, 1.13

	Update to 2008020400 version
	[ghen, ticket #1068]

distrib/notes/common/sysinst			patch
	fix hp700 addition
	[skrll, ticket #1071]

share/man/man4/ddb.4				1.110, 1.111 via patch

	Add magic keyboard sequence for NetBSD-amd64.
	[tron, ticket #1079]

sbin/veriexecctl/veriexecctl.8:			patch

	reflect reality in the veriexecctl(8) man-page.
	[elad, ticket #1080]

sys/arch/acorn32/stand/boot32/boot32.c		1.31

	Zero out the whole of the structure, not just the first 4 bytes.
	Now a small kernel will boot up on my RISC-PC.
	[chris, ticket #1063]

sys/arch/vax/vax/syscall.c			1.10

	Never ever trust the user.  Fix bug introduced in version 1.8 of  
	trap.c by ragge nearly 13 years ago.
	[matt, ticket #1090]

etc/rc.d/amd					1.15

	Don't try to shutdown amd(8) gracefully. It seems to cause problems
	for more people than the old (also broken) behavior. This fixes
	PR bin/36506 and PR bin/38103.
	[tron, ticket #1091]

lib/libc/locale/mbrlen.3			1.9

	bin/38047 fix bad prototype for function mbrlen
	[tnozaki, ticket #1093]

share/man/man9/uiomove.9			patch
	Sync struct uio's documentation with reality in uiomove(9) to reflect
	the removal of uio_segflg and uio_procp.
	[elad, #1092]

sbin/newfs/newfs.8				1.71

	Fix small documentation bug as reported in PR#38192 :
	FFS  -> FFSv1
	UFS2 -> FFSv2
	[reinoud, ticket #1099]

lib/libc/stdlib/strfmon.c			1.5

	Avoid integer overflow; reported by Maksymilian Arciemowicz.   
	[mjf, ticket #1102]

bin/mt/mt.1					1.34

	Clarify that "mt offline" ejects tapes. Also some grammar and
	formatting fixes. PR bin/37727 from Randolf Richardson.
	[dholland, ticket #1100]

dist/bzip2/CHANGES:				patch
dist/bzip2/LICENSE:				patch
dist/bzip2/Makefile-libbz2_so:			patch
dist/bzip2/Makefile:				patch
dist/bzip2/README.COMPILATION.PROBLEMS:		patch
dist/bzip2/README.XML.STUFF:			patch
dist/bzip2/README:				patch
dist/bzip2/Y2K_INFO:				patch
dist/bzip2/blocksort.c:				patch
dist/bzip2/bz-common.xsl:			patch
dist/bzip2/bz-fo.xsl:				patch
dist/bzip2/bz-html.xsl:				patch
dist/bzip2/bzdiff.1:				patch
dist/bzip2/bzdiff:				patch
dist/bzip2/bzgrep.1:				patch
dist/bzip2/bzgrep:				patch
dist/bzip2/bzip.css:				patch
dist/bzip2/bzip2.1:				patch
dist/bzip2/bzip2.c:				patch
dist/bzip2/bzip2netbsd:				patch
dist/bzip2/bzip2recover.c:			patch
dist/bzip2/bzlib.c:				patch
dist/bzip2/bzlib.h:				patch
dist/bzip2/bzlib_private.h:			patch
dist/bzip2/bzmore.1:				patch
dist/bzip2/compress.c:				patch
dist/bzip2/crctable.c:				patch
dist/bzip2/decompress.c:			patch
dist/bzip2/dlltest.c:				patch
dist/bzip2/entities.xml:			patch
dist/bzip2/format.pl:				patch
dist/bzip2/huffman.c:				patch
dist/bzip2/manual.html:				patch
dist/bzip2/manual.texi:				patch
dist/bzip2/manual.xml:				patch
dist/bzip2/manual_1.html:			patch
dist/bzip2/manual_2.html:			patch
dist/bzip2/manual_3.html:			patch
dist/bzip2/manual_4.html:			patch
dist/bzip2/manual_abt.html:			patch
dist/bzip2/manual_ovr.html:			patch
dist/bzip2/manual_toc.html:			patch
dist/bzip2/mk251.c:				patch
dist/bzip2/randtable.c:				patch
dist/bzip2/spewG.c:				patch
dist/bzip2/unzcrash.c:				patch
dist/bzip2/words0:				patch
dist/bzip2/words2:				patch
dist/bzip2/words3:				patch
dist/bzip2/xmlproc.sh:				patch
distrib/sets/lists/base/shl.mi:			patch
distrib/sets/lists/man/mi:			patch
distrib/sets/lists/misc/mi:			patch
doc/3RDPARTY:					patch
lib/libbz2/Makefile:				patch
lib/libbz2/shlib_version:			patch

	Upgrade bzip2 to 1.0.5, fixing CVE-2008-1372 and CVE-2005-0953
	[adrianp, ticket #1106]

sys/dev/pci/machfb.c				1.51
sys/dev/pci/voodoofb.c				1.14

	Introduce two missing KAUTH_GENERIC_ISSUSER check in the voodoo and
	machfb mmap() code.  Discussed with and okay macallan@.
	[elad, ticket #1107]

sys/dev/ata/wd.c				1.359
	The Hitachi HDP725025GLA380 returns "aborted command" instead of
	"id not found" when hitting the LBA48 bug, so also install the
	LBA48 bug workaround on "aborted command" errors.
	[bouyer, ticket #1094]

sys/netinet/ip_input.c				1.263
sys/netinet/tcp_subr.c				1.225
	Make sure we send a reasonable fragment size when IPSEC is configured.
	Otherwise we end up sending a dubious "0" whenever we cannot find a
	proper association for the packet.
	Reset sack_newdata along with snd_nxt to avoid improper integer
	arithmetics that lead to sending data from an incorrect place in the
	stream, making it appear as corrupted.
	[cube, ticket #1109]

