#	$NetBSD: CHANGES-1.6.3,v 1.1.2.70 2004/04/06 21:13:19 tron Exp $

A complete list of changes from NetBSD 1.6.2 to NetBSD 1.6.3:

File						Revision(s)
----						--------

sys/conf/osrelease.sh				patch
share/tmac/doc-common				patch

	Mark this as 1.6.2_STABLE.

build.sh					patch

	Set NETBSDSRCDIR explicitly to avoid build lossage
	[jmmv, ticket #1550]

usr.sbin/route6d/route6d.c			1.49

	Validate packet length.
	[itojun, ticket #1551]

share/termcap/termcap.src			1.85-1.86

	Apply various fixes to entries.
	[tron, ticket #1554]

xsrc/xfree/xc/programs/xterm/Tekproc.c		1.3

	Revert revision 1.2, and fix the warning correctly. 
	Prevents garbled fonts.
	[fredb, ticket #1545]

usr.sbin/dhcp/clientscript/dhclient-script	1.5

	Update resolv.conf if we have new nameservers. 
	Don't require a domain, because it is not needed.
	[aymeric, ticket #1546]

sys/sys/stat.h					1.45 via patch

	Define S_IFSOCK as an XSI extension, define S_ISLNK() for POSIX-2001,
	and define S_ISSOCK() for POSIX-2001. PR#22902
	[kleink, ticket #1556]

usr.bin/sed/process.c				1.34

	Prevent integer underflow.
	[itojun, ticket #1558]

sys/net/if.c					1.131

	Fix out-of-bounds access to ifindex2ifnet[].
	[briggs, ticket #1560]

sys/dev/hpc/hpcbatterytable.h			1.4

	Add MobilePro 880 (MC/R730A) to hpcbatterytable.h
	[shin, ticket #1584]

sys/arch/hpcmips/vr/vrpiu.c			1.32

	Add MobilePro 880 (MC/R730A) to stylus calibration table.
	[shin, ticket #1585]

sys/arch/hpcmips/conf/GENERIC			1.143
sys/arch/hpcmips/conf/VR41XX			1.16
sys/arch/hpcmips/vr/vrc4172pwm.c		1.19

	Add MC/R700A, MC/R730, and MC/R730A vrc4172pwm flags.
	[shin, ticket #1586]

sys/arch/hpcmips/conf/GENERIC			1.144
sys/arch/hpcmips/vr/vrc4172pci.c		1.11

	Add MobilePro 880 (MC/R730A), MC/R730 support for USB/pci.
	[shin, ticket #1587]

sys/arch/hpcmips/tx/tx39clock.c			1.16

	Initialize sc_epoch and RTC properly when reboot/resume.
	[shin, ticket #1588]

gnu/dist/cvs/src/filesubr.c			1.4

	Implement proper group membership testing. PR#24021
	[christos, ticket #1592]

sys/arch/arm/arm/syscall.c			1.21-1.22

	Fix up some unitialised variables to avoid a possible crash.
	[skrll, ticket #1552]

sys/arch/amiga/dev/toccata.c			1.7

	Remove forgotten debug printf from development.
	[is, ticket #1593]

sys/dev/usb/ehci.c				1.51
sys/dev/usb/ohci.c				1.146
sys/dev/usb/uhci.c				1.177
sys/dev/usb/uhub.c				1.65

	Use the correct wValue to get hub desriptors.
	Also, make wValue checks of root hub codes less strict.
	[toshii, ticket #1599]

lib/libc/net/nslexer.l				1.7
lib/libc/net/nsparser.y				1.9

	Use syslog(3) instead of err(3) to log errors.
	Add '0ption never-interactive' to nslexer.l, to prevent isatty() from
	being called unnecessarily.
	[lukem, ticket #1601]

lib/libc/net/getnetnamadr.c			1.28

	Use the correct parameters when building the YP map name in 
	_yp_getnetbyaddr(). Fixes getnetbyaddr() when reading from YP.
	[lukem, ticket #1602]

etc/namedb/root.cache				1.10

	Update to 2004012900 version
	[taca, ticket #1603]

sys/uvm/uvm_mmap.c				1.66

	#if 0 the call to uvm_map_checkprot() in sys_munmap() -- it's not 
	documented, and programs do not expect it.  Also fixes memory leaks 
	in dlopen()/dlclose().
	[skrll, ticket #1607]

sys/dev/pci/eso.c				1.32

	Audio 2's DMA current address register implements only the least
	significant 20 bits, so make sure its memory allocation won't cross
	a 1M boundary.
	[kleink, ticket #1613]

sys/dev/pci/eso.c				1.33

	Fix a (non-dangerous) malloc size botch in eso_allocm(). PR#18342
	[kleink, ticket #1614]

usr.sbin/route6d/route6d.c			1.51

	Let it compile again on sparc/sparc64.
	[martin, ticket #1626]

sys/dev/scsipi/scsiconf.c			1.220

	Add a drive with broken tagged queuing support. PR#23815
	[bouyer, ticket #1625]

gnu/usr.bin/cvs/include/config.h		patch

	Correct version # reported to correct one
	[wiz, ticket #1620]

sys/kern/vfs_getcwd.c				1.22

	Rewind the 'bp' advanced backward by cache_revlookup() if 
	getcwd_getcache() finally returns cache miss.
	[enami, ticket #1616]

sys/kern/vfs_cache.c				patch
sys/kern/vfs_getcwd.c				patch

	Fix LP64 bugs triggered by overflow.
	[enami, ticket #1617]

usr.bin/rpcgen/rpc_main.c			1.24

	Remove special case handling for $CPP and use execvp() instead.
	[martin, ticket #1619]

sys/miscfs/fifofs/fifo_vnops.c			1.46

	Handle the case of fifo_close() getting called from vclean().
	Fixes memory leak in revoke(2) path.
	[wrstuden, ticket #1621]

share/man/man4/auich.4				patch
sys/dev/pci/auich.c				patch
sys/dev/pci/auichreg.h				patch
sys/dev/pci/pcidevs				patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen

	Add support for ICH3, ICH4, ICH5, SiS 7012, nForce MCP, nForce2 MCP-T,
	and nForce3 MCP-T to auich driver.
	[kent, ticket #1612]

sys/dev/pci/if_bge.c				1.59

	Set BGE_JUMBO_RXRING_VALID in bge_flags when allocating jumbo ring 
	buffers so it can be freed later. PR#24686
	[martin, ticket #1622]

sys/netinet/tcp_timer.c				1.66

	callout_ack() was called with wrong argument
	[he, ticket #1624]

usr.sbin/route6d/route6d.c			1.50

	Need_trigger/idx should be u_int
	[martin, ticket #1627]

lib/libc/gen/arc4random.c			0-1.5
lib/libc/gen/arc4random.3			0-1.6
lib/libc/gen/Makefile.inc			1.111
lib/libcrypt/blowfish.c				0-1.3
lib/libcrypt/bcrypt.c				0-1.3
lib/libcrypt/crypt.c				1.19-1.21
lib/libcrypt/crypt.3				1.14-1.17
include/pwd.h					1.26
include/stdlib.h				1.56
usr.bin/passwd/pwd_gensalt.c			1.6
share/man/man5/passwd.conf.5			1.5-1.6
lib/libcrypt/Makefile				1.12,1.14
lib/libc/shlib_version				1.117
lib/libcrypt/shlib_version			1.4
distrib/sets/lists/base/shl.mi			patch
distrib/sets/lists/comp/mi			patch

	Introduce bcrypt password scheme. Adds the arc4random API for creating 
	cryptographically strong random numbers.
	[provos, ticket #1386]

gnu/lib/libstdc++/include/Makefile		1.4 via patch

	Add more rules to disable default '.cc -> NULL' transforms, because the 
	default rules cause problems if "valarray.cc" is newer than "valarray"
	(for example).
	[junyoung, ticket #1611]

sys/kern/kern_exit.c				1.104-1.106

	Make sure that, if orphaned child is being traced, it's reparented back 
	to the original parent before it's killed.
	[junyoung, ticket #1615]

sys/dev/ata/wd.c				1.258 via patch

	Add LBA48_THRESHOLD #define and set it to the *correct* value.  Use it
	in place of 0xffffff (which is one too few 'f').
	[bouyer, ticket #1628]

sys/dev/ata/wd.c				1.260 via patch

	For LBA drives, compute the number of cylinders from the drive capacity
	in the default disklabel and the boot message, instead of using the
	value reported by the drive (which is 16383 if the drive is larger 
	than 8G). Fixes PR#9864
	[bouyer, ticket #1629]

sys/dev/pci/pciide.c				1.195

	Correct offset for the promise "magic registers" (it depends on channel
	number). This makes cable detect work properly for newer promise 
	(pdc268 and newer).
	[bouyer, ticket #1630]

sys/dev/pci/pcidevs				1.565 via patch
sys/dev/pci/pcidevs_data.h		regen
sys/dev/pci/pcidevs.h			regen

	Add 3com 3c940 Gigabit Ethernet, and VIA KT600 PCI devices. PR#22453
	[bouyer, ticket #1631]

sys/dev/pci/pciide.c				1.196 via patch

	Add support for VIA VT8237 (KT600) IDE controller. PR#22453
	[bouyer, ticket #1632]

sys/dev/ic/esiop.c				1.25

	The real value of the message is in msgin, not 
	esiop_cmd->cmd_tables->msg_in[0], so print the correct value.
	[bouyer, ticket #1633]

sys/arch/vax/include/stdarg.h			1.16

	Fix == vs = typo from rev. 1.13 in __va_copy. PR#24846
	[kleink, ticket #1634]

lib/libc/time/strptime.3			1.16-1.17 via patch

	%% doesn't write anything; a literal % is matched.
	[kleink, ticket #1635]

sys/dev/ic/wdc.c				1.172 via patch

	Wait a bit more after reset before re-enabling interrupts. PR#24904
	[bouyer, ticket #1637]

usr.sbin/sushi/sushi.c				1.11-1.12

	Don't report curses initialization failure using curses. PR#24435
	[martin, ticket #1638]

usr.sbin/arp/arp.c				1.39

	Plug memory leak. PR#22479
	[fair, ticket #1636]

libexec/fingerd/fingerd.c			1.21

	Correct option parse error reporting. PR#24917
	[fair, ticket #1639]

gnu/dist/cvs/ChangeLog				patch
gnu/dist/cvs/NEWS				patch
gnu/dist/cvs/configure				patch
gnu/dist/cvs/configure.in			patch
gnu/dist/cvs/doc/ChangeLog			patch
gnu/dist/cvs/doc/stamp-1			patch
gnu/dist/cvs/doc/stamp-vti			patch
gnu/dist/cvs/doc/version-client.texi		patch
gnu/dist/cvs/doc/version.texi			patch
gnu/dist/cvs/lib/ChangeLog			patch
gnu/dist/cvs/lib/system.h			patch
gnu/dist/cvs/ChangeLog				patch
gnu/dist/cvs/sanity.sh				patch
gnu/dist/cvs/commit.c				patch
gnu/dist/cvs/recurse.c				patch
gnu/dist/cvs/run.c				patch
gnu/dist/cvs/server.c				patch
gnu/usr.bin/cvs/include/config.h		patch

	Fixes a known security problem w. syslog'ing as root (and prevents
	pserver from being run as root).
	[jmc, ticket #1641]

sys/netinet/udp_usrreq.c			1.117-1.118

	Drop packet if IPv6 udp packet does not have checksum (checksum is
	mandatory in IPv6).
	[itojun, ticket #1645]

sbin/routed/rdisc.c				patch
sbin/routed/main.c				patch

	Fix invalid cast wrt router discovery.
	[ws, ticket #1642]

sbin/routed/routed.8				patch

	Fix inconsistency between manual page and RFC 1256.
	[ws, ticket #1643]

gnu/dist/cvs/src/server.c			1.14

	Correctly fallback into the normal path when SETXID_SUPPORT is defined
	but the binary was the normal one.  Fixes PR#23471.
	[jmc, ticket #1646]

crypto/dist/openssl/crypto/opensslv.h		patch
crypto/dist/openssl/apps/asn1pars.c		patch
crypto/dist/openssl/certs/vsign3.pem		patch
crypto/dist/openssl/crypto/asn1/a_strex.c	patch
crypto/dist/openssl/crypto/bio/b_print.c	patch
crypto/dist/openssl/crypto/evp/e_rc4.c		patch
crypto/dist/openssl/crypto/pem/pem_lib.c	patch
crypto/dist/openssl/crypto/x509/by_dir.c	patch
crypto/dist/openssl/crypto/x509/x509type.c	patch
crypto/dist/openssl/doc/crypto/BIO_f_ssl.pod	patch
crypto/dist/openssl/doc/ssl/SSL_COMP_add_compression_method.pod		patch
crypto/dist/openssl/ssl/s3_clnt.c		patch
crypto/dist/openssl/ssl/s3_enc.c		patch
crypto/dist/openssl/ssl/s3_pkt.c		patch
crypto/dist/openssl/ssl/ssl.h			patch
crypto/dist/openssl/ssl/ssl_cert.c		patch
crypto/dist/openssl/ssl/ssl_ciph.c		patch

	Pull up major differences from openssl 0.9.6l->0.9.6m. Major fix is
	a null pointer check that can cause crashes.
	[groo, ticket #1640]

gnu/dist/toolchain/gcc/config/arm/arm.c		patch

	Fixes bad code generation that could cause X crashes.
	[is, ticket #1647]

sys/dev/pci/pcidevs				patch
sys/dev/pci/pcidevs.h				regen
sys/dev/pci/pcidevs_data.h			regen
sys/dev/pci/if_fxp_pci.c			patch

	Pull in changes to support the Intel 82801EB/ER (ICH5) Controller. 
	PR#25002
	[briggs, ticket #1648]

gnu/usr.bin/send-pr/send-pr.sh			1.21-1.22 via patch

	Use mktemp(1) for safe temp files. PR#21840
	[reed, ticket #1649]

bin/sh/arith_lex.l				1.11

	Recognise octal and hexadecimal constants in expressions.
	[simonb, ticket #1650]

lib/libc/db/hash/hash_buf.c			1.9
lib/libc/db/hash/hash_bigkey.c			1.16

	lib/libc/db/hash/* writes memory garbage to db file.
	Fixed by changing malloc's to calloc's where needed. PR#5996
	[bouyer, ticket #1651]

sys/dev/ic/com.c				1.225

	Fix race condition introduced in rev 1.189; after the change, if there
	is THRE interrupt occurs between the LSR read and IIR read, we won't
	see the LSR_TXRDY bit when testing it in the variable `lsr' and we
	don't interrupted again (as the corresponding bit in the IIR is
	cleared by reading, except for some broken device).
	Tested by Matthias Scheler and me, reviewed by Allen Briggs.
	Closes PR#25010.
	[enami, ticket #1658]

usr.sbin/rpc.lockd/lockd_lock.c			1.12

	- protect from pid reusing.
	- fix a null dereference on the error.
	[bouyer, ticket #1654]

usr.sbin/rpc.lockd/lockd_lock.c			1.13

	for fork'ed children, use _exit instead of exit.
	[bouyer, ticket #1652]

usr.sbin/rpc.lockd/lockd_lock.c			1.17

	for lock/unlock requests, log svid as well as client name.
	[bouyer, ticket #1653]

usr.sbin/rpc.lockd/lockd_lock.c			patch

	getlock: detect duplicated locks slightly correctly.
	XXX how should we do for byte range lock?
	[bouyer, ticket #1655]

usr.sbin/rpc.statd/statd.c			1.22

	reset_host: reset actual host infos rather than reset copies of them.
	[bouyer, ticket #1656]

usr.sbin/rpc.statd/statd.c			1.23

	init_file: copy status_info from static storage so that
	statd doesn't always use the same "status" number.
	[bouyer, ticket #1657]

share/termcap/termcap.src			1.87 via patch

	Add enable ACS (eA) capability to our xterm entry. The xterm shipped
	with Xfree 4.4.0 needs this. Fixes PR lib/24770 by Matthias Scheler.
	[jdc, ticket #1660]

