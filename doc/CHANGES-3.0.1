#	$NetBSD: CHANGES-3.0.1,v 1.1.2.19 2006/02/15 19:48:28 riz Exp $

A complete list of changes from the NetBSD 3.0 release to the NetBSD 3.0.1
release:

File						Revision(s)
----						--------
gnu/usr.bin/groff/tmac/mdoc.local		patch
sys/sys/param.h					patch

	Welcome to 3.0.0_STABLE

doc/README.files				patch

	Update for release and new CHANGES-3.0.1 file.

lib/libc/gen/getcwd.c				1.41

	Allow last component to be non-existing again.
	This is what broke systrace's filename normalization.
	Go back to original behavior as in revision 1.35: return resolved name,
	but also set errno to ENOENT.
	[elad, ticket #1068]

sys/kern/kern_subr.c				1.122

	hold kernel_lock while calling systrace_exit().
	fixes PR 25856.
	[chs, ticket #1072]

sys/kern/kern_systrace.c			1.50 via patch

	in systrace_make_msg(), sleep uninterruptibly while waiting for
	the response from the systrace daemon, so that the message protocol
	between the kernel and the daemon doesn't get out of sync.
	fixes PR 29654.
	[chs, ticket #1071]

xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_dac.c 1.8
xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_driver.c 1.7
xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_hw.c 1.2
xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_include.h 1.2
xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_setup.c 1.7
xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_type.h 1.6
xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/nv_video.c 1.2
xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/riva_driver.c 1.2
xfree/xc/programs/Xserver/hw/xfree86/drivers/nv/riva_include.h 1.2

	Sync the Nvidia drivers with XFree86's sources as of December 24th,
	2005.  These changes fix lots of problems (i.e. freezes) with the
	latest cards (such as a GeForce 6600GT).
	[jmmv, ticket #1074]

lib/libc/gen/getcwd.c				1.42

	Revert back to revision 1.40, as requested by cube@.
	Unbreaks KDE.
	[elad, ticket #1077]

bin/systrace/intercept.c			1.26
bin/systrace/intercept.h			1.18

	Give systrace its own version of realpath() that does what it wants,
	call it intercept_realpath().  Unbreaks systrace.
	[elad, ticket #1078]

sys/fs/union/union_vfsops.c			1.32

	Change union_unmount() to not play with the fs root vnode explicitly.
	Let it get recycled along with all of the others. This is important
	as if the root vnode has already been reclaimed, then we get a panic
	when we try to vget it.  This addresses PR: kern/31382
	[wrstuden, ticket #1091]

sys/net/if_bridge.c				1.35

	Make sure we initialize all structs to 0.
	[christos, ticket #1111]

sys/arch/xen/xen/xbdback.c			1.16 via patch

	Avoid dom0 kernel crash when destroying a domain with active I/O going.
	[bouyer, ticket #1106]

sys/arch/xen/i386/npx.c				1.7

	Fix the FPU problems detected by paranoia on a NetBSD/Xen guest,
	PR port-xen/30977.
	[bouyer, ticket #1107]

lib/libc/arch/sparc/sys/ptrace.S		1.6-1.7

	Use __errno in the _REENTRANT case.
	[martin, ticket #1109]

sys/dev/raidframe/rf_netbsdkintf.c		1.193

	We need to mark used spares as failed if they encounter IO errors.
	[oster, ticket #1114]

sys/dev/ic/wdc.c				1.231

	After a reset don't wait for drives to come ready if there's no
	drives.  Fix a 30s hang after resume. Problem reported and fix
	tested by Brian de Alwis.
	[bouyer, ticket #1125]

lib/libc/rpc/xdr_rec.c				1.26

	John Kohl: xdr_rec.c missing a bugfix for an improper security
	check.  The correct way to check for a zero record length is to
	check for it without the LAST_FRAG marker in it, since it's legal
	to send a LAST_FRAG marker with 0 bytes of data.  PR#32572

	[christos, ticket #1128]

distrib/amiga/miniroot/install.md		1.25
distrib/miniroot/install.sh			1.23
distrib/miniroot/upgrade.sh			1.21

	Don't ask for the root device before the user had a chance to
	identify how it's called under NetBSD.
	[is, ticket #1130]

sys/arch/i386/pnpbios/pciide_pnpbios.c		1.22 via patch

	Update pciide at pnpbios to work with the last changes to wdc(4),
	especially the deferral of drive probe. This fixes PR kern/23192.
	[bouyer, ticket #1131]

sys/dev/ata/wd.c				1.318

	Fix support for 1 and 2TB disks (tested under qemu).
	[abs, ticket #1132]

sys/dist/pf/net/pf_norm.c			1.11

	Fix a bug in the fragment cache which could cause kernel panics.
	[peter, ticket #1139]

sys/arch/hp300/stand/common/ite_dv.c		1.6
sys/arch/hp300/stand/common/ite_gb.c		1.6
sys/arch/hp300/stand/common/ite_hy.c		1.6
sys/arch/hp300/stand/common/ite_rb.c		1.6
sys/arch/hp300/stand/common/ite_tc.c		1.6

	Fix bootloader so it doesn't print garbage to the bitmap console.
	[tsutsui, ticket #1145]

sys/arch/xen/xen/if_xennet.c			1.41 via patch

	Fix off-by-one error.
	[bouyer, ticket #1154]

sys/dev/pci/azalia.c	 			1.19 via patch

	Don't crash when a connection list has invalid NIDs.
	This fixes PR kern/32485.
	[kent, ticket #1124]

sys/dev/pcmcia/aic_pcmcia.c			patch
doc/HACKS					patch

	aic(4): work around rbus resource allocation problem so cards work
	again.
	[jnemeth, ticket #1153]

sys/arch/xen/xen/if_xennet.c			1.42 via patch
sys/arch/xen/xen/xennetback.c			1.20 via patch

	Check the destination ethernet address when not in promiscous mode.
	Fix problem where packets would be duplicated, possibly looping, when
	a domU is doing IP routing.
	[bouyer, ticket #1155]

sys/arch/xen/i386/xen_machdep.c			1.16

	Fix bad cut'n'paste: use the target of strncpy() in sizeof().
	[bouyer, ticket #1157]

sys/net/if_bridge.c				1.36

	Fix memory disclosure in bridge(4).
	[adrianp, ticket #1163]

sys/dev/raidframe/rf_driver.c			1.110
sys/dev/raidframe/rf_psstatus.c			1.31
sys/dev/raidframe/rf_psstatus.h			1.13

	RAIDframe was erroneously re-initializing the Parity Stripe Status
	pool each time a new array was configured.  This causes grief
	with things like 'vmstat -m' by causing it to loop.  Make RAIDframe
	only initialize PSS bits once.
	[oster, ticket #1170]

