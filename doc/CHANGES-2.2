#	$NetBSD: CHANGES-2.2,v 1.1.2.11 2005/11/03 21:04:07 riz Exp $

A complete list of changes from the NetBSD 2.1 release to the NetBSD 2.2 
release

File						Revision(s)
----						--------
sys/sys/param.h                                 patch
share/tmac/doc-common                           patch
gnu/usr.bin/groff/tmac/mdoc.local               patch

	Welcome to 2.1_STABLE

doc/LAST_MINUTE					patch

	Null out in preparation for 2.2

gnu/libexec/uucp/doc/uucp.texi			1.6
gnu/libexec/uucp/libunix/pipe.c			1.3

	Allow for \H -> "address ..." substitution in PIPE ports. Useful
	e.g. for generic UUCP over SSH or SSL... Idea and part of the patch
	by Joerg Durchain, has apparently been integrated in Debian for a
	while.
	[is, ticket #5825]

sys/dev/raidframe/rf_dagdegwr.c			1.26

	Remove an RF_ASSERT that is just plain wrong.
	[oster, ticket #5878]

doc/README.files				patch

	Note new CHANGES file and fix XXX's for release numbers.

sys/nfs/nfs.h					1.49
sys/nfs/nfs_subs.c				1.152 via patch
sys/nfs/nfs_vfsops.c				1.149 via patch
sys/nfs/nfs_vnops.c				1.227 via patch
sys/nfs/nfsmount.h				1.34
usr.sbin/amd/include/config.h			1.36

	Allow the attribute cache to be turned off, and allow amd
	to do it.
	[christos, ticket #5863]

sys/arch/alpha/conf/GENERIC			1.276

	If we're enabling ipfilter then we should really have IPFILTER_LOG
	[abs, ticket #5893]

sys/dev/ic/wdc.c				patch

	In __wdccommand_start(), don't cann wdcwait() with ata_c->flags, as 
	this gives  information about the context in which wdc_exec_command() 
	was called, but we may be in interrupt context here. Call wdcwait() 
	with flags derived from xfer->c_flags instead, as do other wdcwait() 
	callers. PR#31083
	[bouyer, ticket #5852]

include/sched.h					1.8
lib/libpthread/sched.c				1.4

	Change the sched_*() functions to return -1 and set errno to ENOSYS
	(per the standard) instead of returning ENOSYS. PR#30970
	[kleink, ticket #5918]

usr.sbin/rpc.statd/statd.c			1.24

	rpc.statd doesn't save failed notifies in the database. PR#31502
	[christos, ticket #5934]

share/misc/airport				1.26

	Correct typo in the airport file.
	[is, ticket #5937]

sys/kern/uipc_socket.c				1.112

	Check the argument to SO_LINGER.
	[nathanw, ticket #5939]

sys/dev/ic/elinkxl.c				1.85

	The previous change (to use bus_space_read_2), was broken because it was
	reading from an odd offset.
	[christos, ticket #5942]

sys/netinet6/icmp6.c				1.111

	In icmp6_redirect_output(), sip6 is initialised to point to the
	data area of m0. But m0 may be freed later, so trying to use
	sip6 at the end of this function is wrong. My guess is that
	we want to reference the data area of m (the mbuf about to be
	send) instead at this point.  Fix a panic on Xen (where a data
	area of a mbuf may be unmapped when the mbuf is freed), and
	probably potential data/pool corruption in other cases.
	[bouyer, ticket #5938]

share/man/man4/fast_ipsec.4			1.2-1.3

	Fix Dd argument; new sentence, new line; sort sections;
	typo fixes.
	[jmc, ticket #5946]

distrib/sets/lists/base/md.ibmnws		delete
distrib/sets/lists/base/mi			1.576
distrib/sets/lists/man/md.ibmnws		delete
distrib/sets/lists/man/mi			1.835 via patch
gnu/usr.sbin/Makefile				1.14

	Build ncdcs on everything. Allows better set sharing (and
	we don't exclude other 'system specific' binaries from other
	builds ala sunlabel, etc), and nuke only md man page in existence,
	simplifying man.tgz set sharing.
	[jmc, ticket #5948]

sys/arch/sparc/sparc/cpu.c			1.193

	Compute c_totalsize for split caches correctly: it's max, not sum (and
	we even have that documented in cache.h).  Initialize c_nlines for
	split caches.
	This should fix srmmu cache flush routines for split I/D caches that
	has been broken since cache.c revision 1.79 started using c_nlines.
	[uwe, ticket #5950]

sys/kern/kern_exec.c				patch

	Don't clear unconditionally P_SUGID when we exec. Clear it only when
	the real and effective user and group ids match.
	[dan, ticket #5955]

dist/ntp/ntpd/ntpd.c				1.8

	Use group-id from ``gr'' and not ``pw''.
	Fixes security issue addressed by CAN-2005-2496.
	[dan, ticket #5958]

sys/dev/scsipi/scsipi_ioctl.c			1.54

	Don't claim there is a data in or out phase if the datalen is 0
	(userland shouldn't claim it either, but a buggy software shouldn't
	be able to crash the kernel anyway). Should fix port-sparc64/31925
	by Johan A.van Zanten (which should really be kern/31925).
	Analysed and patch tested by Martin Husemann.
	[bouyer, ticket #5961]

distrib/utils/sysinst/util.c			1.137

	Don't redisplay the title messages before displaying sub-menus
	during set selection (eg selecting the X sets).
	libcurses got changed earlier in the year so that the erase (and
	refresh) of the message window caused all the unchanged spaces
	to be redrawn overwriting most of the main set selection window.
	[dsl, ticket #5964]

